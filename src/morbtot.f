      PROGRAM MORBID
C**********************************************************************
C
C     PROGRAM FOR CALCULATING THE ROTATION-VIBRATION ENERGIES OF
C     A TRIATOMIC MOLECULE AFTER THE MORBID SCHEME OF PER JENSEN.
C     THIS PROGRAM SUPPOSEDLY CAN LEAST SQUARES FIT PARAMETERS.
C
C**********************************************************************
      IMPLICIT REAL*8 (A-H,O-Z)
      PARAMETER (NMOBS=1500,MAXJP1=16,MAXISO=12,NMABI = 1500,
     1           NEAMX=NMOBS+NMABI)
      
C ***********************************************************************
C     ADDED BY IVO FORSUNG CHI MBAPEH     22.05.2014 
C     DECLARING ARRAYS FOR AB-INITIAL DATA READING OF BeOH

C
      REAL*8  R1M(NMABI),R3M(NMABI),ALPM(NMABI),
     1        R1P(NMABI),R3P(NMABI),ALPP(NMABI),
     2        WTABI(NMABI),EABI(NMABI),ECLCABI(NMABI),DELABI(NMABI),
     3        DERIVS(56),DERIVP(56),DERIVM(56)
  
C ***********************************************************************
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,MAXISO)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT , JVAR(55)
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,MAXISO)
C
      LOGICAL SYMM,POTSYM
      LOGICAL SKPSYM ( 2 , 2 , MAXJP1 , MAXISO )
C
      REAL*8 RMK(2),AAS(2)
      INTEGER TAUP,TAUM
      INTEGER NOBAS,MBASP1,LENIW,JDIMST(4),ISTART(4),
     1        LINDEX(4),NOLIN(MAXISO)
     
      INTEGER  ISOT(NMOBS),JU(NMOBS),TAUU(NMOBS),IEOU(NMOBS),
     1                     JL(NMOBS),TAUL(NMOBS),IEOL(NMOBS),
     2                     NUMBU(NMOBS),NUMBL(NMOBS),INDUX(55)
      REAL*8   OBS(NMOBS),WT(NEAMX),CALC(NMOBS),OCLC(NMOBS),
     1         EPSI(NEAMX)      

      REAL*8   PARAM(55),PAROLD(55),SD(55),CRR(55),RJTJ(55,55),
     1         RJTE(55),SC(55)
      REAL*8   RJACOB(NEAMX,55),STADEV(MAXISO),RJACIN(NEAMX,55)
      CHARACTER*1 CHDUMM
      CHARACTER*6 PX(55)
      CHARACTER*4 ASYSYM(2),SYMSYM(2,2),LSYM
      REAL*8 RECS
C
      COMMON /WORKCO/ WORK(6000000)
C
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133

      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      DATA SYMSYM/'A1  ','B1  ','B2  ','A2  '/
      DATA ASYSYM/'A''  ','A"  '/
      DATA PX/'RHOE  ','RE12  ','RE32  ','AA1   ','AA3   ',
     .                          'FA1   ','FA2   ','FA3   ',
     .        'FA4   ','FA5   ','FA6   ','FA7   ','FA8   ',
     .        'F1A1  ','F2A1  ','F3A1  ','F4A1  ','F1A3  ',
     .        'F2A3  ','F3A3  ','F4A3  ','F11   ','F1A11 ',
     .        'F2A11 ','F3A11 ','F33   ','F1A33 ','F2A33 ',
     .        'F3A33 ','F13   ','F1A13 ','F2A13 ','F3A13 ',
     .        'F111  ','F1A111','F2A111','F333  ','F1A333',
     .        'F2A333','F113  ','F1A113','F2A113','F133  ',
     .        'F1A133','F2A133','F1111 ','FA1111','F3333 ',
     .        'FA3333','F1113 ','FA1113','F1333 ','FA1333',
     .        'F1133 ','FA1133'/
      ISOMAX=MAXISO
      MXJVP1=MAXJP1
      OLDTIM=0.0D+00
      OLDVEC=0.0D+00
      HARTRE=2.194746354E+05
C
C*********************************************************************
C
C       PRINT TITLE BANNER
C
C*********************************************************************
C
      CALL HEADER
C
C*********************************************************************
C
C       READ INPUT
C
C*********************************************************************
C

      CALL READIN(POTSYM)
      IF (POTSYM) THEN
                  PARMAX=35
                  CALL DEFSYM(PARAM)
                  CALL NAMESY(PX)
      ELSE
                  PARMAX=55
                  CALL DEFASY(PARAM)
      ENDIF

cp1new

      READ(NFIL5,*) ITNUMBER
      REWIND 40
4041  READ(40,'(I10,55A6,55E20.10)',END=4040,ERR=4040) IDUM,PX,PARAM
      IF(IDUM.EQ.ITNUMBER) GOTO 4040
      GOTO 4041
4040  CONTINUE
      REWIND 40
      WRITE(40,'(I10,55A6,55E20.10)') -1,PX,PARAM

cp1new
C
C*********************************************************************
C
C       OPEN DIRECT ACCESS FILE FOR STORING BENDING WAVEFUNCTIONS
C
C*********************************************************************
C
      OPEN(UNIT=NFIL7,STATUS='SCRATCH',ACCESS='DIRECT',
     1     RECL=16*NSTINT,ERR=1009)
C
C
C*********************************************************************
C
C       OPEN DIRECT ACCESS FILE FOR STORING CALCULATED ENERGIES
C
C*********************************************************************
C
      NREC2=0
      DO 7777 I=1,NISOT
      KREC=(IQUANT(1,I)+1)*(IQUANT(2,I)+1)*(IQUANT(4,I)+IQUANT(5,I))
      IF (KREC .GT. NREC2) NREC2=KREC
7777  CONTINUE
      IWRKST=2*NREC2+1
      OPEN(UNIT=NFIL16,STATUS='SCRATCH',ACCESS='DIRECT',
     1     RECL=8*NREC2,ERR=1009)
C
C*********************************************************************
C
C     START ITERATION FOR LEAST SQUARES FITTING
C
C*********************************************************************
C
      ITER=0
      DO 9964 ITAU=1,2
      DO 9964 IEO=1,2
      DO 9964 JJ=1,MAXJP1
      DO 9964 I=1,ISOMAX
9964  SKPSYM(ITAU,IEO,JJ,I)=.TRUE.
      I=0
2000  I=I+1
2002  READ(NFIL5,*) ISO,JP,IEOP,TAUP,NUMBP,
     1      JM,IEOM,TAUM,NUMBM,FREQ,WGT
      IF (ISO.LE.0) GOTO 2100
      IF (JP .GT. IQUANT(1,ISO) .OR. JM .GT. IQUANT(1,ISO))
     .   GOTO 2002
      ISOT(I)=ISO
      JU(I)=JP
      IEOU(I)=IEOP
      TAUU(I)=TAUP
      NUMBU(I)=NUMBP
      SKPSYM(TAUP+1,IEOP+1,JP+1,ISO)=.FALSE.
      JL(I)=JM
      IEOL(I)=IEOM
      TAUL(I)=TAUM
      NUMBL(I)=NUMBM
      SKPSYM(TAUM+1,IEOM+1,JM+1,ISO)=.FALSE.
      OBS(I)=FREQ
      WT(I)=5.0*WGT
      GOTO 2000
2100  NOBS=I-1
      NUSED=0
      DO 400 I=1,NOBS
      IF (WT(I).GT.0.0D0) NUSED=NUSED+1
400   CONTINUE

CXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

C     ADDED BY IVO FORSUNG CHI MBAPEH    22.05.2014
C     READING IN THE AB-INITIAL DATA POINT

      READ(NFIL5,*) ABIFAC
      NUSEDAB=0
      IF(ISO.EQ.-1) GOTO 9922
C     
      I=0
1000  I=I+1
      READ(NFIL5,*,END=120) R1P(I),R3P(I),ALPP(I),R1M(I),
     1                      R3M(I),ALPM(I),EABI(I),WTABI(I)
      IF (R1P(I) .LT. 0.0d+00) GOTO 120  
      WT(I+NOBS)=ABIFAC* WTABI(I)
      IF (WT(I+NOBS).GT.0.0D0) NUSEDAB=NUSEDAB+1
      GOTO 1000
120   CONTINUE
      NABIUSE = I - 1   
9922  CONTINUE
      NUSEDT=NUSED+NUSEDAB

CXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

      NEXAB= NOBS+NABIUSE
      WRITE(NFIL6,*)'EXPP, ABIP, TOTAL INPUT:',NOBS, NABIUSE, NEXAB
      WRITE(NFIL6,5054)
5054  FORMAT(3X(A,"-----------------------------------------------"))
      IF (NEXAB.EQ.0) GOTO 2125
      
      READ(NFIL5,5100) NUMPAR,MAXIT,NJACOB
      READ(NFIL5,*) SCFAC
      IF (NJACOB .GT. 0) THEN
      READ (NFIL5,5101) MAXLIN,MAXCON
      READ (NFIL5,5102) (JVAR(JJ),JJ=1,55)
C
      DO 6504 JJ=1,MAXLIN
      READ (NFIL18,6506) CHDUMM
6506  FORMAT(A1)
      L=-4
6508  L=L+5
      IF (L .GT. MAXCON) GOTO 6504
      II=L+4
      IF (II .GT. MAXCON) II=MAXCON
      READ (NFIL18,*) (RJACIN(JJ,IJ),IJ=L,II)
      GOTO 6508
6504  CONTINUE
C
      KK=0
      DO 7000 I=1,NUMPAR
7010  KK=KK+1
      IF (JVAR(KK) .LE. 0) GOTO 7010
      DO 7020 JJ=1,NOBS
7020  RJACOB(JJ,I)=RJACIN(JJ,KK)
7000  CONTINUE
      ENDIF
C
      WRITE(NFIL6,6400)
      DO 6450 I=1,PARMAX
      IF (IVAR(I).GT.0) WRITE(NFIL6,6500) I,PX(I)
6450  CONTINUE
6400  FORMAT('0',5X,12('*'),' PARAMETERS TO BE VARIED IN',
     1     ' LSQ FIT ',12('*')//)
6500  FORMAT(' ',17X,I2,'.',4X,A6)
      WRITE(NFIL6,5555)
5555  FORMAT(3X(A,"-----------------------------------------------")) 
      GOTO 2150
C
C*********************************************************************
C
C      NOBS=0 -> STRAIGHT THROUGH CALCULATION
C
C*********************************************************************
C
2125  IPRINT=1
C
      DO 9963 I=1,NISOT
      REWIND NFIL1
      REWIND NFIL2
      REWIND NFIL3
      REWIND NFIL4
      REWIND NFIL8
      REWIND NFIL9
      REWIND NFIL10
      REWIND NFIL11
      REWIND NFIL12
      REWIND NFIL13
      REWIND NFIL14
      REWIND NFIL15
      M1=AMASS(1,I)
      M2=AMASS(2,I)
      M3=AMASS(3,I)
      M=M1+M2+M3
      SYMM=(POTSYM .AND. DABS(M1-M3) .LT. 1.0D-30)
      JMAX=IQUANT(1,I)
      V2MAX=IQUANT(2,I)
      MBASIS=IQUANT(3,I)
      LSTYPA(1)=IQUANT(4,I)
      LSTYPA(2)=IQUANT(5,I)
      V2MXP1=V2MAX+1
      JMAXP1=JMAX+1
      IF (POTSYM) THEN
            CALL CRESYM(PARAM)
      ELSE
            CALL CREASY(PARAM)
      ENDIF
      DO 9961 ITAU=1,2
      DO 9961 IEO=1,2
      DO 9961 JJ=1,JMAXP1
9961  SKPSYM(ITAU,IEO,JJ,I)=.FALSE.
C
C*********************************************************************
C
C       SET UP PARAMETERS FOR DIFFERENT POTENTIAL EXPANSION
C
C*********************************************************************
C
      CALL POTTYP
9963  CALL ECALC ( IWRKST , NREC2 ,
     1             SKPSYM , MXJVP1 , I )
      CALL PRTITO
      STOP
C
C
C***** NORMALIZATION OF WEIGHTS
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     Modified by ifo Forsung
C
2150  WTSUM=0.0D0
      DO 2200 I=1,NEXAB
2200  WTSUM=WTSUM+WT(I)
      WTSUM=WTSUM/NEXAB
      DO 2300 I=1,NEXAB
2300  WT(I)=WT(I)/WTSUM

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      N=0
      DO 2310 I=1,PARMAX
      IF (IVAR(I).GT.0) IVAR(I)=1
      IF (IVAR(I).NE.1) IVAR(I)=0
      N=N+IVAR(I)
      IF (IVAR(I).EQ.1) INDUX(N)=I
2310  CONTINUE
      IF (N.EQ.NUMPAR) GOTO 2320
      WRITE(NFIL6,2315) N,NUMPAR
2315  FORMAT ('0>>>> NUMPAR CALCULATED FROM IVAR, ',I2,
     1      ' DOES NOT EQUAL VALUE ENTERED, ',I2/
     2      ' >>>> PROGRAM TERMINATES')
      STOP
2320  CONTINUE

2330  SSQ=0.0D0
      DO 2360 ISO=1,ISOMAX
      IYN=0
cpl
      DO 2340 I=1,NOBS
      IF (ISOT(I).EQ.ISO) IYN=1
2340  CONTINUE
      STADEV(ISO)=0.0D0
      NOLIN(ISO)=0.0D0
      IF (IYN.EQ.0) GOTO 2360
      IPRINT=0
      I=ISO
      REWIND NFIL1
      REWIND NFIL2
      REWIND NFIL3
      REWIND NFIL4
      REWIND NFIL8
      REWIND NFIL9
      REWIND NFIL10
      REWIND NFIL11
      REWIND NFIL12
      REWIND NFIL13
      REWIND NFIL14
      REWIND NFIL15
      M1=AMASS(1,I)
      M2=AMASS(2,I)
      M3=AMASS(3,I)
      M=M1+M2+M3
      SYMM=(POTSYM .AND. DABS(M1-M3) .LT. 1.0D-30)
      JMAX=IQUANT(1,I)
      V2MAX=IQUANT(2,I)
      MBASIS=IQUANT(3,I)
      LSTYPA(1)=IQUANT(4,I)
      LSTYPA(2)=IQUANT(5,I)
      V2MXP1=V2MAX+1
      JMAXP1=JMAX+1
      IF (POTSYM) THEN
            CALL CRESYM(PARAM)
      ELSE
            CALL CREASY(PARAM)
      ENDIF
      CALL POTTYP
      CALL ECALC ( IWRKST , NREC2 ,
     1             SKPSYM , MXJVP1 , ISO )
cpl
      DO 2350 I=1,NOBS
      IF (ISOT(I).NE.ISO) GOTO 2350
      IREC21=4*JU(I)+2*TAUU(I)+IEOU(I)+1
      READ(NFIL16,REC=IREC21) (WORK(L), L=1,NREC2)
      IREC22=4*JL(I)+2*TAUL(I)+IEOL(I)+1
      READ(NFIL16,REC=IREC22) (WORK(NREC2+L), L=1,NREC2)
      KRP=NUMBU(I)
      KRM=NUMBL(I)
      OCLC(I)=WORK(KRP) - WORK(NREC2+KRM)
      EPSI(I) = OBS(I) - OCLC(I)
      SSQ = SSQ + EPSI(I)**2*WT(I)
      STADEV(ISO)=STADEV(ISO)+EPSI(I)**2
      NOLIN(ISO)=NOLIN(ISO)+1
2350  CONTINUE
      STADEV(ISO)=DSQRT(STADEV(ISO)/NOLIN(ISO))
2360  CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     ADDED BY IVO FORSUNG CHI MBAPEH     16.06.2014
      STADEVABI = 0
      SSQQ = 0
      IF (NABIUSE.EQ.0) GOTO 9935
      DO 2361 I = 1, NABIUSE

      ECLCABI(I) = POTVAL(R1P(I),R3P(I),ALPP(I))
     1             - POTVAL(R1M(I),R3M(I),ALPM(I)) 

c     EABI(I)=DABS(EABI(I))
C     ECLCABI(I)=DABS(ECLCABI(I))

      EPSI(I+NOBS) = HARTRE*EABI(I) - ECLCABI(I)
      SSQQ = SSQQ + EPSI(I+NOBS)**2*WT(I+NOBS)
      STADEVABI=STADEVABI+EPSI(I+NOBS)**2  
2361  CONTINUE
      STADEVABI= DSQRT(STADEVABI/NABIUSE)
      SSQ = SSQ + SSQQ
 9935 continue

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      STDEV=DSQRT(SSQ/(NUSEDT-NUMPAR))
      IF (ITER .EQ. 0 .OR. ITER .EQ. MAXIT) THEN
      WRITE(NFIL6,5300)
cpl
      DO 2365 I=1,NOBS
      ISO=ISOT(I)
      IEOP=IEOU(I)+1
      KSYMP=TAUU(I)+1
      M1=AMASS(1,ISO)
      M3=AMASS(3,ISO)
      IF (POTSYM .AND. DABS(M1-M3) .LT. 1.0D-30) THEN
             LSYM=SYMSYM(KSYMP,IEOP)
      ELSE
             LSYM=ASYSYM(KSYMP)
      ENDIF
      WRITE(NFIL6,5400) ISO,JU(I),LSYM,NUMBU(I)
      IEOM=IEOL(I)+1
      KSYMM=TAUL(I)+1
      IF (POTSYM .AND. DABS(M1-M3) .LT. 1.0D-30) THEN
             LSYM=SYMSYM(KSYMM,IEOM)
      ELSE
             LSYM=ASYSYM(KSYMM)
      ENDIF
      WRITE(NFIL6,5450) JL(I),LSYM,NUMBL(I),
     1      OBS(I),OCLC(I),EPSI(I),WT(I)
2365  CONTINUE

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     ADDED BY IVO FORSUNG CHI MABPEH    22.05.2014
C     CALCULATING THE POTENTIAL ENERGY FUNCTION VALUES DIFFERENCES AT EACH POINTS
      IF (NABIUSE.EQ.0) GOTO 9934
      WRITE(NFIL6,5053)
      WRITE(NFIL6,5051)
      WRITE(NFIL6,5052)
      DO I = 1, NABIUSE
      ECLCABI(I) = POTVAL(R1P(I),R3P(I),ALPP(I))
     1             - POTVAL(R1M(I),R3M(I),ALPM(I)) 

c     ECLCABI(I)=DABS(ECLCABI(I))

      EABIO   = HARTRE*EABI(I) 
      DELABI(I) = EABIO - ECLCABI(I) 
      WRITE(NFIL6,5050) R1P(I),R3P(I),ALPP(I),R1M(I),R3M(I),
     1        ALPM(I),EABIO,ECLCABI(I),DELABI(I),WT(I+NOBS)

      ENDDO
 9934 continue

5053  FORMAT(3X(A,"-----------------------------------------------"))    
5051  FORMAT(6X,'R1P',9X,'R3P',9X,'ALPP',8X,'R1M',9X,'R3M',9X,
     1          'ALPM',5X,'EABIO',6X,'ECLCABI',8X,'DELABI',8X,'WTABI')
5052  FORMAT(3X(A,"-----------------------------------------------"))
5050  FORMAT(F10.4,2X,F10.4,2X,F10.2,2X,F10.4,2X,F10.4,2X,
     1          F10.2,2X,F10.4,2X,F10.4,2X,F10.4,2X,F15.8)   
   
      ENDIF
 
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      WRITE(NFIL6,5550) ITER,NUSEDT,STDEV
      WRITE(NFIL6,7299)
      DO 2366 I=1,NISOT
2366  WRITE(NFIL6,7300) I,NOLIN(I),STADEV(I)
      WRITE(NFIL6,7301) NABIUSE, STADEVABI
7301  FORMAT(' ',17X,'FOR ',I5,' AB INITIO DATA POINTS, ',
     1              'THE RMS DEVIATION IS:  ',E10.5/)
      
cp1new

c     WRITE(45,'(I5,5E20.5)')
c    1       ITER,STDEV, ( STADEV(I), I= 1,NISOT ), STADEVABI 
      
cp1new

      IF (ITER.EQ.MAXIT) GOTO 2610
      IF (ITER.GT.0) GOTO 2540
      IF (NJACOB .LE. 0) THEN
C
      DO 2400 IPRM=1,NUMPAR
      L=INDUX(IPRM)
      OLDP=PARAM(L)
      PARAM(L)=OLDP*1.002D0
      IF (OLDP.EQ.0) PARAM(L)=1.0D+02
      DO 2390 ISO=1,ISOMAX
      IYN=0
cpl
      DO 2370 I=1,NOBS
      IF (ISOT(I).EQ.ISO) IYN=1
2370  CONTINUE
      IF (IYN.EQ.0) GOTO 2390
      I=ISO
      IPRINT=0
      REWIND NFIL1
      REWIND NFIL2
      REWIND NFIL3
      REWIND NFIL4
      REWIND NFIL8
      REWIND NFIL9
      REWIND NFIL10
      REWIND NFIL11
      REWIND NFIL12
      REWIND NFIL13
      REWIND NFIL14
      REWIND NFIL15
      M1=AMASS(1,I)
      M2=AMASS(2,I)
      M3=AMASS(3,I)
      M=M1+M2+M3
      SYMM=(POTSYM .AND. DABS(M1-M3) .LT. 1.0D-30)
      JMAX=IQUANT(1,I)
      V2MAX=IQUANT(2,I)
      MBASIS=IQUANT(3,I)
      LSTYPA(1)=IQUANT(4,I)
      LSTYPA(2)=IQUANT(5,I)
      V2MXP1=V2MAX+1
      JMAXP1=JMAX+1
      IF (POTSYM) THEN
            CALL CRESYM(PARAM)
      ELSE
            CALL CREASY(PARAM)
      ENDIF
      CALL POTTYP
      CALL ECALC ( IWRKST , NREC2 ,
     1             SKPSYM , MXJVP1 , ISO )
cpl
      DO 2380 I=1,NOBS
      IF (ISOT(I).NE.ISO) GOTO 2380
      IREC21=4*JU(I)+2*TAUU(I)+IEOU(I)+1
      READ(NFIL16,REC=IREC21) (WORK(LL), LL=1,NREC2)
      IREC22=4*JL(I)+2*TAUL(I)+IEOL(I)+1
      READ(NFIL16,REC=IREC22) (WORK(NREC2+LL), LL=1,NREC2)
      KRP=NUMBU(I)
      KRM=NUMBL(I)
      CALC(I)=WORK(KRP) - WORK(NREC2+KRM)
      RJACOB(I,IPRM)=(CALC(I)-OCLC(I))/(PARAM(L)-OLDP)
2380  CONTINUE
2390  CONTINUE
      PARAM(L)=OLDP
2400  CONTINUE
ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
C     Added by Ivo Forsung Chi Mbapeh
C     Calculating the Jacobian Matrix for the ab initio data.
      IF (NABIUSE.EQ.0) GOTO 9933

      DO I=1,NABIUSE
      r1pi=r1p(i)
      r3pi=r3p(i)
      alpi=alpp(i)
      r1mi=r1m(i)
      r3mi=r3m(i)
      almi=alpm(i)
      CALL DERVAL(DERIVP,R1PI,R3PI,ALPI )
      CALL DERVAL(DERIVM,R1MI,R3MI,ALMI )  

      DO IPRM=1,NUMPAR
      L=INDUX(IPRM)
      OLDP=PARAM(L)
      PARAM(L)=OLDP*1.002D0
      IF (OLDP.EQ.0) PARAM(L)=1.0D+02
      RJACOB(I+NOBS,IPRM) = DERIVP(L+1)-DERIVM(L+1)
      PARAM(L) = OLDP
      ENDDO
      ENDDO     
     
9933  CONTINUE
ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc

      WRITE(NFIL6,5500)
c
cpl
      DO 2470 I=1,NEXAB
      WRITE(NFIL6,2450)
2450  FORMAT(' ')
      L=-4
2460  L=L+5
      IF (L.GT.NUMPAR) GOTO 2470
      II=L+4
      IF (II.GT.NUMPAR) II=NUMPAR
      WRITE(NFIL6,5600) (RJACOB(I,IJ), IJ=L,II)
      GOTO 2460
2470  CONTINUE
C
      ENDIF
C
C
C
C***** FORM THE PRODUCT (J TRANSPOSE) J
C
C
      DO 2490 I=1,NUMPAR
      DO 2490 J=I,NUMPAR
      T=0.0D0
cpl
      DO 2480 K=1,NEXAB
2480  T=T+RJACOB(K,I)*RJACOB(K,J)*WT(K)
      RJTJ(I,J)=T
2490  RJTJ(J,I)=T
      DO 500 I=1,NUMPAR
500   SC(I)=DSQRT(RJTJ(I,I))
      DO 510 I=1,NUMPAR
      DO 510 J=1,NUMPAR
510   RJTJ(I,J)=RJTJ(I,J)/(SC(I)*SC(J))

C
C
C***** INVERT THE MATRIX (J TRANSPOSE) J; PLACE IN RJTJ
C
C
      CALL SOLVEX(RJTJ,PARMAX,NUMPAR,NUMPAR,PREC,DET,TEST)
      IF (TEST.EQ.0.0D0) GOTO 2510
      WRITE(NFIL6,2500) TEST
2500  FORMAT('0>>>> SOLVEX FAILED, TEST = ',D11.5)
      STOP
2510  NPM1=NUMPAR-1
      DO 520 I=1,NUMPAR
      DO 520 J=1,NUMPAR
520   RJTJ(I,J)=RJTJ(I,J)/(SC(I)*SC(J))
      IF (NPM1.EQ.0) GOTO 2540
      WRITE(NFIL6,5700)
      DO 2530 I=1,NPM1
      IP1=I+1
      DO 2520 J=IP1,NUMPAR
      X=RJTJ(I,J)/DSQRT(RJTJ(I,I)*RJTJ(J,J))
2520  WRITE(NFIL6,5800) I,J,X
2530  CONTINUE
2540  CONTINUE

      DO 2560 I=1,NUMPAR
      T=0.0D0
cpl
      DO 2550 K=1,NEXAB
2550  T=T+RJACOB(K,I)*EPSI(K)*WT(K)
2560  RJTE(I)=T
      DO 2570 L=1,NUMPAR
      I=INDUX(L)
2570  PAROLD(I)=PARAM(I)
C
      DO 2590 I=1,NUMPAR
      T=0.0D0
      L=INDUX(I)
      SD(L)=DSQRT(RJTJ(I,I))*STDEV
      CRR(L)=(SD(L)*SC(I)/STDEV)**2
      DO 2580 K=1,NUMPAR
2580  T=T+RJTJ(I,K)*RJTE(K)
2590  PARAM(L)=PARAM(L)+SCFAC*T
C
      WRITE(NFIL6,5900)
      DO 2600 L=1,NUMPAR
      I=INDUX(L)
      EPSIL=PARAM(I)-PAROLD(I)
2600  WRITE(NFIL6,5905) PX(I),PAROLD(I),PARAM(I),EPSIL,SD(I),
     1      CRR(I)

cp1new
      WRITE(40,'(I10,55A6,55E20.10)') ITER,PX,PARAM
cp1new

      CALL PRTIIT( ITER , OLDTIM , OLDVEC )
      ITER=ITER+1
      GOTO 2330

2610  CONTINUE
      CALL PRTITO
      STOP
1009  WRITE (NFIL6,1070)
1070  FORMAT(' MORBID.LSQ.ERR  SCRATCH FILE COULD NOT OPEN'//)
      STOP


C
C  THIS IS THE END OF THE MORBID PROGRAM.
C
5100  FORMAT(3I3)
5101  FORMAT(2I4)
5102  FORMAT(55I1)
C5300  FORMAT('1',16X,'ISOT.',3X,'J',2X,'SYM.',1X,'IDENT.',
C     1      4X,'NUOBS',10X,'NUCALC',8X,'OBS-CALC',
C     1      9X,'WEIGHT'/)
5300  FORMAT('1',10X,'ISOT.',1X,'J',1X,'SYM.',1X,'IDENT.',
     1       3X,'NUOBS',6X,'NUCALC',5X,'OBS-CALC',
     1       4X,'WEIGHT'/)
C	5400  FORMAT('0 UPPER STATE: ',3X,I2,4X,I2,2X,A4,2X,I2)
5400  FORMAT('UPP.STATE:',2X,I2,2X,I2,2X, A4,I2)
C       5450  FORMAT('  LOWER STATE: ',9X,I2,2X,A4,2X,I2,3F15.5,I2,F15.8)
5450  FORMAT('LOW.STATE: ',5X,I2,2X,A4,I2,4F12.5)
5500  FORMAT('0 THE JACOBIAN MATRIX: ')
5501  FORMAT('0 JACOBIAN MATRIX READ FROM DATA SET: ')
5550  FORMAT(///'   FOR ITERATION ',I2,' OVER ALL ',I5,
     1      ' DATA POINTS USED, THE WEIGHTED STANDARD DEVIATION IS ',
     2      E10.5)
5600  FORMAT(' ',5E20.10)
5601  FORMAT(1X,5E20.10)
5700  FORMAT('0 THE CORRELATION COEFFICIENTS: ')
5800  FORMAT('0',10X,'CORR(',I2,',',I2,') = ',F10.7)
5900  FORMAT(///8X,78('-')/8X,':     OLD PARM     :',
     1      '     NEW PARM     : DELTA PARM :  STD. ERR. :',
     1      '  (CORR-1)  :'/8X,78('-'))
5905  FORMAT(A8,2(':',E17.10,1X),':',
     1      3(E12.5,':'))
7299  FORMAT('0',5X,12('*'),' RMS DEVIATIONS ',12('*')//)
7300  FORMAT(' ',17X,'FOR ISOTOPE [ ',I2,', THERE ARE ',I3,
     2              ' LINES WITH AN RMS DEVIATION OF: ',E10.5/)
      END
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
c     ADDED BY IVO FORSUNG CHI MBAPEH 22.05.2014
C     FUNCTION TO CALCULATE THE POTENTIAL ENERGY
C		FUNCTION VALUES FROM THE AB-INITIAL DATA
C
C     CALCULATE POTENTIAL ENERGY FUNCTION VALUES
C

      REAL*8 FUNCTION POTVAL(R1V, R3V, ALPHADV)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8  M1 , M2 , M3 , M 
      LOGICAL SYMM
      INTEGER PRTINT
      
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT

      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM

      ALPHA=ALPHADV*PI/1.8E+02
      R12=R1V
      R32=R3V
      CORO=COS(RHOE)+COS(ALPHA)
      Y1=1.0E+00-EXP(-AA1*(R12-RE12))
      Y3=1.0E+00-EXP(-AA3*(R32-RE32))

      V0=VE+FA1*CORO+FA2*CORO**2+FA3*CORO**3+FA4*CORO**4+FA5*CORO**5
     1    +FA6*CORO**6+FA7*CORO**7+FA8*CORO**8
      FE1= F1A1*CORO+F2A1*CORO**2+F3A1*CORO**3+F4A1*CORO**4
      FE3= F1A3*CORO+F2A3*CORO**2+F3A3*CORO**3+F4A3*CORO**4
      FE11= F11+F1A11*CORO+F2A11*CORO**2+F3A11*CORO**3
      FE33= F33+F1A33*CORO+F2A33*CORO**2+F3A33*CORO**3
      FE13= F13+F1A13*CORO+F2A13*CORO**2+F3A13*CORO**3
      FE111= F111+F1A111*CORO+F2A111*CORO**2
      FE333= F333+F1A333*CORO+F2A333*CORO**2
      FE113= F113+F1A113*CORO+F2A113*CORO**2
      FE133= F133+F1A133*CORO+F2A133*CORO**2
      FE1111= F1111+FA1111*CORO
      FE3333= F3333+FA3333*CORO
      FE1113= F1113+FA1113*CORO
      FE1333= F1333+FA1333*CORO
      FE1133= F1133+FA1133*CORO
      POTVAL   =   V0+FE1*Y1+FE3*Y3
     1         +FE11*Y1**2+FE33*Y3**2+FE13*Y1*Y3
     2         +FE111*Y1**3+FE333*Y3**3+FE113*Y1**2*Y3
     3         +FE133*Y1*Y3**2
     4         +FE1111*Y1**4+FE3333*Y3**4+FE1113*Y1**3*Y3
     5         +FE1333*Y1*Y3**3+FE1133*Y1**2*Y3**2
     
      RETURN
      END


CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C     ADDED BY IVO FORSUNG CHI MBAPEH     23.05.2014
C     CALCULATE DERIVATIVES WITH RESPECT TO PARAMETERS

      SUBROUTINE DERVAL(DERIVS,R1V,R3V,ALPHADV)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1 , M2 , M3 , M, DERIVS(56)
      LOGICAL SYMM
      INTEGER PRTINT
      
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      ALPHA=ALPHADV*PI/1.8E+02
      R12=R1V                 
      R32=R3V                     
      CORO=COS(RHOE)+COS(ALPHA)
      Y1=1.0E+00-EXP(-AA1*(R12-RE12))
      Y3=1.0E+00-EXP(-AA3*(R32-RE32))
C
C CALCULATE POTENTIAL ENERGY FUNCTION VALUES
C
      V0=VE+FA1*CORO+FA2*CORO**2+FA3*CORO**3+FA4*CORO**4+FA5*CORO**5
     1    +FA6*CORO**6+FA7*CORO**7+FA8*CORO**8
      FE1= F1A1*CORO+F2A1*CORO**2+F3A1*CORO**3+F4A1*CORO**4
      FE3= F1A3*CORO+F2A3*CORO**2+F3A3*CORO**3+F4A3*CORO**4
      FE11= F11+F1A11*CORO+F2A11*CORO**2+F3A11*CORO**3
      FE33= F33+F1A33*CORO+F2A33*CORO**2+F3A33*CORO**3
      FE13= F13+F1A13*CORO+F2A13*CORO**2+F3A13*CORO**3
      FE111= F111+F1A111*CORO+F2A111*CORO**2
      FE333= F333+F1A333*CORO+F2A333*CORO**2
      FE113= F113+F1A113*CORO+F2A113*CORO**2
      FE133= F133+F1A133*CORO+F2A133*CORO**2
      FE1111= F1111+FA1111*CORO
      FE3333= F3333+FA3333*CORO
      FE1113= F1113+FA1113*CORO
      FE1333= F1333+FA1333*CORO
      FE1133= F1133+FA1133*CORO
      V   =   V0+FE1*Y1+FE3*Y3
     1         +FE11*Y1**2+FE33*Y3**2+FE13*Y1*Y3
     2         +FE111*Y1**3+FE333*Y3**3+FE113*Y1**2*Y3
     3         +FE133*Y1*Y3**2
     4         +FE1111*Y1**4+FE3333*Y3**4+FE1113*Y1**3*Y3
     5         +FE1333*Y1*Y3**3+FE1133*Y1**2*Y3**2
C
C CALCULATE DERIVATIVES WITH RESPECT TO PARAMETERS
C
      DCODR=-SIN(RHOE)
      DY1DR1=-AA1*(1.0E+00-Y1)
      DY3DR3=-AA3*(1.0E+00-Y3)
      DY1DA1=(R12-RE12)*(1.0E+00-Y1)
      DY3DA3=(R32-RE32)*(1.0E+00-Y3)
      D0=(FA1+2.0E0*FA2*CORO+3.0E0*FA3*CORO**2+4.0E0*FA4*CORO**3
     1  +5.0E0*FA5*CORO**4+6.0E0*FA6*CORO**5+7.0E0*FA7*CORO**6
     2  +8.0E0*FA8*CORO**7)*DCODR
      DE1=(F1A1+2.0E0*F2A1*CORO+3.0E0*F3A1*CORO**2
     1   +4.0E0*F4A1*CORO**3)*DCODR
      DE3=(F1A3+2.0E0*F2A3*CORO+3.0E0*F3A3*CORO**2
     1   +4.0E0*F4A3*CORO**3)*DCODR
      DE11= (F1A11+2.0E0*F2A11*CORO+3.0E0*F3A11*CORO**2)*DCODR
      DE33= (F1A33+2.0E0*F2A33*CORO+3.0E0*F3A33*CORO**2)*DCODR
      DE13= (F1A13+2.0E0*F2A13*CORO+3.0E0*F3A13*CORO**2)*DCODR
      DE111= (F1A111+2.0E0*F2A111*CORO)*DCODR
      DE333= (F1A333+2.0E0*F2A333*CORO)*DCODR
      DE113= (F1A113+2.0E0*F2A113*CORO)*DCODR
      DE133= (F1A133+2.0D0*F2A133*CORO)*DCODR
      DE1111= FA1111*DCODR
      DE3333= FA3333*DCODR
      DE1113= FA1113*DCODR
      DE1333= FA1333*DCODR
      DE1133= FA1133*DCODR
C
C VE
C
      DERIVS(1)=1.0D+00
C
C RHOE
C
      DERIVS(2)  =  D0+DE1*Y1+DE3*Y3
     1         +DE11*Y1**2+DE33*Y3**2+DE13*Y1*Y3
     2         +DE111*Y1**3+DE333*Y3**3+DE113*Y1**2*Y3
     3         +DE133*Y1*Y3**2
     4         +DE1111*Y1**4+DE3333*Y3**4+DE1113*Y1**3*Y3
     5         +DE1333*Y1*Y3**3+DE1133*Y1**2*Y3**2
C
C R12
C
      DERIVS(3) =   FE1*DY1DR1
     1         +2.0D0*FE11*Y1*DY1DR1+FE13*DY1DR1*Y3
     2         +3.0D0*FE111*Y1**2*DY1DR1+2.0D0*FE113*Y1*DY1DR1*Y3
     3         +FE133*DY1DR1*Y3**2
     4         +4.0D0*FE1111*Y1**3*DY1DR1+3.0D0*FE1113*Y1**2
     5         *DY1DR1*Y3
     6         +FE1333*DY1DR1*Y3**3+2.0E0*FE1133*Y1*DY1DR1*Y3**2
C
C RE32
C
      DERIVS(4) =   FE3*DY3DR3
     3         +2.0E0*FE33*Y3*DY3DR3+FE13*DY3DR3*Y1
     2         +3.0E0*FE333*Y3**2*DY3DR3+2.0E0*FE133*Y3*DY3DR3*Y1
     1         +FE113*DY3DR3*Y1**2
     4         +4.0E0*FE3333*Y3**3*DY3DR3+3.0E0*FE1333*Y3**2
     5         *DY3DR3*Y1
     6         +FE1113*DY3DR3*Y1**3+2.0E0*FE1133*Y3*DY3DR3*Y1**2
C
C AA1
C
      DERIVS(5) =   FE1*DY1DA1
     1         +2.0E0*FE11*Y1*DY1DA1+FE13*DY1DA1*Y3
     2         +3.0E0*FE111*Y1**2*DY1DA1+2.0E0*FE113*Y1*DY1DA1*Y3
     3         +FE133*DY1DA1*Y3**2
     4         +4.0E0*FE1111*Y1**3*DY1DA1+3.0E0*FE1113*Y1**2
     5         *DY1DA1*Y3
     6         +FE1333*DY1DA1*Y3**3+2.0E0*FE1133*Y1*DY1DA1*Y3**2
C
C AA3
C
      DERIVS(6) =   FE3*DY3DA3
     3         +2.0E0*FE33*Y3*DY3DA3+FE13*DY3DA3*Y1
     2         +3.0E0*FE333*Y3**2*DY3DA3+2.0E0*FE133*Y3*DY3DA3*Y1
     1         +FE113*DY3DA3*Y1**2
     4         +4.0E0*FE3333*Y3**3*DY3DA3+3.0E0*FE1333*Y3**2
     5         *DY3DA3*Y1
     6         +FE1113*DY3DA3*Y1**3+2.0E0*FE1133*Y3*DY3DA3*Y1**2
C
C FA1
C
      DERIVS(7)=CORO
C
C FA2
C
      DERIVS(8)=CORO**2
C
C FA3
C
      DERIVS(9)=CORO**3
C
C FA4
C
      DERIVS(10)=CORO**4
C
C FA5
C
      DERIVS(11)=CORO**5
C
C FA6
C
      DERIVS(12)=CORO**6
C
C FA7
C
      DERIVS(13)=CORO**7
C
C FA8
C
      DERIVS(14)=CORO**8
C
C F1A1
C
      DERIVS(15)=CORO*Y1
C
C F2A1
C
      DERIVS(16)=CORO**2*Y1
C
C F3A1
C
      DERIVS(17)=CORO**3*Y1
C
C F4A1
C
      DERIVS(18)=CORO**4*Y1
C
C F1A3
C
      DERIVS(19)=CORO*Y3
C
C F2A3
C
      DERIVS(20)=CORO**2*Y3
C
C F3A3
C
      DERIVS(21)=CORO**3*Y3
C
C F4A3
C
      DERIVS(22)=CORO**4*Y3
C
C F11
C
      DERIVS(23)=Y1*Y1
C
C F1A11
C
      DERIVS(24)=CORO*Y1*Y1
C
C F2A11
C
      DERIVS(25)=CORO**2*Y1*Y1
C
C F3A11
C
      DERIVS(26)=CORO**3*Y1*Y1
C
C F33
C
      DERIVS(27)=Y3*Y3
C
C F1A33
C
      DERIVS(28)=CORO*Y3*Y3
C
C F2A33
C
      DERIVS(29)=CORO**2*Y3*Y3
C
C F3A33
C
      DERIVS(30)=CORO**3*Y3*Y3
C
C F13
C
      DERIVS(31)=Y1*Y3
C
C F1A13
C
      DERIVS(32)=CORO*Y1*Y3
C
C F2A13
C
      DERIVS(33)=CORO**2*Y1*Y3
C
C F3A13
C
      DERIVS(34)=CORO**3*Y1*Y3
C
C F111
C
      DERIVS(35)=Y1*Y1*Y1
C
C F1A111
C
      DERIVS(36)=CORO*Y1*Y1*Y1
C
C F2A111
C
      DERIVS(37)=CORO**2*Y1*Y1*Y1
C
C F333
C
      DERIVS(38)=Y3*Y3*Y3
C
C F1A333
C
      DERIVS(39)=CORO*Y3*Y3*Y3
C
C F2A333
C
      DERIVS(40)=CORO**2*Y3*Y3*Y3
C
C F113
C
      DERIVS(41)=Y1*Y1*Y3
C
C F1A113
C
      DERIVS(42)=CORO*Y1*Y1*Y3
C
C F2A113
C
      DERIVS(43)=CORO**2*Y1*Y1*Y3
C
C F133
C
      DERIVS(44)=Y1*Y3*Y3
C
C F1A133
C
      DERIVS(45)=CORO*Y1*Y3*Y3
C
C F2A133
C
      DERIVS(46)=CORO**2*Y1*Y3*Y3
C
C F1111
C
      DERIVS(47)=Y1*Y1*Y1*Y1
C
C F21111
C
      DERIVS(48)=CORO*Y1*Y1*Y1*Y1
C
C F3333
C
      DERIVS(49)=Y3*Y3*Y3*Y3
C
C F23333
C
      DERIVS(50)=CORO*Y3*Y3*Y3*Y3
C
C F1113
C
      DERIVS(51)=Y1*Y1*Y1*Y3
C
C F21113
C
      DERIVS(52)=CORO*Y1*Y1*Y1*Y3
C
C F1333
C
      DERIVS(53)=Y1*Y3*Y3*Y3
C
C F21333
C
      DERIVS(54)=CORO*Y1*Y3*Y3*Y3
C
C F1133
C
      DERIVS(55)=Y1*Y1*Y3*Y3
C
C F21133
C
      DERIVS(56)=CORO*Y1*Y1*Y3*Y3
      RETURN 
      END
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC

      BLOCK DATA
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8  M1 , M2 , M3 , M
      LOGICAL SYMM
      INTEGER PRTINT
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      DATA VELLGT/2.99792458D+10/,PLANCK/6.6260755D-27/,
     1    AVOGNO/6.0221367D+23/, PI/3.14159265359D+00/,
     2    PREC/0.5D-30/
      DATA NFIL1/1/,NFIL2/2/,NFIL3/3/,NFIL4/4/,NFIL5/5/,
     1    NFIL6/6/,NFIL7/7/,NFIL8/8/,NFIL9/9/,NFIL10/10/,
     2    NFIL11/11/,NFIL12/12/,NFIL13/13/,NFIL14/14/,NFIL15/15/,
     3    NFIL16/16/,NFIL17/17/,NFIL18/18/,NFIL19/19/,NFIL20/20/
      DATA ITEST/0/
      DATA SYMM/.FALSE./
C
      END
C
C
      SUBROUTINE CREASY(PARAM)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 PARAM(55),M1,M2,M3,M
      LOGICAL SYMM
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
C
      RHOE=PARAM(1)
      RE12=PARAM(2)
      RE32=PARAM(3)
      AA1=PARAM(4)
      AA3=PARAM(5)
      FA1=PARAM(6)
      FA2=PARAM(7)
      FA3=PARAM(8)
      FA4=PARAM(9)
      FA5=PARAM(10)
      FA6=PARAM(11)
      FA7=PARAM(12)
      FA8=PARAM(13)
      F1A1=PARAM(14)
      F2A1=PARAM(15)
      F3A1=PARAM(16)
      F4A1=PARAM(17)
      F1A3=PARAM(18)
      F2A3=PARAM(19)
      F3A3=PARAM(20)
      F4A3=PARAM(21)
      F11=PARAM(22)
      F1A11=PARAM(23)
      F2A11=PARAM(24)
      F3A11=PARAM(25)
      F33=PARAM(26)
      F1A33=PARAM(27)
      F2A33=PARAM(28)
      F3A33=PARAM(29)
      F13=PARAM(30)
      F1A13=PARAM(31)
      F2A13=PARAM(32)
      F3A13=PARAM(33)
      F111=PARAM(34)
      F1A111=PARAM(35)
      F2A111=PARAM(36)
      F333=PARAM(37)
      F1A333=PARAM(38)
      F2A333=PARAM(39)
      F113=PARAM(40)
      F1A113=PARAM(41)
      F2A113=PARAM(42)
      F133=PARAM(43)
      F1A133=PARAM(44)
      F2A133=PARAM(45)
      F1111=PARAM(46)
      FA1111=PARAM(47)
      F3333=PARAM(48)
      FA3333=PARAM(49)
      F1113=PARAM(50)
      FA1113=PARAM(51)
      F1333=PARAM(52)
      FA1333=PARAM(53)
      F1133=PARAM(54)
      FA1133=PARAM(55)
      RETURN
      END
C
C
      SUBROUTINE CRESYM(PARAM)
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 PARAM(55),M1,M2,M3,M
      LOGICAL SYMM
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      RHOE=PARAM(1)
      RE12=PARAM(2)
      RE32=PARAM(2)
      AA1=PARAM(3)
      AA3=PARAM(3)
      FA1=PARAM(4)
      FA2=PARAM(5)
      FA3=PARAM(6)
      FA4=PARAM(7)
      FA5=PARAM(8)
      FA6=PARAM(9)
      FA7=PARAM(10)
      FA8=PARAM(11)
      F1A1=PARAM(12)
      F2A1=PARAM(13)
      F3A1=PARAM(14)
      F4A1=PARAM(15)
      F1A3=PARAM(12)
      F2A3=PARAM(13)
      F3A3=PARAM(14)
      F4A3=PARAM(15)
      F11=PARAM(16)
      F1A11=PARAM(17)
      F2A11=PARAM(18)
      F3A11=PARAM(19)
      F33=PARAM(16)
      F1A33=PARAM(17)
      F2A33=PARAM(18)
      F3A33=PARAM(19)
      F13=PARAM(20)
      F1A13=PARAM(21)
      F2A13=PARAM(22)
      F3A13=PARAM(23)
      F111=PARAM(24)
      F1A111=PARAM(25)
      F2A111=PARAM(26)
      F333=PARAM(24)
      F1A333=PARAM(25)
      F2A333=PARAM(26)
      F113=PARAM(27)
      F1A113=PARAM(28)
      F2A113=PARAM(29)
      F133=PARAM(27)
      F1A133=PARAM(28)
      F2A133=PARAM(29)
      F1111=PARAM(30)
      FA1111=PARAM(31)
      F3333=PARAM(30)
      FA3333=PARAM(31)
      F1113=PARAM(32)
      FA1113=PARAM(33)
      F1333=PARAM(32)
      FA1333=PARAM(33)
      F1133=PARAM(34)
      FA1133=PARAM(35)
      RETURN
      END
C
C
      SUBROUTINE DEFASY(PARAM)
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 PARAM(55),M1,M2,M3,M
      LOGICAL SYMM
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      PARAM(1)=RHOE
      PARAM(2)=RE12
      PARAM(3)=RE32
      PARAM(4)=AA1
      PARAM(5)=AA3
      PARAM(6)=FA1
      PARAM(7)=FA2
      PARAM(8)=FA3
      PARAM(9)=FA4
      PARAM(10)=FA5
      PARAM(11)=FA6
      PARAM(12)=FA7
      PARAM(13)=FA8
      PARAM(14)=F1A1
      PARAM(15)=F2A1
      PARAM(16)=F3A1
      PARAM(17)=F4A1
      PARAM(18)=F1A3
      PARAM(19)=F2A3
      PARAM(20)=F3A3
      PARAM(21)=F4A3
      PARAM(22)=F11
      PARAM(23)=F1A11
      PARAM(24)=F2A11
      PARAM(25)=F3A11
      PARAM(26)=F33
      PARAM(27)=F1A33
      PARAM(28)=F2A33
      PARAM(29)=F3A33
      PARAM(30)=F13
      PARAM(31)=F1A13
      PARAM(32)=F2A13
      PARAM(33)=F3A13
      PARAM(34)=F111
      PARAM(35)=F1A111
      PARAM(36)=F2A111
      PARAM(37)=F333
      PARAM(38)=F1A333
      PARAM(39)=F2A333
      PARAM(40)=F113
      PARAM(41)=F1A113
      PARAM(42)=F2A113
      PARAM(43)=F133
      PARAM(44)=F1A133
      PARAM(45)=F2A133
      PARAM(46)=F1111
      PARAM(47)=FA1111
      PARAM(48)=F3333
      PARAM(49)=FA3333
      PARAM(50)=F1113
      PARAM(51)=FA1113
      PARAM(52)=F1333
      PARAM(53)=FA1333
      PARAM(54)=F1133
      PARAM(55)=FA1133
      RETURN
      END
C
C
      SUBROUTINE DEFSYM(PARAM)
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 PARAM(55),M1,M2,M3,M
      LOGICAL SYMM
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      PARAM(1)=RHOE
      PARAM(2)=RE12
      PARAM(3)=AA1
      PARAM(4)=FA1
      PARAM(5)=FA2
      PARAM(6)=FA3
      PARAM(7)=FA4
      PARAM(8)=FA5
      PARAM(9)=FA6
      PARAM(10)=FA7
      PARAM(11)=FA8
      PARAM(12)=F1A1
      PARAM(13)=F2A1
      PARAM(14)=F3A1
      PARAM(15)=F4A1
      PARAM(16)=F11
      PARAM(17)=F1A11
      PARAM(18)=F2A11
      PARAM(19)=F3A11
      PARAM(20)=F13
      PARAM(21)=F1A13
      PARAM(22)=F2A13
      PARAM(23)=F3A13
      PARAM(24)=F111
      PARAM(25)=F1A111
      PARAM(26)=F2A111
      PARAM(27)=F113
      PARAM(28)=F1A113
      PARAM(29)=F2A113
      PARAM(30)=F1111
      PARAM(31)=FA1111
      PARAM(32)=F1113
      PARAM(33)=FA1113
      PARAM(34)=F1133
      PARAM(35)=FA1133
      RETURN
      END
C
C
      SUBROUTINE SOLVEX (X,IX,M,N,PREC,DET,TEST)
      IMPLICIT REAL*8   (A-H,O-Z)
C
      INTEGER I1(255), I2(255)
      REAL*8   X(55,55),T,DET,BIG,PREC,TEST,PIV,TEMP
      EQUIVALENCE (BIG,TEMP,PIV)
C
C     INITIALIZATION
C
      DET = 1.D0
      TEMP = DABS(PREC)
      IF (TEMP .EQ. 0.D0)  TEMP = 0.5D-14
      TEST = 0.D0
      DO 1 I = 1,M
      I2(I) = 0
      DO 1 J = 1,M
1     TEST = TEST + X(I,J) * X(I,J)
      TEST = TEMP * DSQRT(TEST) / M
C
C     SEARCH FOR NEXT PIVOT, AVOIDING ROWS AND COLUMNS WHICH ALREADY
C     CONTAIN A PIVOT.
C
      DO 9 K = 1,M
      BIG = 0.D0
      DO 3 I = 1,M
      IF (I2(I) .NE. 0) GO TO 3
      DO 2 J = 1,M
      IF (I2(J) .NE. 0) GO TO 2
      T =DABS(X(I,J))
      IF (T .LE. BIG) GO TO 2
      BIG = T
      IROW = I
      JCOL = J
2     CONTINUE
3     CONTINUE
      IF (BIG .LE. TEST) RETURN
C
C     RECORD POSITION OF PIVOT THEN MOVE PIVOTAL ROW SO PIVOT LIES ON
C     THE DIAGONAL. SCALE PIVOTAL ROW.
C
      I1(K) = JCOL
      I2(JCOL) = IROW
      IF (JCOL .EQ. IROW) GO TO 6
      DO 5 J = 1,N
      TEMP = X(IROW,J)
      X(IROW,J) = X(JCOL,J)
5     X(JCOL,J) = TEMP
      DET = -DET
6     DET = DET * X(JCOL,JCOL)
      PIV = 1.D0/X(JCOL,JCOL)
      DO 7 J = 1,N
      IF (J .NE. JCOL)  X(JCOL,J) = PIV * X(JCOL,J)
7     CONTINUE
      X(JCOL,JCOL) = PIV
C
C     ELIMINATE REMAINING ROWS.
C
      DO 9 I = 1,M
      IF (I .EQ. JCOL)  GO TO 9
      PIV = -X(I,JCOL)
      DO 8 J = 1,N
      IF (J .NE. JCOL)  X(I,J) = X(I,J) + PIV * X(JCOL,J)
8     CONTINUE
      X(I,JCOL) = PIV * X(JCOL,JCOL)
9     CONTINUE
C
C     UNSCRAMBLE THE COLUMNS OF THE INVERSE ACCORDING TO THE ORIGINAL
C     POSITIONS OF THE PIVOTS.
C
      DO 11 K = 1,M
      I = M+1 - K
      JCOL = I1(I)
      IROW = I2(JCOL)
      IF (IROW .EQ. JCOL)  GO TO 11
      DO 10 I = 1,M
      TEMP = X(I,IROW)
      X(I,IROW) = X(I,JCOL)
10    X(I,JCOL) = TEMP
11    CONTINUE
      TEST = 0.D0
      RETURN
      END
C
C
      SUBROUTINE NAMESY ( PX )
      IMPLICIT REAL*8 (A-H,O-Z)
      CHARACTER*6 PX(55)
      PX(  3 ) = PX(  4 )
      PX(  4 ) = PX(  6 )
      PX(  5 ) = PX(  7 )
      PX(  6 ) = PX(  8 )
      PX(  7 ) = PX(  9 )
      PX(  8 ) = PX( 10 )
      PX(  9 ) = PX( 11 )
      PX( 10 ) = PX( 12 )
      PX( 11 ) = PX( 13 )
      PX( 12 ) = PX( 14 )
      PX( 13 ) = PX( 15 )
      PX( 14 ) = PX( 16 )
      PX( 15 ) = PX( 17 )
      PX( 16 ) = PX( 22 )
      PX( 17 ) = PX( 23 )
      PX( 18 ) = PX( 24 )
      PX( 19 ) = PX( 25 )
      PX( 20 ) = PX( 30 )
      PX( 21 ) = PX( 31 )
      PX( 22 ) = PX( 32 )
      PX( 23 ) = PX( 33 )
      PX( 24 ) = PX( 34 )
      PX( 25 ) = PX( 35 )
      PX( 26 ) = PX( 36 )
      PX( 27 ) = PX( 40 )
      PX( 28 ) = PX( 41 )
      PX( 29 ) = PX( 42 )
      PX( 30 ) = PX( 46 )
      PX( 31 ) = PX( 47 )
      PX( 32 ) = PX( 50 )
      PX( 33 ) = PX( 51 )
      PX( 34 ) = PX( 54 )
      PX( 35 ) = PX( 55 )
      RETURN
      END
C
C
      SUBROUTINE HOUEIG(N,A,D,E,MAXIT,IFAIL)
      IMPLICIT REAL*8 (A-H,O-Z)
C      FUNKTION: DIAGONALISERER EN SYMMETRISK, REEL MATRIX.
C      KALD: CALL HOUEIG(N,A,D,E,*)
C      FORMELLE PARAMETRE
C        INTEGER N
C        REAL*8   A(N,N),D(N),E(N)
C      DATA
C        N ORDENEN AF MATRICEN.
C        A MATRICEN, SOM SKAL DIAGONALISERES. KUN DEN NEDRE TREKANT ANVE
C          I BEREGNINGERNE.
C        D INDEHOLDER EGENVAERDIERNE I STIGENDE ORDEN.
C        E ER ET ARBEJDSOMRAADE, SOM BLOT SKAL VAERE ERKLAERET I HOVED-
C          PROGRAMMET.
C    MAXIT MAXIMUM NUMBER OF ITERATIONS ALLOWED IN DETERMINING AN
C          EIGENVALUE.
C    IFAIL RETURN VALUE, =1 IF THE DETERMINATION OF AN EIGENVALUES REQUI
C          MORE THAN MAXIT ITERATIONS, =0 OTHERWISE.
C      KOMMENTARER: ANVENDER HOUSEHOLDERS TRIDIAGONALISERING EFTERFULGT
C        QL METODEN.
C      FORFATTER: OVERSAETTELSE OG SAMMENSKRIVNING AF 'TRED' OG 'TQL2'
C        VED S. BRODERSEN. 1981.
C      LITTERATUR: W&R 217-218 OG 233-234.

      INTEGER N,IFAIL,MAXIT
      REAL*8   A(N,N),D(N),E(N),F,G,H,HH,MCHEPS,B,C,P,R,S,TOL
      IFAIL=0
      MCHEPS=2.0D0**(-52)
      TOL=2.0D0**(52-260)
      DO 10 I=N,2,-1
      L=I-2
      F=A(I,I-1)
      G=0.0D0
      DO 1000 K=1,L
1000  G=G+A(I,K)* A(I,K)
      H=G+F*F
      IF(G .LE. TOL) THEN
      E(I)=F
      H=0.0D0
      GOTO 10
      ENDIF
      L=L+1
      IF (F .GE. 0.0D0) THEN
      E(I)=-DSQRT(H)
      ELSE
      E(I)=DSQRT(H)
      ENDIF
      G=E(I)
      H=H-F*G
      A(I,I-1)=F-G
      F=0.0D0
      DO 1300 J=1,L
      A(J,I)=A(I,J)/H
      G=0.0D0
      DO 1100 K=1,J
1100  G=G+A(J,K)*A(I,K)
      DO 1200 K=(J+1),L
1200  G=G+A(K,J)*A(I,K)
      E(J)=G/H
      F=F+G*A(J,I)
1300  CONTINUE
      HH=F/(H+H)
      DO 1500 J=1,L
      F=A(I,J)
      E(J)=E(J)-HH*F
      G=E(J)
      DO 1400 K=1,J
1400  A(J,K)=A(J,K)-F*E(K)-G*A(I,K)
1500  CONTINUE
10    D(I)=H

      E(1)=0.0D0
      D(1)=0.0D0
      DO 2000 I=1,N
2000  D(I)=A(I,I)

      DO 2100 I=2,N
2100  E(I-1)=E(I)
      E(N)=0.0D0
      B=0.0D0
      F=0.0D0
      JJ=0
      DO 30 L=1,N
      J=0
      H=MCHEPS*(DABS(D(L))+DABS(E(L)))
      IF (B .LT. H) B=H
      DO 2200 M=L,N
      IF (DABS(E(M)) .LE. B) GOTO 35
2200  CONTINUE
35    IF (M .EQ. L)  GOTO 30
40    IF (J .EQ. MAXIT) THEN
      IFAIL=1
      RETURN
      ENDIF
      J=J+1
      JJ=JJ+1
      G=D(L)
      P=(D(L+1)-G)/(2.0D0*E(L))
      R=DSQRT(P**2+1)
      IF (P .LT. 0.0D0) THEN
      D(L)=E(L)/(P-R)
      ELSE
      D(L)=E(L)/(P+R)
      ENDIF
      H=G-D(L)
      DO 2300 I=L+1,N
2300  D(I)=D(I)-H
      F=F+H
      P=D(M)
      C=1.0D0
      S=0.0D0
      DO 2500 I=M-1,L,-1
      G=C*E(I)
      H=C*P
      IF (DABS(P) .GE.DABS(E(I))) THEN
      C=E(I)/P
      R=DSQRT(C**2+1.0D0)
      E(I+1)=S*P*R
      S=C/R
      C=1.0D0/R
      ELSE
      C=P/E(I)
      R=DSQRT(C**2+1)
      E(I+1)=S*E(I)*R
      S=1.0D0/R
      C=C/R
      ENDIF
      P=C*D(I)-S*G
      D(I+1)=H+S*(C*G+S*D(I))
2500  CONTINUE
      E(L)=S*P
      D(L)=C*P
      IF(DABS(E(L)) .GT. B) GOTO 40
30    D(L)=D(L)+F
      DO 2800 I=1,N
      K=I
      P=D(I)
      DO 2600 J=I+1,N
      IF (D(J) .LT. P) THEN
      K=J
      P=D(J)
      ENDIF
2600  CONTINUE
      IF (K .NE. I) THEN
      D(K)=D(I)
      D(I)=P
      ENDIF
2800  CONTINUE
      RETURN
      END
C
C
      SUBROUTINE YP(IOSC,IW1,IW2,OVER,H)
C     --------------------(P1*Y1+Y1*P1)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF((IR.EQ.IC).OR.(JR.NE.JC))GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP1=1.0D0-RJ+RJ*(2.0D0*RN+RJ+1.0D0)/(RMK(IOSC)*2.0D0)
      RP1=RP1*OVER(IOSC,IR+1,IC+1)*RLS(IR,IC)
      RP=RP1
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE Y2P(IOSC,IW1,IW2,OVER,H)
C     --------------------(Y1*Y1*P1+P1*Y1*Y1)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF((IR.EQ.IC).OR.(JR.NE.JC))GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      AL=(RMK(IOSC)-RN)*2.0D0-1.0D0
      RP1=1.0D0-RJ*(AL-RJ)/RMK(IOSC)
      RP=RJ**4+AL*AL*(RJ+1.0D0)*RJ
      RP3=RJ*(AL-RJ)*(2.0D0*RN+1.0D0)-AL*RJ*RJ*(2.0D0*RJ+1.0D0)
      RP1=(RP1+(RP+RP3)/(8.0D0*RMK(IOSC)*RMK(IOSC)))*
     1      OVER(IOSC,IR+1,IC+1)*RLS(IR,IC)
      RP=RP1
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE P1Y2(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(P1*Y2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.EQ.IC)GOTO 1
      RP1=0.5D0*OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      IF(JR.NE.JC)GOTO 2
      RP2=(DFLOAT(JR)+0.5D0)/RMK(IOSC2)
      GOTO 3
2     RP2=-OVER(IOSC2,JR+1,JC+1)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
3     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE P1Y2Y2(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(P1*Y2*Y2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.EQ.IC)GOTO 1
      RP1=0.5D0*OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      IF(JR.NE.JC)GOTO 2
      RP2=(DFLOAT(JR)+0.5D0)/RMK(IOSC2)
      GOTO 3
2     RN=RLN(JR,JC)
      RJ=DABS(DFLOAT(JR-JC))
      RP2=(RJ-1.D0)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
      RP2=RP2-RJ*(2.0D0*RN+RJ+1.0D0)/(4.0D0*RMK(IOSC2)*RMK(IOSC2))
      RP2=RP2*OVER(IOSC2,JR+1,JC+1)
3     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE Y3P(IOSC,IW1,IW2,OVER,H)
C     --------------------(Y1*Y1*Y1*P1+P1*Y1*Y1*Y1)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RQ,RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF((IR.EQ.IC).OR.(JR.NE.JC))GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      AL=2.0D0*(RMK(IOSC)-RN) - 1.0D0
      RQ=RN+AL-RJ
      RP1=1.0D0-3.0D0*RJ*(AL-RJ)/(2.0D0*RMK(IOSC))
      RP1=RP1
     1     +3.0D0*(RJ**4+AL**2*RJ*(RJ+1.0D0)
     1     -AL*RJ**2*(2.0D0*RJ+1.0D0)
     1     +RJ*(AL-RJ)*(2.0D0*RN+1.0D0))/(8.0D0*RMK(IOSC)**2)
      RP2=(AL+3.0D0)*(0.5D0*RJ*(RJ-1.0D0)*(RQ+2.0D0)*(RQ+1.0D0)
     1     -RJ**2*RN*(RQ+1.0D0)+0.5D0*RJ*(RJ+1.0D0)*RN*(RN-1.0D0)
     1     +RN*RQ+2.0D0*RJ*(RQ+1.0D0)*(RN+RQ+2.0D0)
     1     -2.0D0*RN*RJ*(RN+RQ)+(RN+1.0D0)*(RQ+1.0D0)+(RN+RQ+1.0D0)**2)
      RP2=RP2
     1     +2.0D0*(0.5D0*RJ*(RJ-1.0D0)*(RQ+2.0D0)*(RQ+1.0D0)*RN
     1     -RJ**2*(RQ+1.0D0)*RN*(RN-1.0D0)+0.5D0*RJ*(RJ+1.0D0)*
     1     RN*(RN-1.0D0)*(RN-2.0D0)
     1     +RJ*(RQ+1.0D0)*RN*(2.0D0*RN+3.0D0*RQ+4.0D0)
     1     -RJ*RN*(RN-1.0D0)*(2.0D0*RN+3.0D0*RQ-1.0D0)
     1     +RN*(RN+1.0D0)*(RQ+1.0D0)
     1     +RN*(RN+2.0D0*RQ+1.0D0)*(RN+RQ+1.0D0)
     1     +RQ*(2.0D0*RN+RQ+1.0D0))
      RP2=RP2-
     1     (RJ*(RJ-1.0D0)*(RJ-2.0D0)*(RQ+3.0D0)*(RQ+2.0D0)*(RQ+1.0D0)
     1 /6.0D0
     1     -0.5D0*RJ**2*(RJ-1.0D0)*(RQ+2.0D0)*(RQ+1.0D0)*RN
     1     +0.5D0*RJ**2*(RJ+1.0D0)*(RQ+1.0D0)*RN*(RN-1.0D0)
     1     -RJ*(RJ+1.0D0)*(RJ+2.0D0)*RN*(RN-1.0D0)*(RN-2.0D0)/6.0D0
     1     +1.5D0*RJ*(RJ-1.0D0)*(RQ+2.0D0)*(RQ+1.0D0)*(RN+RQ+3.0D0))
      RP2=RP2-
     1     (-3.0D0*RJ**2*(RQ+1.0D0)*RN*(RN+RQ+1.0D0)
     1     +1.5D0*RJ*(RJ+1.0D0)*(RN-1.0D0)*RN*(RN+RQ-1.0D0)
     1     +RJ*(RQ+1.0D0)*((RN+2.0D0)*(RQ+2.0D0)
     1     +2.0D0*(RN+RQ+2.0D0)*(RN+RQ+3.0D0)+(RN+1.0D0)*(RQ+1.0D0)
     1     +(RN+RQ+1.0D0)**2+RN*RQ)
     1     -RJ*RN*((RN+1.0D0)*(RQ+1.0D0)+2.0D0*(RN+RQ)*(RN+RQ+1.0D0)
     1     +RN*RQ+(RN+RQ-1.0D0)**2+(RN-1.0D0)*(RQ-1.0D0))
     1     +2.0D0*(RN+1.0D0)*(RQ+1.0D0)*(RN+RQ+2.0D0)
     1     +(RN+RQ+1.0D0)*((RN+1.0D0)*(RQ+1.0D0)
     1     +(RN+RQ+1.0D0)**2+RN*RQ)+2.0D0*RN*RQ*(RN+RQ))
      RP1=RP1+RP2/(8.0D0*RMK(IOSC)**3)
      RP2=RP1*OVER(IOSC,IR+1,IC+1)*RLS(IR,IC)
      RP=RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE YPY(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     -----------------Y2*(P1*Y1+Y1*P1)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.EQ.IC)GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP1=1.0D0-RJ+RJ*(2.0D0*RN+RJ+1.0D0)/(RMK(IOSC1)*2.0D0)
      RP1=RP1*OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      IF(JR.NE.JC)GOTO 2
      RP2=(DFLOAT(JR)+0.5D0)/RMK(IOSC2)
      GOTO 3
2     RP2=-OVER(IOSC2,JR+1,JC+1)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
3     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE PY3(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(P1*Y2*Y2*Y2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.EQ.IC)GOTO 1
      RP1=0.5D0*OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      IF(JR.NE.JC)GOTO 2
      RN=DFLOAT(JR)
      RP2=1.5D0*(RN+0.5D0)*(RN+0.5D0)/(RMK(IOSC2)*RMK(IOSC2))
      RP2=RP2-1.0D0/(8.0D0*RMK(IOSC2)*RMK(IOSC2))
      RP2=RP2-RN*(2.0D0*RN*RN+3.0D0*RN+1.0D0)/(4.0D0*RMK(IOSC2)**3)
      GOTO 3
2     RJ=DABS(DFLOAT(JR-JC))
      RN=RLN(JR,JC)
      RP2=(RJ-1.0D0)*(2.0D0-RJ)/(4.0D0*AAS(IOSC2)*RMK(IOSC2))
      RP=(RJ-2.0D0)*(2.0D0*RJ+1.0D0)*(2.0D0*RN+RJ+1.0D0)
      RP2=(RP2+RP/(8.0D0*AAS(IOSC2)*RMK(IOSC2)**2))
     1                           *OVER(IOSC2,JR+1,JC+1)
3     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE Y2PY(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(Y1*Y1*P1+P1*Y1*Y1)*Y2
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.EQ.IC)GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      AL=(RMK(IOSC1)-RN)*2.0D0-1.0D0
      RP1=1.0D0-RJ*(AL-RJ)/RMK(IOSC1)
      RP=RJ**4+AL*AL*(RJ+1.0D0)*RJ
      RP3=RJ*(AL-RJ)*(2.0D0*RN+1.0D0)-AL*RJ*RJ*(2.0D0*RJ+1.0D0)
      RP1=(RP1+(RP+RP3)/(8.0D0*RMK(IOSC1)*RMK(IOSC1)))*
     1      OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      IF(JR.NE.JC)GOTO 2
      RP2=(DFLOAT(JR)+0.5D0)/RMK(IOSC2)
      GOTO 3
2     RP2=-OVER(IOSC2,JR+1,JC+1)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
3     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE YPY2(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(P1*Y1+Y1*P1)*Y2*Y2
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.EQ.IC)GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP1=1.0D0-RJ+RJ*(2.0D0*RN+RJ+1.0D0)/(RMK(IOSC1)*2.0D0)
      RP1=RP1*OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      IF(JR.NE.JC)GOTO 2
      RN=DFLOAT(JR)
      RP2=(RN+0.5D0)/RMK(IOSC2)
      GOTO 3
2     RN=RLN(JR,JC)
      RJ=DABS(DFLOAT(JR-JC))
      RP2=(RJ-1.0D0)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
      RP2=RP2-RJ*(2.0D0*RN+RJ+1.0D0)/(4.0D0*AAS(IOSC2)*RMK(IOSC2)**2)
      RP2=RP2*OVER(IOSC2,JR+1,JC+1)
3     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE MOPARM ( IW1 , IW3 , OVER )
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER V1P1,KBAS,ISUMP1,ISUM,II,NOSC
      REAL*8 COEFK1,COEFK3
      INTEGER IW1(LENIW),IW3(LENIW)
      REAL*8  OVER(2,MBASP1,MBASP1)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
C SET UP THE V1 AND V3 QUANTUM NUMBERS FULFILLING V1+V3 .LE. MBASIS
C
      NOBAS=MBASP1*(MBASP1+1)/2
      KBAS=0
      DO 200 ISUMP1=1,MBASP1
      ISUM=ISUMP1-1
      DO 100 V1P1=1,ISUMP1
      V1=V1P1-1
      V3=ISUM-V1
      IF (V1 .GT. V3) GOTO 100
      KBAS=KBAS+1
      IW1(KBAS)=V1
      IW3(KBAS)=V3
      IF (V1 .EQ. V3) GOTO 100
      KBAS=KBAS+1
      IW1(KBAS)=V3
      IW3(KBAS)=V1
100   CONTINUE
200   CONTINUE
C
C COUNT HOW MANY A AND B FUNCTIONS THERE ARE, STORE IN KSTYPA
C
      IF ( SYMM ) GOTO 300
      KSTYPA(1)=NOBAS
      KSTYPA(2)=0
      GOTO 500
300   KSTYPA(1)=0
      KSTYPA(2)=0
      DO 400 II=1,NOBAS
      V1=IW1(II)
      V3=IW3(II)
      IF (V3 .LT. V1) GOTO 400
      KSTYPA(1)=KSTYPA(1)+1
      IF (V3 .EQ. V1) GOTO 400
      KSTYPA(2)=KSTYPA(2)+1
400   CONTINUE
500   CONTINUE
      IF (LSTYPA(1) .GT. KSTYPA(1)) LSTYPA(1)=KSTYPA(1)
      IF (LSTYPA(2) .GT. KSTYPA(2)) LSTYPA(2)=KSTYPA(2)
      IF (IPRINT .NE. 0) THEN
      WRITE (NFIL6,1500) NOBAS,KSTYPA(1),KSTYPA(2)
      WRITE (NFIL6,1100)
      DO 220 II=1,NOBAS
220   WRITE (NFIL6,1200) II,IW1(II),IW3(II)
      WRITE (NFIL6,1400)
      ENDIF
C
C CALCULATE K VALUES FOR THE TWO MORSE OSCILLATORS; STORE IN RMK
C
      COEFK1=2.0D-08*PI*DSQRT(VELLGT/PLANCK/AVOGNO)/AA1
      RMK(1)=COEFK1*DSQRT(2.0D0*F11*M1*M2/(M1+M2))
      AAS(1)=AA1
      COEFK3=2.0D-08*PI*DSQRT(VELLGT/PLANCK/AVOGNO)/AA3
      RMK(2)=COEFK3*DSQRT(2.0D0*F33*M3*M2/(M3+M2))
      AAS(2)=AA3
C   PRB
      IF (IPRINT .NE. 0) THEN
             WRITE (NFIL6,1600) RMK(1)
             WRITE (NFIL6,1610) RMK(2)
      ENDIF
C
C CALCULATE ONE-DIMENSIONAL OVERLAP INTEGRALS
C
      NOSC=1
      IF (.NOT.SYMM) NOSC=2
      CALL OVRLAP(NOSC,OVER)
C
1100  FORMAT('0',5X,12('*'),' VIBRATIONAL BASIS  ',12('*')////
     1      ' ',10X,33('-')/' ',10X,'I',10X,'I',20X,'I'/
     2      ' ',10X,'I',2X,'FCT. #',2X,'I',4X,'N1',8X,'N2',4X,'I'/
     3      ' ',10X,'I',10X,'I',20X,'I'/' ',10X,33('-')/
     4      ' ',10X,'I',10X,'I',20X,'I')
1200  FORMAT(' ',10X,'I',3X,I4,3X,'I',3X,I4,6X,I4,3X,'I')
1400  FORMAT(' ',10X,33('-')///)
1500  FORMAT('1',5X,12('*'),' VIBRATIONAL BASIS FUNCTIONS ',
     1 12('*')////
     2 ' ',17X,'TOTAL NUMBER OF MORSE OSCILLATOR FUNCTIONS ',I3/
     3 ' ',17X,'NUMBER OF A1 FUNCTIONS                     ',I3/
     4 ' ',17X,'NUMBER OF B2 FUNCTIONS                     ',I3)
1600  FORMAT('1',5X,12('*'),' K VALUES ',12('*')////
     1      '0',17X,'OSCILLATOR 1-2 HAS K = ',F25.16/)
1610  FORMAT('0',17X,'OSCILLATOR 3-2 HAS K = ',F25.16/)
      RETURN
      END
C
C
      DOUBLE PRECISION FUNCTION RFACT(K)
      IMPLICIT REAL*8 (A-H,O-Z)
      A=1.D0
      IF(K.LT.2)GOTO 2
      DO 1 J=2,K
      AJ=DFLOAT(J)
1     A=A*AJ
2     RFACT=A
      RETURN
      END
C
C
C
C
C
      SUBROUTINE HOUSQL(NDIM,N,A,D,E,MAXIT,IFAIL)
      IMPLICIT REAL*8 (A-H,O-Z)
C PURPOSE:  DIAGONALIZES A SYMMETRICAL, REAL*8 MATRIX.
C CALL:     CALL HOUSQL(N,A,D,E,MAXIT,IFAIL)
C FORMAL PARAMETERS:
C         INTEGER N,IFAIL
C         REAL*8 A(NDIM,NDIM),D(NDIM),E(NDIM)
C INPUT/OUTPUT:
C     NDIM  DIMENSION OF THE ACTUAL ARRAY A USED IN THE CALL.
C     N     ORDER OF THE MATRIX.
C     A     MATRIX TO BE DIAGONALIZED. ONLY THE LOWER TRIANGLE IS USED.
C           CONTAINS ON RETURN THE EIGENVECTORS AS COLUMNS IN THE
C           ORDER OF THE CORRESPONDING EIGENVALUES.
C     D     CONTAINS ON RETURN THE EIGENVALUES IN INCREASING ORDER.
C     E     WORK AREA, MUST BE DECLARED IN THE CALLING SEGMENT.
C     MAXIT MAXIMUM NUMBER OF ITERATIONS ALLOWED IN THE QL CALCULATION.
C     IFAIL RETURN VALUE, =0 IF THE DIAGONALIZATION HAS REQUIRED LESS TH
C     THAN
C           MAXIT ITERATIONS, =1 IF MAXIT ITERATIONS HAVE BEEN CARRIED
C     OUT
C           WITHOUT CONVERGENCE.
C COMMENTS: USES HOUSHOLDERS TRIDIAGONALIZATION FOLLOWED BY THE
C           QL METHOD.
C AUTHOR:   TRANSLATION AND CONCATENATION OF 'TRED' OG 'TQL2'
C           BY S.BRODERSEN 1981.
C REFS:     WILKINSON & RHEINSCH 217-218 OG 233-234.

      INTEGER NDIM,N,IFAIL,MAXIT
      REAL*8 A(NDIM,NDIM),D(NDIM),E(NDIM),F,G,H,HH,MCHEPS,
     1      B,C,P,R,S,TOL
      IFAIL=0
      MCHEPS=2.0D0**(-52)
      TOL=2.0D0**(52-260)
      DO 10 I=N,2,-1
      L=I-2
      F=A(I,I-1)
      G=0.0D0
      DO 1000 K=1,L
1000  G=G+A(I,K)* A(I,K)
      H=G+F*F
      IF(G .LE. TOL) THEN
      E(I)=F
      H=0.0D0
      GOTO 10
      ENDIF
      L=L+1
      IF (F .GE. 0.0D0) THEN
      E(I)=-DSQRT(H)
      ELSE
      E(I)=DSQRT(H)
      ENDIF
      G=E(I)
      H=H-F*G
      A(I,I-1)=F-G
      F=0.0D0
      DO 1300 J=1,L
      A(J,I)=A(I,J)/H
      G=0.0D0
      DO 1100 K=1,J
1100  G=G+A(J,K)*A(I,K)
      DO 1200 K=(J+1),L
1200  G=G+A(K,J)*A(I,K)
      E(J)=G/H
      F=F+G*A(J,I)
1300  CONTINUE
      HH=F/(H+H)
      DO 1500 J=1,L
      F=A(I,J)
      E(J)=E(J)-HH*F
      G=E(J)
      DO 1400 K=1,J
1400  A(J,K)=A(J,K)-F*E(K)-G*A(I,K)
1500  CONTINUE
10    D(I)=H

      E(1)=0.0D0
      D(1)=0.0D0
      DO 2000 I=1,N
      L=I-1
      IF (D(I) .NE. 0.0D0) THEN
      DO 1800 J=1,L
      G=0.0D0
      DO 1600 K=1,L
1600  G=G+A(I,K)*A(K,J)
      DO 1700 K=1,L
1700  A(K,J)=A(K,J)-G*A(K,I)
1800  CONTINUE
      ENDIF
      D(I)=A(I,I)
      A(I,I)=1.0D0
      DO 1900 J=1,L
      A(J,I)=0.0D0
      A(I,J)=0.0D0
1900  CONTINUE
2000  CONTINUE
      DO 2100 I=2,N
2100  E(I-1)=E(I)
      E(N)=0.0D0
      B=0.0D0
      F=0.0D0
      JJ=0
      DO 30 L=1,N
      J=0
      H=MCHEPS*(DABS(D(L))+DABS(E(L)))
      IF (B .LT. H) B=H
      DO 2200 M=L,N
      IF (DABS(E(M)) .LE. B) GOTO 35
2200  CONTINUE
35    IF (M .EQ. L)  GOTO 30
40    IF (J .EQ. MAXIT) THEN
      IFAIL=1
      RETURN
      ENDIF
      J=J+1
      JJ=JJ+1
      G=D(L)
      P=(D(L+1)-G)/(2.0D0*E(L))
      R=DSQRT(P**2+1)
      IF (P .LT. 0.0D0) THEN
      D(L)=E(L)/(P-R)
      ELSE
      D(L)=E(L)/(P+R)
      ENDIF
      H=G-D(L)
      DO 2300 I=L+1,N
2300  D(I)=D(I)-H
      F=F+H
      P=D(M)
      C=1.0D0
      S=0.0D0
      DO 2500 I=M-1,L,-1
      G=C*E(I)
      H=C*P
      IF (DABS(P) .GE.DABS(E(I))) THEN
      C=E(I)/P
      R=DSQRT(C**2+1.0D0)
      E(I+1)=S*P*R
      S=C/R
      C=1.0D0/R
      ELSE
      C=P/E(I)
      R=DSQRT(C**2+1)
      E(I+1)=S*E(I)*R
      S=1.0D0/R
      C=C/R
      ENDIF
      P=C*D(I)-S*G
      D(I+1)=H+S*(C*G+S*D(I))
      DO 2400 K=1,N
      H=A(K,I+1)
      A(K,I+1)=S*A(K,I)+C*H
2400  A(K,I)=C*A(K,I)-S*H
2500  CONTINUE
      E(L)=S*P
      D(L)=C*P
      IF(DABS(E(L)) .GT. B) GOTO 40
30    D(L)=D(L)+F
      DO 2800 I=1,N
      K=I
      P=D(I)
      DO 2600 J=I+1,N
      IF (D(J) .LT. P) THEN
      K=J
      P=D(J)
      ENDIF
2600  CONTINUE
      IF (K .NE. I) THEN
      D(K)=D(I)
      D(I)=P
      DO 2700 J=1,N
      P=A(J,I)
      A(J,I)=A(J,K)
      A(J,K)=P
2700  CONTINUE
      ENDIF
2800  CONTINUE
      RETURN
      END
C
C
      SUBROUTINE PRTIIT( ITER , OLDTIM , OLDVEC )
      IMPLICIT REAL*8 (A-H,O-Z)
      DOUBLE PRECISION OLDTIM,NEWTIM,DELTIM,TIM1S,TIM2S
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      CALL CLOCKV ( VECTIM , NEWTIM , 1 , 2 )
      DELTIM = NEWTIM - OLDTIM
      DELVEC = VECTIM - OLDVEC
      TIM1S=DELTIM/1.0D+03
      TIM2S=NEWTIM/1.0D+03
      TIM3S=DELVEC/1.0D+03
      TIM4S=VECTIM/1.0D+03
      WRITE (NFIL6,2007) ITER, TIM1S, TIM3S, TIM2S, TIM4S
2007  FORMAT(1H0,'MORBID.TIM.INF  ITERATION ',I4,' : '/
     1   1H ,'                CPU TIME           ',F20.8,' SECONDS'/
     1   1H ,'                VECTOR TIME        ',F20.8,' SECONDS'/
     1   1H ,'                TOTAL CPU TIME     ',F20.8,' SECONDS'/
     1   1H ,'                TOTAL VECTOR TIME  ',F20.8,' SECONDS')
      OLDTIM=NEWTIM
      OLDVEC=VECTIM
      RETURN
      END
C   ***** PART 2 OF 4 *******
      SUBROUTINE U0VIB ( UVIVAL )
      IMPLICIT REAL*8 (A-H,O-Z)
C            :
C DATE       : 28.04.1986
C AUTHOR     : PER JENSEN
C UPDATES    :  CHANGED FROM G MATRIX CALCULATING ROUTINE TO U0VIB
C            :  CALCULATING ROUTINE 20.03.87
C LANGUAGE   : FORTRAN
C PURPOSE    : CALCULATION OF THE EXPANSION COEFFICIENTS OF THE G
C            : MATRIX ELEMENTS IN TERMS OF THE DELTA R I'S.
C            : THE CODE IS GENERATED BY REDUCE.
C            :  THE G MATRIX ELEMENTS ARE USED TO CALCULATE THE
C            :  LEADING (STRETCH INDEPENDENT) CONTRIBUTION TO THE
C            :  U0 PSEUDO POTENTIAL.
C            :
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      A11=2.D0*RE12
      A13=0.D0
      A111=(V**2-SR**2*U13**2+2.D0*SR**2*U3*U1)/(V**2+2.D0*V*SR**2*
     1 U13+SR**4*U13**2)
      A133=(SR**2*U3**2*RE12**2)/((V**2+2.D0*V*SR**2*U13+SR**4*U13
     1 **2)*RE32**2)
      A113=(2.D0*SR**2*U13*U3*CR*RE12)/((V**2+2.D0*V*SR**2*U13+SR**4
     1 *U13**2)*RE32)
      A31=0.D0
      A33=2.D0*RE32
      A311=(SR**2*U1**2*RE32**2)/((V**2+2.D0*V*SR**2*U13+SR**4*U13
     1 **2)*RE12**2)
      A333=(V**2-SR**2*U13**2+2.D0*SR**2*U3*U1)/(V**2+2.D0*V*SR**2*
     1 U13+SR**4*U13**2)
      A313=(2.D0*SR**2*U13*U1*CR*RE32)/((V**2+2.D0*V*SR**2*U13+SR**4
     1 *U13**2)*RE12)
      G110=1.0D+00/M1 + 1.0D+00/M2
      G130=-CR/M2
      G310=-CR/M2
      G330=1.0D+00/M3 + 1.0D+00/M2
      G11=G110
      G13=G130
      G31=G310
      G33=G330
      G111=(2.D0*G13*A133*B31+G13*B11*A113+2.D0*G11*B11*A111+G11*B31
     X *A113-2.D0*G11)/RE12
      G113=(2.D0*G13*A133*B33+G13*B13*A113+2.D0*G11*B13*A111+G11*B33
     X *A113)/RE12
      G1111=(8.D0*G13*A133*B311*RE12+8.D0*G13*A133*B11*A111*B31+4.D0*
     X G13*A133*B31**2*A113-16.D0*G13*A133*B31+4.D0*G13*B111*RE12*
     X A113+4.D0*G13*B11**2*A111*A113+2.D0*G13*B11*B31*A113**2-8.D0*
     X G13*B11*A113+4.D0*G33*A133**2*B31**2+4.D0*G33*A133*B11*B31*
     X A113+G33*B11**2*A113**2+8.D0*G11*B111*RE12*A111+4.D0*G11*B311
     X *RE12*A113+4.D0*G11*B11**2*A111**2+4.D0*G11*B11*A111*B31*A113
     X -16.D0*G11*B11*A111+G11*B31**2*A113**2-8.D0*G11*B31*A113+12.D0*
     X G11)/(4.D0*RE12**2)
      G1133=(8.D0*G13*A133*B333*RE12+8.D0*G13*A133*B13*B33*A111+4.D0*
     X G13*A133*B33**2*A113+4.D0*G13*B133*RE12*A113+4.D0*G13*B13**2*
     X A111*A113+2.D0*G13*B13*B33*A113**2+4.D0*G33*A133**2*B33**2+4.D0
     X *G33*A133*B13*B33*A113+G33*B13**2*A113**2+8.D0*G11*B133*
     X RE12*A111+4.D0*G11*B333*RE12*A113+4.D0*G11*B13**2*A111**2+4.D0*
     X G11*B13*B33*A111*A113+G11*B33**2*A113**2)/(4.D0*RE12**2)
      G1113=(4.D0*G13*A133*B313*RE12+4.D0*G13*A133*B13*A111*B31+4.D0*
     X G13*A133*B33*B11*A111+4.D0*G13*A133*B33*B31*A113-8.D0*G13*
     X A133*B33+2.D0*G13*B113*RE12*A113+4.D0*G13*B13*B11*A111*A113+
     X G13*B13*B31*A113**2-4.D0*G13*B13*A113+G13*B33*B11*A113**2+
     X 4.D0*G33*A133**2*B33*B31+2.D0*G33*A133*B13*B31*A113+2.D0*G33*
     X A133*B33*B11*A113+G33*B13*B11*A113**2+4.D0*G11*B113*RE12*
     X A111+2.D0*G11*B313*RE12*A113+4.D0*G11*B13*B11*A111**2+2.D0*G11*
     X B13*A111*B31*A113-8.D0*G11*B13*A111+2.D0*G11*B33*B11*A111*
     X A113+G11*B33*B31*A113**2-4.D0*G11*B33*A113)/(2.D0*RE12**2)
      G311=(2.D0*G13*A333*RE12*B31+2.D0*G13*RE32*B11*A111+G13*RE32*
     X B31*A113-2.D0*G13*RE32+G13*A313*RE12*B11+2.D0*G33*A133*RE32*
     X B31+G33*RE32*B11*A113+2.D0*G11*A311*RE12*B11+G11*A313*RE12*
     X B31)/(2.D0*RE32*RE12)
      G313=(2.D0*G13*A333*B33*RE12+2.D0*G13*RE32*B13*A111+G13*RE32*
     X B33*A113+G13*A313*B13*RE12-2.D0*G13*RE12+2.D0*G33*A133*RE32*
     X B33+G33*RE32*B13*A113+2.D0*G11*A311*B13*RE12+G11*A313*B33*
     X RE12)/(2.D0*RE32*RE12)
      G3111=(4.D0*G13*A333*B311*RE12**2+4.D0*G13*A333*RE12*B11*A111*
     X B31+2.D0*G13*A333*RE12*B31**2*A113-4.D0*G13*A333*RE12*B31+4.D0*
     X G13*A133*A311*RE12*B11*B31+2.D0*G13*A133*A313*RE12*B31**2+
     X 4.D0*G13*RE32*B111*RE12*A111+2.D0*G13*RE32*B311*RE12*A113-4.D0*
     X G13*RE32*B11*A111-2.D0*G13*RE32*B31*A113+4.D0*G13*RE32+2.D0*G13
     X *A311*RE12*B11**2*A113+2.D0*G13*A313*B111*RE12**2+2.D0*G13*
     X A313*RE12*B11**2*A111+2.D0*G13*A313*RE12*B11*B31*A113-2.D0*
     X G13*A313*RE12*B11+4.D0*G33*A333*A133*RE12*B31**2+2.D0*G33*
     X A333*RE12*B11*B31*A113+4.D0*G33*A133*RE32*B311*RE12-4.D0*G33*
     X A133*RE32*B31+2.D0*G33*A133*A313*RE12*B11*B31+2.D0*G33*RE32*
     X B111*RE12*A113-2.D0*G33*RE32*B11*A113+G33*A313*RE12*B11**2*
     X A113+4.D0*G11*A311*B111*RE12**2+4.D0*G11*A311*RE12*B11**2*
     X A111+2.D0*G11*A311*RE12*B11*B31*A113-4.D0*G11*A311*RE12*B11+
     X 2.D0*G11*A313*B311*RE12**2+2.D0*G11*A313*RE12*B11*A111*B31+G11
     X *A313*RE12*B31**2*A113-2.D0*G11*A313*RE12*B31)/(4.D0*RE32*
     X RE12**2)
      G3133=(4.D0*G13*A333*RE32*B333*RE12+4.D0*G13*A333*RE32*B13*B33
     X *A111+2.D0*G13*A333*RE32*B33**2*A113-4.D0*G13*A333*B33*RE12+
     X 4.D0*G13*A133*RE32*A311*B13*B33+2.D0*G13*A133*RE32*A313*B33**2
     X +4.D0*G13*RE32**2*B133*A111+2.D0*G13*RE32**2*B333*A113+2.D0*G13
     X *RE32*A311*B13**2*A113+2.D0*G13*RE32*A313*B133*RE12+2.D0*G13*
     X RE32*A313*B13**2*A111+2.D0*G13*RE32*A313*B13*B33*A113-4.D0*
     X G13*RE32*B13*A111-2.D0*G13*RE32*B33*A113-2.D0*G13*A313*B13*
     X RE12+4.D0*G13*RE12+4.D0*G33*A333*A133*RE32*B33**2+2.D0*G33*A333
     X *RE32*B13*B33*A113+4.D0*G33*A133*RE32**2*B333+2.D0*G33*A133*
     X RE32*A313*B13*B33-4.D0*G33*A133*RE32*B33+2.D0*G33*RE32**2*
     X B133*A113+G33*RE32*A313*B13**2*A113-2.D0*G33*RE32*B13*A113+
     X 4.D0*G11*RE32*A311*B133*RE12+4.D0*G11*RE32*A311*B13**2*A111+2.D0
     X *G11*RE32*A311*B13*B33*A113+2.D0*G11*RE32*A313*B333*RE12+2.D0
     X *G11*RE32*A313*B13*B33*A111+G11*RE32*A313*B33**2*A113-4.D0*
     X G11*A311*B13*RE12-2.D0*G11*A313*B33*RE12)/(4.D0*RE32**2*RE12)
      ANS2=4.D0*G11*RE32*A311*B13*RE12*B11*A111+G11*RE32*A311*B13*
     X RE12*B31*A113-2.D0*G11*RE32*A311*B13*RE12+G11*RE32*A311*B33
     X *RE12*B11*A113+G11*RE32*A313*B313*RE12**2+G11*RE32*A313*
     X B13*RE12*A111*B31+G11*RE32*A313*B33*RE12*B11*A111+G11*
     X RE32*A313*B33*RE12*B31*A113-G11*RE32*A313*B33*RE12-2.D0*G11
     X *A311*RE12**2*B11-G11*A313*RE12**2*B31
      ANS1=2.D0*G13*A333*RE32*B313*RE12**2+2.D0*G13*A333*RE32*B13*
     X RE12*A111*B31+2.D0*G13*A333*RE32*B33*RE12*B11*A111+2.D0*G13*
     X A333*RE32*B33*RE12*B31*A113-2.D0*G13*A333*RE32*B33*RE12-2.D0*
     X G13*A333*RE12**2*B31+2.D0*G13*A133*RE32*A311*B13*RE12*B31+
     X 2.D0*G13*A133*RE32*A311*B33*RE12*B11+2.D0*G13*A133*RE32*A313*
     X B33*RE12*B31+2.D0*G13*RE32**2*B113*RE12*A111+G13*RE32**2*
     X B313*RE12*A113-2.D0*G13*RE32**2*B13*A111-G13*RE32**2*B33*
     X A113+2.D0*G13*RE32*A311*B13*RE12*B11*A113+G13*RE32*A313*
     X B113*RE12**2+2.D0*G13*RE32*A313*B13*RE12*B11*A111+G13*RE32*
     X A313*B13*RE12*B31*A113-G13*RE32*A313*B13*RE12+G13*RE32*
     X A313*B33*RE12*B11*A113-2.D0*G13*RE32*RE12*B11*A111-G13*RE32
     X *RE12*B31*A113+2.D0*G13*RE32*RE12-G13*A313*RE12**2*B11+4.D0*
     X G33*A333*A133*RE32*B33*RE12*B31+G33*A333*RE32*B13*RE12*
     X B31*A113+G33*A333*RE32*B33*RE12*B11*A113+2.D0*G33*A133*RE32
     X **2*B313*RE12-2.D0*G33*A133*RE32**2*B33+G33*A133*RE32*A313*
     X B13*RE12*B31+G33*A133*RE32*A313*B33*RE12*B11-2.D0*G33*A133*
     X RE32*RE12*B31+G33*RE32**2*B113*RE12*A113-G33*RE32**2*B13*
     X A113+G33*RE32*A313*B13*RE12*B11*A113-G33*RE32*RE12*B11*
     X A113+2.D0*G11*RE32*A311*B113*RE12**2+ANS2
      G3113=ANS1/(2.D0*RE32**2*RE12**2)
      G131=(2.D0*G13*A333*RE12*B31+2.D0*G13*RE32*B11*A111+G13*RE32*
     X B31*A113-2.D0*G13*RE32+G13*A313*RE12*B11+2.D0*G33*A133*RE32*
     X B31+G33*RE32*B11*A113+2.D0*G11*A311*RE12*B11+G11*A313*RE12*
     X B31)/(2.D0*RE32*RE12)
      G133=(2.D0*G13*A333*B33*RE12+2.D0*G13*RE32*B13*A111+G13*RE32*
     X B33*A113+G13*A313*B13*RE12-2.D0*G13*RE12+2.D0*G33*A133*RE32*
     X B33+G33*RE32*B13*A113+2.D0*G11*A311*B13*RE12+G11*A313*B33*
     X RE12)/(2.D0*RE32*RE12)
      G1311=(4.D0*G13*A333*B311*RE12**2+4.D0*G13*A333*RE12*B11*A111*
     X B31+2.D0*G13*A333*RE12*B31**2*A113-4.D0*G13*A333*RE12*B31+4.D0*
     X G13*A133*A311*RE12*B11*B31+2.D0*G13*A133*A313*RE12*B31**2+
     X 4.D0*G13*RE32*B111*RE12*A111+2.D0*G13*RE32*B311*RE12*A113-4.D0*
     X G13*RE32*B11*A111-2.D0*G13*RE32*B31*A113+4.D0*G13*RE32+2.D0*G13
     X *A311*RE12*B11**2*A113+2.D0*G13*A313*B111*RE12**2+2.D0*G13*
     X A313*RE12*B11**2*A111+2.D0*G13*A313*RE12*B11*B31*A113-2.D0*
     X G13*A313*RE12*B11+4.D0*G33*A333*A133*RE12*B31**2+2.D0*G33*
     X A333*RE12*B11*B31*A113+4.D0*G33*A133*RE32*B311*RE12-4.D0*G33*
     X A133*RE32*B31+2.D0*G33*A133*A313*RE12*B11*B31+2.D0*G33*RE32*
     X B111*RE12*A113-2.D0*G33*RE32*B11*A113+G33*A313*RE12*B11**2*
     X A113+4.D0*G11*A311*B111*RE12**2+4.D0*G11*A311*RE12*B11**2*
     X A111+2.D0*G11*A311*RE12*B11*B31*A113-4.D0*G11*A311*RE12*B11+
     X 2.D0*G11*A313*B311*RE12**2+2.D0*G11*A313*RE12*B11*A111*B31+G11
     X *A313*RE12*B31**2*A113-2.D0*G11*A313*RE12*B31)/(4.D0*RE32*
     X RE12**2)
      G1333=(4.D0*G13*A333*RE32*B333*RE12+4.D0*G13*A333*RE32*B13*B33
     X *A111+2.D0*G13*A333*RE32*B33**2*A113-4.D0*G13*A333*B33*RE12+
     X 4.D0*G13*A133*RE32*A311*B13*B33+2.D0*G13*A133*RE32*A313*B33**2
     X +4.D0*G13*RE32**2*B133*A111+2.D0*G13*RE32**2*B333*A113+2.D0*G13
     X *RE32*A311*B13**2*A113+2.D0*G13*RE32*A313*B133*RE12+2.D0*G13*
     X RE32*A313*B13**2*A111+2.D0*G13*RE32*A313*B13*B33*A113-4.D0*
     X G13*RE32*B13*A111-2.D0*G13*RE32*B33*A113-2.D0*G13*A313*B13*
     X RE12+4.D0*G13*RE12+4.D0*G33*A333*A133*RE32*B33**2+2.D0*G33*A333
     X *RE32*B13*B33*A113+4.D0*G33*A133*RE32**2*B333+2.D0*G33*A133*
     X RE32*A313*B13*B33-4.D0*G33*A133*RE32*B33+2.D0*G33*RE32**2*
     X B133*A113+G33*RE32*A313*B13**2*A113-2.D0*G33*RE32*B13*A113+
     X 4.D0*G11*RE32*A311*B133*RE12+4.D0*G11*RE32*A311*B13**2*A111+2.D0
     X *G11*RE32*A311*B13*B33*A113+2.D0*G11*RE32*A313*B333*RE12+2.D0
     X *G11*RE32*A313*B13*B33*A111+G11*RE32*A313*B33**2*A113-4.D0*
     X G11*A311*B13*RE12-2.D0*G11*A313*B33*RE12)/(4.D0*RE32**2*RE12)
      ANS2=4.D0*G11*RE32*A311*B13*RE12*B11*A111+G11*RE32*A311*B13*
     X RE12*B31*A113-2.D0*G11*RE32*A311*B13*RE12+G11*RE32*A311*B33
     X *RE12*B11*A113+G11*RE32*A313*B313*RE12**2+G11*RE32*A313*
     X B13*RE12*A111*B31+G11*RE32*A313*B33*RE12*B11*A111+G11*
     X RE32*A313*B33*RE12*B31*A113-G11*RE32*A313*B33*RE12-2.D0*G11
     X *A311*RE12**2*B11-G11*A313*RE12**2*B31
      ANS1=2.D0*G13*A333*RE32*B313*RE12**2+2.D0*G13*A333*RE32*B13*
     X RE12*A111*B31+2.D0*G13*A333*RE32*B33*RE12*B11*A111+2.D0*G13*
     X A333*RE32*B33*RE12*B31*A113-2.D0*G13*A333*RE32*B33*RE12-2.D0*
     X G13*A333*RE12**2*B31+2.D0*G13*A133*RE32*A311*B13*RE12*B31+
     X 2.D0*G13*A133*RE32*A311*B33*RE12*B11+2.D0*G13*A133*RE32*A313*
     X B33*RE12*B31+2.D0*G13*RE32**2*B113*RE12*A111+G13*RE32**2*
     X B313*RE12*A113-2.D0*G13*RE32**2*B13*A111-G13*RE32**2*B33*
     X A113+2.D0*G13*RE32*A311*B13*RE12*B11*A113+G13*RE32*A313*
     X B113*RE12**2+2.D0*G13*RE32*A313*B13*RE12*B11*A111+G13*RE32*
     X A313*B13*RE12*B31*A113-G13*RE32*A313*B13*RE12+G13*RE32*
     X A313*B33*RE12*B11*A113-2.D0*G13*RE32*RE12*B11*A111-G13*RE32
     X *RE12*B31*A113+2.D0*G13*RE32*RE12-G13*A313*RE12**2*B11+4.D0*
     X G33*A333*A133*RE32*B33*RE12*B31+G33*A333*RE32*B13*RE12*
     X B31*A113+G33*A333*RE32*B33*RE12*B11*A113+2.D0*G33*A133*RE32
     X **2*B313*RE12-2.D0*G33*A133*RE32**2*B33+G33*A133*RE32*A313*
     X B13*RE12*B31+G33*A133*RE32*A313*B33*RE12*B11-2.D0*G33*A133*
     X RE32*RE12*B31+G33*RE32**2*B113*RE12*A113-G33*RE32**2*B13*
     X A113+G33*RE32*A313*B13*RE12*B11*A113-G33*RE32*RE12*B11*
     X A113+2.D0*G11*RE32*A311*B113*RE12**2+ANS2
      G1313=ANS1/(2.D0*RE32**2*RE12**2)
      G331=(2.D0*G13*A311*B11+G13*A313*B31+2.D0*G33*A333*B31+G33*
     X A313*B11)/RE32
      G333=(2.D0*G13*A311*B13+G13*A313*B33+2.D0*G33*A333*B33+G33*
     X A313*B13-2.D0*G33)/RE32
      G3311=(8.D0*G13*A333*A311*B11*B31+4.D0*G13*A333*A313*B31**2+8.D0
     X *G13*RE32*A311*B111+4.D0*G13*RE32*A313*B311+4.D0*G13*A311*
     X A313*B11**2+2.D0*G13*A313**2*B11*B31+4.D0*G33*A333**2*B31**2+
     X 8.D0*G33*A333*RE32*B311+4.D0*G33*A333*A313*B11*B31+4.D0*G33*RE32
     X *A313*B111+G33*A313**2*B11**2+4.D0*G11*A311**2*B11**2+4.D0*
     X G11*A311*A313*B11*B31+G11*A313**2*B31**2)/(4.D0*RE32**2)
      G3333=(8.D0*G13*A333*A311*B13*B33+4.D0*G13*A333*A313*B33**2+8.D0
     X *G13*RE32*A311*B133+4.D0*G13*RE32*A313*B333+4.D0*G13*A311*
     X A313*B13**2-16.D0*G13*A311*B13+2.D0*G13*A313**2*B13*B33-8.D0*
     X G13*A313*B33+4.D0*G33*A333**2*B33**2+8.D0*G33*A333*RE32*B333+
     X 4.D0*G33*A333*A313*B13*B33-16.D0*G33*A333*B33+4.D0*G33*RE32*A313
     X *B133+G33*A313**2*B13**2-8.D0*G33*A313*B13+12.D0*G33+4.D0*G11*
     X A311**2*B13**2+4.D0*G11*A311*A313*B13*B33+G11*A313**2*B33**
     X 2)/(4.D0*RE32**2)
      G3313=(4.D0*G13*A333*A311*B13*B31+4.D0*G13*A333*A311*B33*B11+
     X 4.D0*G13*A333*A313*B33*B31+4.D0*G13*RE32*A311*B113+2.D0*G13*RE32
     X *A313*B313+4.D0*G13*A311*A313*B13*B11-8.D0*G13*A311*B11+G13*
     X A313**2*B13*B31+G13*A313**2*B33*B11-4.D0*G13*A313*B31+4.D0*
     X G33*A333**2*B33*B31+4.D0*G33*A333*RE32*B313+2.D0*G33*A333*
     X A313*B13*B31+2.D0*G33*A333*A313*B33*B11-8.D0*G33*A333*B31+2.D0*
     X G33*RE32*A313*B113+G33*A313**2*B13*B11-4.D0*G33*A313*B11+4.D0
     X *G11*A311**2*B13*B11+2.D0*G11*A311*A313*B13*B31+2.D0*G11*A311
     X *A313*B33*B11+G11*A313**2*B33*B31)/(2.D0*RE32**2)
      GD0=G110*G330-G130*G310
      GD1=G110*G331+G111*G330-G130*G311-G131*G310
      GD3=G110*G333+G113*G330-G130*G313-G133*G310
      GD11=
     .  2.0D0*(G110*G3311+G111*G331+G1111*G330-G130*G3111-G131*
     . G311-G1311*G310)
      GD33=
     .  2.0D0*(G110*G3333+G113*G333+G1133*G330-G130*G3133-G133*
     . G313-G1333*G310)
      GD13=G110*G3313+G111*G333+G1113*G330+G113*G331-G130*G3113-
     . G131*G313-G1313*G310-G133*G311
      GD31=G110*G3313+G111*G333+G1113*G330+G113*G331-G130*G3113-
     . G131*G313-G1313*G310-G133*G311
C
      UC1 = GD1*G110*GD1 + GD1*G130*GD3
     1    + GD3*G310*GD1 + GD3*G330*GD3
      UC2 = G110*GD11 + G130*GD13 + G310*GD31 + G330*GD33
      UC3 = GD1*G111  + GD1*G133  + GD3*G311  + GD3*G333
C
      UVIVAL = 5.0D+00*UC1/(3.2D+01*GD0*GD0)
     1      - (UC2 + UC3)/(8.0D+00*GD0)
      RETURN
      END
C
C
      SUBROUTINE READIN ( POTSYM )
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM , POTSYM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      CHARACTER*80 TITLE(4)
      CHARACTER*6 POTFLG
      CHARACTER*10 LABEL
      REAL*8 RHOEDG
      INTEGER I,J,LSTYP1,LSTYP2
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      POTSYM=.FALSE.
      PARMAX=55
C
      WRITE (NFIL6,4990)
C
      DO 100 I=1,4
100   READ (NFIL5,5000) TITLE(I)
      WRITE (NFIL6,5100) (TITLE(I), I=1,4)
C
      NISOT=0
      DO 200 I=1,ISOMAX
      READ (NFIL5,5701) LABEL,(AMASS(J,I), J=1,3)
      IF (AMASS(1,I) .LE. 0.0D+00) GOTO 300
      NISOT=NISOT+1
200   CONTINUE
300   CONTINUE
      WRITE (NFIL6,5300)
C
      DO 400 I=1,NISOT
400   WRITE (NFIL6,5400) I,(AMASS(J,I), J=1,3)
      WRITE (NFIL6,5410)
C
C FOR EACH ISOTOPE DEFINE JMAX, V2MAX, AND MBASIS
C
      WRITE (NFIL6,5430)
      DO 500 I=1,NISOT
      READ (NFIL5,5500) LABEL,JMAX,V2MAX,MBASIS,LSTYP1,LSTYP2
      WRITE (NFIL6,5440) I,JMAX,V2MAX,MBASIS,LSTYP1,LSTYP2
      IQUANT(1,I)=JMAX
      IQUANT(2,I)=V2MAX
      IQUANT(3,I)=MBASIS
      IQUANT(4,I)=LSTYP1
500   IQUANT(5,I)=LSTYP2
      WRITE (NFIL6,5450)
C
      READ (NFIL5,5700) LABEL,IVAR(1),RHOEDG
      RHOE=PI*RHOEDG/1.8D+02
      READ (NFIL5,5700) LABEL,IVAR(4),FA1
      READ (NFIL5,5700) LABEL,IVAR(5),FA2
      READ (NFIL5,5700) LABEL,IVAR(6),FA3
      READ (NFIL5,5700) LABEL,IVAR(7),FA4
      READ (NFIL5,5700) LABEL,IVAR(8),FA5
      READ (NFIL5,5700) LABEL,IVAR(9),FA6
      READ (NFIL5,5700) LABEL,IVAR(10),FA7
      READ (NFIL5,5700) LABEL,IVAR(11),FA8
C
      WRITE (NFIL6,5710) RHOEDG,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8
C
      READ (NFIL5,5720) POTFLG
      IF (POTFLG(1:4) .EQ. 'SYMM') GOTO 600
      IF (POTFLG(1:4) .EQ. 'UNSY') GOTO 700
      GOTO 9000
600   POTSYM=.TRUE.
      PARMAX=35
      READ (NFIL5,5700) LABEL,IVAR(2),RE12
      RE32=RE12
      READ (NFIL5,5700) LABEL,IVAR(3),AA1
      AA3=AA1
      READ (NFIL5,5700) LABEL,IVAR(12),F1A1
      F1A3=F1A1
      READ (NFIL5,5700) LABEL,IVAR(13),F2A1
      F2A3=F2A1
      READ (NFIL5,5700) LABEL,IVAR(14),F3A1
      F3A3=F3A1
      READ (NFIL5,5700) LABEL,IVAR(15),F4A1
      F4A3=F4A1
      READ (NFIL5,5700) LABEL,IVAR(16),F11
      F33=F11
      READ (NFIL5,5700) LABEL,IVAR(17),F1A11
      F1A33=F1A11
      READ (NFIL5,5700) LABEL,IVAR(18),F2A11
      F2A33=F2A11
      READ (NFIL5,5700) LABEL,IVAR(19),F3A11
      F3A33=F3A11
      READ (NFIL5,5700) LABEL,IVAR(20),F13
      READ (NFIL5,5700) LABEL,IVAR(21),F1A13
      READ (NFIL5,5700) LABEL,IVAR(22),F2A13
      READ (NFIL5,5700) LABEL,IVAR(23),F3A13
      READ (NFIL5,5700) LABEL,IVAR(24),F111
      F333=F111
      READ (NFIL5,5700) LABEL,IVAR(25),F1A111
      F1A333=F1A111
      READ (NFIL5,5700) LABEL,IVAR(26),F2A111
      F2A333=F2A111
      READ (NFIL5,5700) LABEL,IVAR(27),F113
      F133=F113
      READ (NFIL5,5700) LABEL,IVAR(28),F1A113
      F1A133=F1A113
      READ (NFIL5,5700) LABEL,IVAR(29),F2A113
      F2A133=F2A113
      READ (NFIL5,5700) LABEL,IVAR(30),F1111
      F3333=F1111
      READ (NFIL5,5700) LABEL,IVAR(31),FA1111
      FA3333=FA1111
      READ (NFIL5,5700) LABEL,IVAR(32),F1113
      F1333=F1113
      READ (NFIL5,5700) LABEL,IVAR(33),FA1113
      FA1333=FA1113
      READ (NFIL5,5700) LABEL,IVAR(34),F1133
      READ (NFIL5,5700) LABEL,IVAR(35),FA1133
      GOTO 800
700   IVAR(13)=IVAR(11)
      IVAR(12)=IVAR(10)
      IVAR(11)=IVAR(9)
      IVAR(10)=IVAR(8)
      IVAR(9)=IVAR(7)
      IVAR(8)=IVAR(6)
      IVAR(7)=IVAR(5)
      IVAR(6)=IVAR(4)
      READ (NFIL5,5700) LABEL,IVAR(2),RE12,IVAR(3),RE32
      READ (NFIL5,5700) LABEL,IVAR(4),AA1,IVAR(5),AA3
      READ (NFIL5,5700) LABEL,IVAR(14),F1A1,IVAR(18),F1A3
      READ (NFIL5,5700) LABEL,IVAR(15),F2A1,IVAR(19),F2A3
      READ (NFIL5,5700) LABEL,IVAR(16),F3A1,IVAR(20),F3A3
      READ (NFIL5,5700) LABEL,IVAR(17),F4A1,IVAR(21),F4A3
      READ (NFIL5,5700) LABEL,IVAR(22),F11,IVAR(26),F33
      READ (NFIL5,5700) LABEL,IVAR(23),F1A11,IVAR(27),F1A33
      READ (NFIL5,5700) LABEL,IVAR(24),F2A11,IVAR(28),F2A33
      READ (NFIL5,5700) LABEL,IVAR(25),F3A11,IVAR(29),F3A33
      READ (NFIL5,5700) LABEL,IVAR(30),F13
      READ (NFIL5,5700) LABEL,IVAR(31),F1A13
      READ (NFIL5,5700) LABEL,IVAR(32),F2A13
      READ (NFIL5,5700) LABEL,IVAR(33),F3A13
      READ (NFIL5,5700) LABEL,IVAR(34),F111,IVAR(37),F333
      READ (NFIL5,5700) LABEL,IVAR(35),F1A111,IVAR(38),F1A333
      READ (NFIL5,5700) LABEL,IVAR(36),F2A111,IVAR(39),F2A333
      READ (NFIL5,5700) LABEL,IVAR(40),F113,IVAR(43),F133
      READ (NFIL5,5700) LABEL,IVAR(41),F1A113,IVAR(44),F1A133
      READ (NFIL5,5700) LABEL,IVAR(42),F2A113,IVAR(45),F2A133
      READ (NFIL5,5700) LABEL,IVAR(46),F1111,IVAR(48),F3333
      READ (NFIL5,5700) LABEL,IVAR(47),FA1111,IVAR(49),FA3333
      READ (NFIL5,5700) LABEL,IVAR(50),F1113,IVAR(52),F1333
      READ (NFIL5,5700) LABEL,IVAR(51),FA1113,IVAR(53),FA1333
      READ (NFIL5,5700) LABEL,IVAR(54),F1133
      READ (NFIL5,5700) LABEL,IVAR(55),FA1133
800   WRITE (NFIL6,5790)
      WRITE (NFIL6,5800) RE12,RE32
      WRITE (NFIL6,5900) AA1,AA3
      WRITE (NFIL6,5990)
      WRITE (NFIL6,6000) F1A1,F1A3
      WRITE (NFIL6,6010) F2A1,F2A3
      WRITE (NFIL6,6020) F3A1,F3A3
      WRITE (NFIL6,6030) F4A1,F4A3
      WRITE (NFIL6,6040) F11,F33
      WRITE (NFIL6,6050) F1A11,F1A33
      WRITE (NFIL6,6060) F2A11,F2A33
      WRITE (NFIL6,6070) F3A11,F3A33
      WRITE (NFIL6,6080) F13
      WRITE (NFIL6,6090) F1A13
      WRITE (NFIL6,6100) F2A13
      WRITE (NFIL6,6110) F3A13
      WRITE (NFIL6,6120) F111,F333
      WRITE (NFIL6,6130) F1A111,F1A333
      WRITE (NFIL6,6140) F2A111,F2A333
      WRITE (NFIL6,6150) F113,F133
      WRITE (NFIL6,6160) F1A113,F1A133
      WRITE (NFIL6,6170) F2A113,F2A133
      WRITE (NFIL6,6180) F1111,F3333
      WRITE (NFIL6,6190) FA1111,FA3333
      WRITE (NFIL6,6200) F1113,F1333
      WRITE (NFIL6,6210) FA1113,FA1333
      WRITE (NFIL6,6220) F1133
      WRITE (NFIL6,6230) FA1133
      READ (NFIL5,5500) LABEL,V0TYPE
      WRITE (NFIL6,6240) V0TYPE
      READ (NFIL5,5500) LABEL,NATTS
      READ (NFIL5,5701) LABEL,RHOMAX
      READ (NFIL5,5701) LABEL,ETRIAL
      READ (NFIL5,5701) LABEL,PNM1
      READ (NFIL5,5500) LABEL,NSTINT
      READ (NFIL5,5500) LABEL,NSERIN
      IF (NSERIN .LT. 20) NSERIN=20
      READ (NFIL5,5500) LABEL,NSERP
      READ (NFIL5,5500) LABEL,NSERQ
      WRITE (NFIL6,6300) RHOMAX,ETRIAL,PNM1,NSTINT,NSERIN,
     1                  NSERP,NSERQ
      READ (NFIL5,5500) LABEL,NSTNIN
      WRITE (NFIL6,6400) NATTS,NSTNIN
      READ (NFIL5,5701) LABEL,THRSH1
      READ (NFIL5,5701) LABEL,THRSH2
      READ (NFIL5,5701) LABEL,THRSH3
      READ (NFIL5,5701) LABEL,THRSH4
      READ (NFIL5,5701) LABEL,THRSH5
      WRITE (NFIL6,6500) THRSH1,THRSH2,THRSH3,THRSH4,THRSH5
      READ (NFIL5,5500) LABEL,ITEST
      READ (NFIL5,5500) LABEL,PRTINT
      WRITE (NFIL6,6600) ITEST,PRTINT
      WRITE (NFIL6,6700)
      HSTEP=RHOMAX/DFLOAT(NSTINT)
      NUMPAR=0
      DO 900 I=1,PARMAX
      IF (IVAR(I) .LE. 0) IVAR(I)=0
      IF (IVAR(I) .NE. 0) IVAR(I)=1
900   NUMPAR=NUMPAR+IVAR(I)
      IF ( V0TYPE .EQ. 2 ) GOTO 1000
      NUMPAR=NUMPAR-IVAR(1)
      IF (IVAR(1) .EQ. 1) WRITE (NFIL6,6800)
      IVAR(1)=0
      RETURN
1000  CONTINUE
      IF ( POTSYM ) NUMPAR=NUMPAR-IVAR(4)
      IF ( .NOT.POTSYM ) NUMPAR=NUMPAR-IVAR(6)
      IF ( POTSYM .AND. IVAR(4) .EQ. 1) WRITE (NFIL6,6900)
      IF ( .NOT.POTSYM .AND. IVAR(6) .EQ. 1) WRITE (NFIL6,6900)
      IF ( POTSYM ) IVAR(4)=0
      IF ( .NOT.POTSYM ) IVAR(6)=0
      RETURN
9000  WRITE (NFIL6,9002)
      STOP
4990  FORMAT('1','MORBID.INP.INF  INPUT PROCESSING ROUTINE',
     1      ' CALLED'//)
5000  FORMAT(A80)
5100  FORMAT('0',3(132('*')/' '),16('*'),100X,16('*')/
     1      4(' ',16('*'),10X,A80,10X,16('*')/),
     2        ' ',16('*'),100X,16('*')/' ',3(132('*')/' '))
5300  FORMAT('0',//,5X,12('*'),' ATOMIC MASSES ',12('*')//
     1      ' ',10X,64('-')/
     1      ' ',10X,'*',7X,'*',54X,'*'/
     1      ' ',10X,'* ISOT. *',6X,'M1/AMU',12X,
     1      'M2/AMU',12X,'M3/AMU',6X,'*'/
     1      ' ',10X,'*',7X,'*',54X,'*'/
     1      ' ',10X,64('-'))
5400  FORMAT(' ',10X,'*  ',I3,2X,'*  ',F14.8,4X,F14.8,
     1      4X,F14.8,'  *')
5410  FORMAT(' ',10X,64('-'))
5430  FORMAT('0',//,5X,12('*'),' QUANTUM NUMBER LIMITS ',12('*')//
     1      ' ',10X,99('-')/
     1      ' ',10X,'*',7X,'*',89X,'*'/
     1      ' ',10X,'* ISOT. *',6X,' JMAX ',12X,
     1      'V2MAX ',12X,'MBASIS',12X,
     1      'LSTYP1',12X,'LSTYP2',5X,'*'/
     1      ' ',10X,'*',7X,'*',89X,'*'/
     1      ' ',10X,99('-'))
5440  FORMAT(' ',10X,'*  ',I3,2X,'*  ',5X,I4,14X,I4,
     1      14X,I4,14X,I4,14X,I4,'      *')
5450  FORMAT(' ',10X,99('-'))
5500  FORMAT(A10,5I4)
5701  FORMAT(A10,3D16.8)
5700  FORMAT(A10,3(I2,D16.8))
5710  FORMAT('0',5X,12('*'),' BENDING ENERGY EXPANSION COEFFI',
     1      'CIENTS (CM-1) ',12('*')//
     2      17X,'   RHOE/DEG =',F16.5/
     2      17X,'   FA1      =',F16.5,'   FA2      =',F16.5/
     3      17X,'   FA3      =',F16.5,'   FA4      =',F16.5/
     4      17X,'   FA5      =',F16.5,'   FA6      =',F16.5/
     4      17X,'   FA7      =',F16.5,'   FA8      =',F16.5)
5720  FORMAT(A6)
5790  FORMAT('0',5X,12('*'),' MOLECULAR PARAMETERS ',12('*')//)
5800  FORMAT('0',17X,'    RE12 =',F10.6,' ANGSTROM,   RE32 =',
     1      F10.6,' ANGSTROM'/)
5900  FORMAT('0',17X,'    A1   =',F8.4,' ANGSTROM-1,   A3   =',
     1      F8.4,' ANGSTROM-1'/)
5990  FORMAT('0',5X,12('*'),' POTENTIAL ENERGY EXPANSION COEFFI',
     1      'CIENTS (CM-1) ',12('*')//)
6000  FORMAT('0',17X,'   F1A1    =',F16.5,'   F1A3    =',F16.5)
6010  FORMAT('0',17X,'   F2A1    =',F16.5,'   F2A3    =',F16.5)
6020  FORMAT('0',17X,'   F3A1    =',F16.5,'   F3A3    =',F16.5)
6030  FORMAT('0',17X,'   F4A1    =',F16.5,'   F4A3    =',F16.5)
6040  FORMAT('0',17X,'   F11     =',F16.5,'   F33     =',F16.5)
6050  FORMAT('0',17X,'   F1A11   =',F16.5,'   F1A33   =',F16.5)
6060  FORMAT('0',17X,'   F2A11   =',F16.5,'   F2A33   =',F16.5)
6070  FORMAT('0',17X,'   F3A11   =',F16.5,'   F3A33   =',F16.5)
6080  FORMAT('0',17X,'   F13     =',F16.5)
6090  FORMAT('0',17X,'   F1A13   =',F16.5)
6100  FORMAT('0',17X,'   F2A13   =',F16.5)
6110  FORMAT('0',17X,'   F3A13   =',F16.5)
6120  FORMAT('0',17X,'   F111    =',F16.5,'   F333    =',F16.5)
6130  FORMAT('0',17X,'   F1A111  =',F16.5,'   F1A333  =',F16.5)
6140  FORMAT('0',17X,'   F2A111  =',F16.5,'   F2A333  =',F16.5)
6150  FORMAT('0',17X,'   F113    =',F16.5,'   F133    =',F16.5)
6160  FORMAT('0',17X,'   F1A113  =',F16.5,'   F1A133  =',F16.5)
6170  FORMAT('0',17X,'   F2A113  =',F16.5,'   F2A133  =',F16.5)
6180  FORMAT('0',17X,'   F1111   =',F16.5,'   F3333   =',F16.5)
6190  FORMAT('0',17X,'   F1A1111 =',F16.5,'   F1A3333 =',F16.5)
6200  FORMAT('0',17X,'   F1113   =',F16.5,'   F1333   =',F16.5)
6210  FORMAT('0',17X,'   F1A1113 =',F16.5,'   F1A1333 =',F16.5)
6220  FORMAT('0',17X,'   F1133   =',F16.5)
6230  FORMAT('0',17X,'   F1A1133 =',F16.5)
6240  FORMAT('0',5X,12('*'),' POTENTIAL EXPANSION TYPE ',
     1  12('*')//,
     2  '0',17X,' V0TYPE  = ',I5,' (V0TYPE = 1: EXPANSION IN ',
     3  '1 - DCOS(RHO))'/
     4  ' ',17X,'           ',5X,' (V0TYPE = 2: EXPANSION IN ',
     5  'DCOS(RHOE) - DCOS(RHO))'/)
6300  FORMAT('0',5X,12('*'),' NUMERICAL INTEGRATION PARAMETERS ',
     1  12('*')//,
     2  '0',17X,' RHOMAX  = ',F10.5,' RADIANS'/
     3  '0',17X,' ETRIAL  = ',F10.5/
     4  '0',17X,' P(N-1)  = ',E12.5/
     5  '0',17X,' NSTINT  = ',I5,' (NUMBER OF INTEGRATION STEPS)'/
     6  '0',17X,' NSERIN  = ',I5,' (POINTS IN SERIES SOLUTION REGION)'/
     7  '0',17X,' P       = ',I5,' (TERMS IN POLYNOMIAL APPROXIMATION ',
     8  'TO THE SCHROEDINGER EQUATION)'/
     9  '0',17X,' Q       = ',I5,' (TERMS IN POLYNOMIAL APPROXIMATION ',
     1  'TO THE BENDING WAVEFUNCTION)'//)
6400  FORMAT('0',5X,12('*'),' PROGRAM LIMITS ',12('*')//,
     1  '0',17X,' NATTS   = ',I5,' (NUMBER OF ATTEMPTS ALLOWED',
     2  ' IN FINDING RHOE)'/
     3  '0',17X,' NSTNIN  = ',I5,' (NUMBER OF ITERATIONS ALLOWED',
     4  ' IN THE NUMERICAL INTEGRATION)'/)
6500  FORMAT('0',5X,12('*'),' PROGRAM THRESHOLDS ',12('*')//,
     1  '0',17X,' THRSH1  = ',E10.2,' (THRESHOLD ON DERIVATIVE IN',
     2  ' FINDING RHOE)'/
     3  '0',17X,' THRSH2  = ',E10.2,' (STOPPING THRESHOLD IN FINDING',
     4  ' RHOE)'/
     3  '0',17X,' THRSH3  = ',E10.2,' (UPPER LIMIT FOR WAVEFUNCTION',
     4  ' VALUE IN OUTWARD INTEGRATION)'/
     3  '0',17X,' THRSH4  = ',E10.2,' (ERROR LIMIT IN THE NUMERICAL',
     4  ' DIFFERENTIATION)'/
     5  '0',17X,' THRSH5  = ',E10.2,' (STOPPING THRESHOLD ON ENERGY',
     6  ' IN NUMEROV-COOLEY INTEGRATION)'/)
6600  FORMAT('0',5X,12('*'),' PROGRAM FLAGS ',12('*')//,
     1  '0',17X,' ITEST   = ',I5,' (CONTROLS TEST OUTPUT)'/
     1  '0',17X,' PRTINT  = ',I5,' (NUMBER OF STEPS BETWEEN REPORTS ',
     1                           'OF F1, F2, I0 , AND V0)'/)
6700  FORMAT('0','MORBID.INP.INF  END OF INPUT DATA'//)
6800  FORMAT('0','MORBID.INP.WRN  RHOE CANNOT BE DETERMINED FOR ',
     1          'V0TYPE=1'/
     2      ' ','                CORRECTIVE ACTION TAKEN'//)
6900  FORMAT('0','MORBID.INP.WRN  F1A  CANNOT BE DETERMINED FOR ',
     1          'V0TYPE=2'/
     2      ' ','                CORRECTIVE ACTION TAKEN'//)
9002  FORMAT('0','MORBID.INP.ERR  WRONG POTENTIAL TYPE SPECIFIED'/
     1      ' ','                ( AND UNSYMM ARE ALLOWED)'//)
      END
C
C
      SUBROUTINE POTTYP
      IMPLICIT REAL*8 (A-H,O-Z)
C
C SUBROUTINE SETS UP PARAMETERS FOR THE PURE BENDING POTENTIAL.
C
C THERE ARE TWO POSSIBLE EXPANSIONS FOR V0
C
C  1) V0TYPE=1, V0 IS AN EIGHT ORDER EXPANSION IN 1-COS(RHO).
C               F1A IS THEN USED AS A MOLECULAR PARAMETER, BUT
C               RHOE IS DERIVED FROM THE VALUES OF F1A, F2A,... , F8A.
C
C  2) V0TYPE=2, V0 IS AN EIGTH ORDER EXPANSION IN COS(RHOE)-COS(RHO).
C               F1A IS THEN ALWAYS EQUAL TO ZERO, AND RHOE IS USED
C               FROM INPUT.
C
C          **********************************************************
C          *                                                        *
C          *                  IMPORTANT WARNING                     *
C          *                                                        *
C          *     THE V0TYPE=2 EXPANSION IS NOT APPROPRIATE WHEN     *
C          *     RHOE=0. FOR RHOE .NE. 0, BOTH TYPES CAN BE USED    *
C          *                                                        *
C          **********************************************************
C
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 VVAL,DVDR,RHO0,RHOEDG
      INTEGER NCNT
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      IF (V0TYPE .LT. 1 .OR. V0TYPE .GT. 2) GOTO 9000
      IF (V0TYPE .EQ. 2) GOTO 30
C
      RHOREF=0.0D+00
C
C FIND RHOE
C
      VMIN=0.0D+00
      MINK=0
      DO 10 I=1,NSTINT
      RHO=DFLOAT(I)*HSTEP
      CORO=1.0D+00-DCOS(RHO)
      VVAL=(((((((FA8*CORO+FA7)*CORO+
     1    FA6)*CORO+FA5)*CORO+FA4)*CORO
     2    +FA3)*CORO+FA2)*CORO+FA1)*CORO
      IF (VMIN .GT. VVAL) THEN
          VMIN=VVAL
          MINK=I
      ENDIF
10    CONTINUE
      IF (MINK .EQ. NSTINT) GOTO 9010
      IF (MINK .EQ. 0) THEN
          RHOE=0.0D+00
          VMIN=0.0D+00
          GOTO 40
      ENDIF
      RHO=DFLOAT(MINK-1)*HSTEP
      CORO=1.0D+00-DCOS(RHO)
      SR=DSIN(RHO)
      DVDR1=(((((((8.0D+00*FA8*CORO+7.0D+00*FA7)*CORO+
     1    6.0D+00*FA6)*CORO+5.0D+00*FA5)*CORO+4.0D+00*FA4)*CORO
     2    +3.0D+00*FA3)*CORO+2.0D+00*FA2)*CORO+FA1)*SR
      RHO=DFLOAT(MINK+1)*HSTEP
      CORO=1.0D+00-DCOS(RHO)
      SR=DSIN(RHO)
      DVDR2=(((((((8.0D+00*FA8*CORO+7.0D+00*FA7)*CORO+
     1    6.0D+00*FA6)*CORO+5.0D+00*FA5)*CORO+4.0D+00*FA4)*CORO
     2    +3.0D+00*FA3)*CORO+2.0D+00*FA2)*CORO+FA1)*SR
      RHOE=(DFLOAT(MINK-1)-2.0D+00*DVDR1/(DVDR2-DVDR1))*HSTEP
      CORO=1.0D+00-DCOS(RHOE)
      VMIN=(((((((FA8*CORO+FA7)*CORO+
     1    FA6)*CORO+FA5)*CORO+FA4)*CORO
     2    +FA3)*CORO+FA2)*CORO+FA1)*CORO
      GOTO 40
30    RHOREF=RHOE
      VMIN=0.0D+00
40    RHOEDG=RHOE*1.8D+02/PI
      IF (IPRINT .NE. 0) WRITE (NFIL6,8000) RHOEDG,VMIN
      RETURN
8000  FORMAT('1',5X,12('*'),' EQUILIBRIUM RHO VALUE',12('*')//
     2      17X,'   RHOE/DEG =',F16.5,'   VMIN     =',F16.5///)
9000  WRITE (NFIL6,9002) V0TYPE
9002  FORMAT(1H0,' MORBID.VTY.ERR  VALUE FOR V0TYPE,',I3,' NOT ALLOWED'/
     1      1H ,'                 ALLOWED VALUES ARE 1 AND 2.')
      STOP
9010  WRITE (NFIL6,9012)
9012  FORMAT(1H0,' MORBID.VTY.ERR  BENDING POTENTIAL ENERGY HAS',
     1      ' NO MINIMUM.')
      STOP
      END
C
C
C
      SUBROUTINE YONLY(IOSC,IW1,IW2,OVER,H)
C------------------------------(Y)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER IOSC
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(JR.NE.JC)GOTO 1
      IF(IR.NE.IC)GOTO 2
      RP1=(DFLOAT(IR)+0.5D0)/RMK(IOSC)
      GOTO 3
2     RP1=-OVER(IOSC,IR+1,IC+1)/(2.0D0*AAS(IOSC)*RMK(IOSC))
3     RP=RP1
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE YY(IOSC,IW1,IW2,OVER,H)
C     --------------------(Y*Y)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(JR.NE.JC)GOTO 1
      IF(IR.NE.IC)GOTO 2
      RN=DFLOAT(IR)
      RP1=(RN+0.5D0)/RMK(IOSC)
      GOTO 3
2     RN=RLN(IR,IC)
      RJ=DABS(DFLOAT(IR-IC))
      RP1=(RJ-1.0D0)/(2.0D0*AAS(IOSC)*RMK(IOSC))
      RP1=RP1-RJ*(2.0D0*RN+RJ+1.0D0)/(4.0D0*AAS(IOSC)
     1                            *RMK(IOSC)*RMK(IOSC))
      RP1=RP1*OVER(IOSC,IR+1,IC+1)
3     RP=RP1
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE Y1Y2(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(Y1*Y2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.NE.IC)GOTO 2
      RP1=(DFLOAT(IR)+0.5D0)/RMK(IOSC1)
      GOTO 3
2     RP1=-OVER(IOSC1,IR+1,IC+1)/(2.0D0*AAS(IOSC1)*RMK(IOSC1))
3     IF(JR.NE.JC)GOTO 4
      RP2=(DFLOAT(JR)+0.5D0)/RMK(IOSC2)
      GOTO 5
4     RP2=-OVER(IOSC2,JR+1,JC+1)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
5     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE YYY(IOSC,IW1,IW2,OVER,H)
C     --------------------(Y1*Y1*Y1)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(JR.NE.JC)GOTO 1
      IF(IR.NE.IC)GOTO 2
      RN=DFLOAT(IR)
      RP1=1.5D0*(RN+0.5D0)*(RN+0.5D0)/(RMK(IOSC)*RMK(IOSC))
      RP1=RP1-1.0D0/(8.0D0*RMK(IOSC)*RMK(IOSC))
      RP1=RP1-RN*(2.0D0*RN*RN+3.0D0*RN+1.0D0)/(4.0D0*RMK(IOSC)**3)
      GOTO 3
2     RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP1=(RJ-1.0D0)*(2.0D0-RJ)/(4.0D0*AAS(IOSC)*RMK(IOSC))
      RP=(RJ-2.0D0)*(2.0D0*RJ+1.0D0)*(2.0D0*RN+RJ+1.0D0)
      RP1=(RP1+RP/(8.0D0*AAS(IOSC)*RMK(IOSC)**2))
     1                            *OVER(IOSC,IR+1,IC+1)
3     RP=RP1
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE Y1Y1Y2(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(Y1*Y1*Y2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.NE.IC)GOTO 2
      RP1=(DFLOAT(IR)+0.5D0)/RMK(IOSC1)
      GOTO 3
2     RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP1=(RJ-1.0D0)/(2.0D0*AAS(IOSC1)*RMK(IOSC1))
      RP=RJ*(2.0D0*RN+RJ+1.0D0)/(4.0D0*AAS(IOSC1)*RMK(IOSC1)
     1                                         *RMK(IOSC1))
      RP1=(RP1-RP)*OVER(IOSC1,IR+1,IC+1)
3     IF(JR.NE.JC)GOTO 4
      RP2=(DFLOAT(JR)+0.5D0)/RMK(IOSC2)
      GOTO 5
4     RP2=-OVER(IOSC2,JR+1,JC+1)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
5     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE YYYY(IOSC,IW1,IW2,OVER,H)
C     --------------------(Y1*Y1*Y1*Y1)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(JR.NE.JC)GOTO 1
      IF(IR.NE.IC)GOTO 2
      RN=DFLOAT(IR)
      RP=(1.5D0*(RN+0.5D0)**2+3.0D0/8.0D0)/(RMK(IOSC)*RMK(IOSC))
      RP1=(RN*(2.0D0*RN*RN+3.0D0*RN+3.0D0)+1.0D0)/(4.0D0*RMK(IOSC)**3)
      RP1=RP-RP1
      GOTO 3
2     RN=RLN(IR,IC)
      RJ=DABS(DFLOAT(IR-IC))
      RP=(RJ-1.0D0)*(RJ-2.0D0)*(RJ-3.0D0)/(12.0D0*AAS(IOSC)
     1                                        *RMK(IOSC))
      RP1=(RJ-1.0D0)*(RJ*RJ-3.0D0*RJ-2.0D0)*(2.0D0*RN+RJ+1.0D0)
      RP1=(RP-RP1/(8.0D0*AAS(IOSC)*RMK(IOSC)*RMK(IOSC)))
     1                               *OVER(IOSC,IR+1,IC+1)
3     RP=RP1
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE Y12Y22(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(Y1*Y1*Y2*Y2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.NE.IC)GOTO 2
      RP1=(DFLOAT(IR)+0.5D0)/RMK(IOSC1)
      GOTO 3
2     RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP=(RJ-1.0D0)/(2.0D0*AAS(IOSC1)*RMK(IOSC1))
      RP1=RJ*(2.0D0*RN+RJ+1.0D0)/(4.0D0*AAS(IOSC1)*RMK(IOSC1)
     1                                         *RMK(IOSC1))
      RP1=(RP-RP1)*OVER(IOSC1,IR+1,IC+1)
3     IF(JR.NE.JC)GOTO 4
      RP2=(DFLOAT(JR)+0.5D0)/RMK(IOSC2)
      GOTO 5
4     RN=RLN(JR,JC)
      RJ=DABS(DFLOAT(JR-JC))
      RP=(RJ-1.0D0)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
      RP2=RJ*(2.0D0*RN+RJ+1.0D0)/(4.0D0*AAS(IOSC2)*RMK(IOSC2)
     1                                         *RMK(IOSC2))
      RP2=(RP-RP2)*OVER(IOSC2,JR+1,JC+1)
5     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE Y13Y2(IOSC1,IOSC2,IW1,IW2,OVER,H)
C---------------(Y1*Y1*Y1*Y2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(IR.NE.IC)GOTO 2
      RN=DFLOAT(IR)
      RP1=1.5D0*(RN+0.5D0)*(RN+0.5D0)/(RMK(IOSC1)*RMK(IOSC1))
      RP1=RP1-1.0D0/(8.0D0*RMK(IOSC1)*RMK(IOSC1))
      RP1=RP1-RN*(2.0D0*RN*RN+3.0D0*RN+1.0D0)/(4.0D0*RMK(IOSC1)**3)
      GOTO 3
2     RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP1=(RJ-1.0D0)*(2.0D0-RJ)/(4.0D0*AAS(IOSC1)*RMK(IOSC1))
      RP=(RJ-2.0D0)*(2.0D0*RJ+1.0D0)*(2.0D0*RN+RJ+1.0D0)
      RP1=(RP1+RP/(8.0D0*AAS(IOSC1)*RMK(IOSC1)*RMK(IOSC1)))*
     1      OVER(IOSC1,IR+1,IC+1)
3     IF(JR.NE.JC)GOTO 4
      RP2=(DFLOAT(JR)+0.5D0)/RMK(IOSC2)
      GOTO 5
4     RP2=-OVER(IOSC2,JR+1,JC+1)/(2.0D0*AAS(IOSC2)*RMK(IOSC2))
5     RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE PP(IOSC,IW1,IW2,OVER,H)
C     --------------------(P*P)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF(JR.NE.JC)GOTO 1
      IF(IC.NE.IR)GOTO 2
      RN=DFLOAT(IC)
      RP=-AAS(IOSC)*AAS(IOSC)*(RN+0.5D0)*(2.0D0*(RMK(IOSC)-RN)
     1                                          -1.0D0)/2.0D0
      GOTO 3
2     RJ=DABS(DFLOAT(IC-IR))
      RN=RLN(IR,IC)
      RP=0.5D0*AAS(IOSC)*OVER(IOSC,IR+1,IC+1)*(RMK(IOSC)*(RJ-1.0D0)
     1     -0.5D0*RJ*(2.0D0*RN+RJ+1.0D0))
3     H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE P1P2(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(P1*P2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF((IR.EQ.IC).OR.(JR.EQ.JC))GOTO 1
      RP1=0.5D0*OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      RP2=0.5D0*OVER(IOSC2,JR+1,JC+1)*RLS(JR,JC)
      RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
      SUBROUTINE PYYPP(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------(P1*Y1+Y1*P1)*P2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF((IR.EQ.IC).OR.(JR.EQ.JC))GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP1=1.0D0-RJ+RJ*(2.0D0*RN+RJ+1.0D0)/(RMK(IOSC1)*2.0D0)
      RP1=RP1*OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      RP2=0.5D0*OVER(IOSC2,JR+1,JC+1)*RLS(JR,JC)
      RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE YYPP(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     --------------------((Y1*Y1*P1+P1*Y1*Y1)*P2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF((IR.EQ.IC).OR.(JR.EQ.JC))GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      AL=(RMK(IOSC1)-RN)*2.0D0-1.0D0
      RP1=1.0D0-RJ*(AL-RJ)/RMK(IOSC1)
      RP=RJ**4+AL*AL*(RJ+1.0D0)*RJ
      RP3=RJ*(AL-RJ)*(2.0D0*RN+1.0D0)-AL*RJ*RJ*(2.0D0*RJ+1.0D0)
      RP1=(RP1+(RP+RP3)/(8.0D0*RMK(IOSC1)*RMK(IOSC1)))*
     1      OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
      RP2=0.5D0*OVER(IOSC2,JR+1,JC+1)*RLS(JR,JC)
      RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      SUBROUTINE YPPY(IOSC1,IOSC2,IW1,IW2,OVER,H)
C     -----------------------(Y1*P1+P1*Y1)*(Y2*P2+P2*Y2)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC2
      INTEGER LR,LC,IR,IC,JR,JC
      REAL*8 H(NOBAS,NOBAS),OVER(2,MBASP1,MBASP1),
     1      RN,RJ,RP1,RP2,RP3,AL,RP,RLN,RLS
      INTEGER IW1(LENIW),IW2(LENIW)
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      DO 1 LR=1,NOBAS
      IR=IW1(LR)
      JR=IW2(LR)
      DO 1 LC=1,NOBAS
      IC=IW1(LC)
      JC=IW2(LC)
      H(LR,LC)=0.0D+00
      IF((IR.EQ.IC).OR.(JR.EQ.JC))GOTO 1
      RJ=DABS(DFLOAT(IR-IC))
      RN=RLN(IR,IC)
      RP1=1.0D0-RJ+RJ*(2.0D0*RN+RJ+1.0D0)/(2.0D0*RMK(IOSC1))
      RP1=RP1*OVER(IOSC1,IR+1,IC+1)*RLS(IR,IC)
C
      RJ=DABS(DFLOAT(JR-JC))
      RN=RLN(JR,JC)
      RP2=1.0D0-RJ+RJ*(2.0D0*RN+RJ+1.0D0)/(2.0D0*RMK(IOSC2))
      RP2=RP2*OVER(IOSC2,JR+1,JC+1)*RLS(JR,JC)
      RP=RP1*RP2
      H(LR,LC)=RP
1     CONTINUE
      RETURN
      END
C
C
      DOUBLE PRECISION FUNCTION RLN(IR,IC)
      IMPLICIT REAL*8 (A-H,O-Z)
      IM=IR-IC
      IF(IM.LT.0)GOTO 1
      RLN=DFLOAT(IC)
      RETURN
1     RLN=DFLOAT(IR)
      RETURN
      END
C
      DOUBLE PRECISION FUNCTION RLS(IR,IC)
      IMPLICIT REAL*8 (A-H,O-Z)
      IM=(IR-IC)/IABS(IR-IC)
      RLS=DFLOAT(IM)
      RETURN
      END
C
C
      SUBROUTINE HEADER
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      WRITE (NFIL6,1000)
C
      WRITE (NFIL6,1001)
C
      WRITE (NFIL6,1002)
C
      WRITE (NFIL6,1003)
C
      WRITE (NFIL6,1004)
C
      WRITE (NFIL6,1005)
C
1000  FORMAT(1H1,/,5X,
     1'MM      MM     OOOOOO    RRRRRRRR    ',
     1'BBBBBBBB       IIIIII    DDDDDDDD         11   ',/,5X,
     2'MM      MM     000000    RRRRRRRR    ',
     2'BBBBBBBB       IIIIII    DDDDDDDD         11   ',/,5X,
     3'MMMM  MMMM   OO      OO  RR      RR  ',
     3'BB      BB       II      DD      DD     1111   ',/,5X,
     4'MMMM  MMMM   OO      OO  RR      RR  ',
     4'BB      BB       II      DD      DD     1111   ',/,5X,
     5'MM  MM  MM   OO      OO  RR      RR  ',
     5'BB      BB       II      DD      DD       11   ',/,5X,
     6'MM  MM  MM   OO      OO  RR      RR  ',
     6'BB      BB       II      DD      DD       11   ',/,5X,
     7'MM      MM   OO      OO  RRRRRRRR    ',
     7'BBBBBBBB         II      DD      DD       11   ',/,5X,
     8'MM      MM   OO      OO  RRRRRRRR    ',
     8'BBBBBBBB         II      DD      DD       11   ',/,5X,
     9'MM      MM   OO      OO  RR  RR      ',
     9'BB      BB       II      DD      DD       11   ')
1001  FORMAT(1H ,4X,
     1'MM      MM   OO      OO  RR  RR      ',
     1'BB      BB       II      DD      DD       11   ',/,5X,
     2'MM      MM   OO      OO  RR    RR    ',
     2'BB      BB       II      DD      DD       11   ',/,5X,
     3'MM      MM   OO      OO  RR    RR    ',
     3'BB      BB       II      DD      DD       11   ',/,5X,
     4'MM      MM     OOOOOO    RR      RR  ',
     4'BBBBBBBB       IIIIII    DDDDDDDD       111111 ',/,5X,
     5'MM      MM     OOOOOO    RR      RR  ',
     5'BBBBBBBB       IIIIII    DDDDDDDD       111111 ')
1002  FORMAT(1H ,/,20X,
     1'                                       ZZ            ',/,20X,
     2'                                      ZZZZ           ',/,20X,
     3'                                     / ZZ            ',/,20X,
     4'                                   / R               ',/,20X,
     5'                                 /    32             ',/,20X,
     6'                R              /)  ___               ',/,20X,
     7'        XX       12       YY /   ) RHO               ',/,20X,
     8'       XXXX- - - - - - - YYYY-----)------            ',/,20X,
     9'        XX                YY                         ',/)
1003  FORMAT(1H ,//,19X,'MORSE OSCILLATOR/RIGID BENDER INTERN',
     1                  'AL DYNAMICS',
     2       1H ,//,20X,'A PROGRAM TO CALCULATE THE ROTATION-',
     3                  'VIBRATION',/,
     4              20X,'ENERGY LEVELS OF A TRIATOMIC MOLECULE ',
     5                  'AFTER',/,
     6              20X,'THE MORBID SCHEME OF PER JENSEN.'//
     7              5X,'PROGRAM DESIGNED AND WRITTEN BY :-',//)
1004  FORMAT(1H ,   2X,'                               PER JENSEN',/,
     1              2X,'DEPARTMENT OF CHEMISTRY,            ',
     1              10X,'MAX PLANCK INSTITUTE OF PHYSICS AND ',/,
     2              2X,'AARHUS UNIVERSITY,                  ',
     2              10X,'                             ASTROPHYSICS,',/,
     3              2X,'LANGELANDSGADE 140,                 ',
     3              10X,'INSTITUTE OF ASTROPHYSICS,',/,
     4              2X,'DK-8000 AARHUS C,                   ',
     4              10X,'KARL-SCHWARZSCHILD-STRASSE 1,',/,
     5              2X,'DENMARK                             ',
     5              10X,'D-8046 GARCHING BEI MUENCHEN,',/,
     5              2X,'                                    ',
     6              10X,'WEST GERMANY')
1005  FORMAT(1H ,//,12X,'PARTICULAR HELP WAS GIVEN BY:-',//,
     1              17X,'R. BEARDSWORTH, P.R. BUNKER, W.P. KRAEMER,',/,
     1              17X,'REDUCEII, AND V. SPIRKO.')
C
      RETURN
      END
C
C
      SUBROUTINE BCOEF
      IMPLICIT REAL*8 (A-H,O-Z)
C             :
C DATE        : 24.04.1986
C AUTHOR      : PER JENSEN
C UPDATES     :
C LANGUAGE    : FORTRAN
C PURPOSE     : BCOEF CALCULATES (FOR A GIVEN RHO VALUE) THE EXPANSION
C             : COEFFICIENTS (TO FOURTH ORDER) OF THE S I'S IN TERMS
C             : OF THE DELTA R I'S.
C             :
C SUBPROGRAMS :
C      CALLED :
C             :
C INPUT       : RHO  INSTANTANEOUS VALUE OF THE BENDING COORDINATE
C             :
C OUTPUT      : THE EXPANSION COEFFICIENTS OF MINUS COSINE RHO BAR IN
C             : TERMS OF THE DELTA R I'S ARE OUTPUT IN COMMON CRCOEF
C             :
C             :
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 A11,A33,A13,A31,A111,A133,A113,A311,A333,A313
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      A11=2.D0*RE12
      A13=0.D0
      A111=(V**2-SR**2*U13**2+2.D0*SR**2*U3*U1)/(V**2+2.D0*V*SR**2*
     1 U13+SR**4*U13**2)
      A133=(SR**2*U3**2*RE12**2)/((V**2+2.D0*V*SR**2*U13+SR**4*U13
     1 **2)*RE32**2)
      A113=(2.D0*SR**2*U13*U3*CR*RE12)/((V**2+2.D0*V*SR**2*U13+SR**4
     1 *U13**2)*RE32)
      A31=0.D0
      A33=2.D0*RE32
      A311=(SR**2*U1**2*RE32**2)/((V**2+2.D0*V*SR**2*U13+SR**4*U13
     1 **2)*RE12**2)
      A333=(V**2-SR**2*U13**2+2.D0*SR**2*U3*U1)/(V**2+2.D0*V*SR**2*
     1 U13+SR**4*U13**2)
      A313=(2.D0*SR**2*U13*U1*CR*RE32)/((V**2+2.D0*V*SR**2*U13+SR**4
     1 *U13**2)*RE12)
      B11=1.D0
      B13=0.D0
      B31=0.D0
      B33=1.D0
      B111=(-A111+1.D0)/(2.D0*RE12)
      B133=(-A133)/(2.D0*RE12)
      B113=(-A113)/(2.D0*RE12)
      B311=(-A311)/(2.D0*RE32)
      B333=(-A333+1.D0)/(2.D0*RE32)
      B313=(-A313)/(2.D0*RE32)
      B1111=(RE12*A113*A311+2.D0*A111**2*RE32-2.D0*A111*RE32)/(4.D0*
     1 RE12**2*RE32)
      B1333=(A133*(2.D0*RE12*A333-2.D0*RE12+A113*RE32))/(4.D0*RE12**2*
     1 RE32)
      B1113=(RE12*A113*A313+2.D0*RE12*A133*A311+3.D0*A111*A113*RE32-
     1 A113*RE32)/(4.D0*RE12**2*RE32)
      B1133=(RE12*A113*A333-RE12*A113+2.D0*RE12*A133*A313+2.D0*A111*
     1 A133*RE32+A113**2*RE32)/(4.D0*RE12**2*RE32)
      B3111=(A311*(RE12*A313+2.D0*A111*RE32-2.D0*RE32))/(4.D0*RE12*
     1 RE32**2)
      B3333=(2.D0*RE12*A333**2-2.D0*RE12*A333+A133*RE32*A313)/(4.D0*
     1 RE12*RE32**2)
      B3113=(2.D0*RE12*A311*A333+RE12*A313**2+A111*RE32*A313+2.D0*
     1 A113*RE32*A311-RE32*A313)/(4.D0*RE12*RE32**2)
      B3133=(3.D0*RE12*A313*A333-RE12*A313+A113*RE32*A313+2.D0*A133*
     1 RE32*A311)/(4.D0*RE12*RE32**2)
      B11111=(-RE12**2*A113*A311*A313-RE12**2*A133*A311**2-5.D0*
     1 RE12*A111*A113*RE32*A311+3.D0*RE12*A113*RE32*A311-5.D0*A111**
     1 3*RE32**2+6.D0*A111**2*RE32**2-A111*RE32**2)/(8.D0*RE12**3*
     1 RE32**2)
      B13333=(A133*(-5.D0*RE12**2*A333**2+6.D0*RE12**2*A333-RE12**2-
     1 3.D0*RE12*A113*RE32*A333+3.D0*RE12*A113*RE32
     1 -2.D0*RE12*A133*RE32
     1 *A313-A111*A133*RE32**2-A113**2*RE32**2))/(8.D0*RE12**3*
     1 RE32**2)
      B11113=(-2.D0*RE12**2*A113*A311*A333-RE12**2*A113*A313**2-4.D0
     1 *RE12**2*A133*A311*A313-4.D0*RE12*A111*A113*RE32*A313-8.D0*
     1 RE12*A111*A133*RE32*A311-4.D0*RE12*A113**2*RE32*A311+2.D0*
     1 RE12*A113*RE32*A313+4.D0*RE12*A133*RE32*A311-10.D0*A111**2*
     1 A113*RE32**2+6.D0*A111*A113*RE32**2)/(8.D0*RE12**3*RE32**2)
      B11333=(-2.D0*RE12**2*A113*A333**2+2.D0*RE12**2*A113*A333-8.D0*
     1 RE12**2*A133*A313*A333+4.D0*RE12**2*A133*A313-4.D0*RE12*A111*
     1 A133*RE32*A333+4.D0*RE12*A111*A133*RE32-2.D0*RE12*A113**2*
     1 RE32*A333+2.D0*RE12*A113**2*RE32-6.D0*RE12*A113*A133*RE32*
     1 A313-4.D0*RE12*A133**2*RE32*A311-6.D0*A111*A113*A133*RE32**2-
     1 A113**3*RE32**2)/(8.D0*RE12**3*RE32**2)
      B11133=(-3.D0*RE12**2*A113*A313*A333+RE12**2*A113*A313-6.D0*
     1 RE12**2*A133*A311*A333+2.D0*RE12**2*A133*A311-3.D0*RE12**2*
     1 A133*A313**2-3.D0*RE12*A111*A113*RE32*A333+3.D0*RE12*A111*
     1 A113*RE32-6.D0*RE12*A111*A133*RE32*A313-3.D0*RE12*A113**2*
     1 RE32*A313-9.D0*RE12*A113*A133*RE32*A311+RE12*A113*RE32*A333
     1 -RE12*A113*RE32+2.D0*RE12*A133*RE32*A313-6.D0*A111**2*A133*
     1 RE32**2-6.D0*A111*A113**2*RE32**2+2.D0*A111*A133*RE32**2+A113
     1 **2*RE32**2)/(8.D0*RE12**3*RE32**2)
      B31111=(A311*(-RE12**2*A311*A333-RE12**2*A313**2-3.D0*RE12*
     1 A111*RE32*A313-2.D0*RE12*A113*RE32*A311+3.D0*RE12*RE32*A313-
     1 5.D0*A111**2*RE32**2+6.D0*A111*RE32**2-RE32**2))/(8.D0*RE12**2*
     1 RE32**3)
      B33333=(-5.D0*RE12**2*A333**3+6.D0*RE12**2*A333**2-RE12**2*
     1 A333-5.D0*RE12*A133*RE32*A313*A333+3.D0*RE12*A133*RE32*A313-
     1 A113*A133*RE32**2*A313-A133**2*RE32**2*A311)/(8.D0*RE12**2*
     1 RE32**3)
      B31113=(-6.D0*RE12**2*A311*A313*A333-RE12**2*A313**3-4.D0*RE12
     1 *A111*RE32*A311*A333-2.D0*RE12*A111*RE32*A313**2-6.D0*RE12*
     1 A113*RE32*A311*A313-4.D0*RE12*A133*RE32*A311**2+4.D0*RE12*
     1 RE32*A311*A333+2.D0*RE12*RE32*A313**2-2.D0*A111**2*RE32**2*
     1 A313-8.D0*A111*A113*RE32**2*A311+2.D0*A111*RE32**2*A313+4.D0*
     1 A113*RE32**2*A311)/(8.D0*RE12**2*RE32**3)
      B31333=(-10.D0*RE12**2*A313*A333**2+6.D0*RE12**2*A313*A333-4.D0*
     1 RE12*A113*RE32*A313*A333+2.D0*RE12*A113*RE32*A313-8.D0*RE12*
     1 A133*RE32*A311*A333+4.D0*RE12*A133*RE32*A311-4.D0*RE12*A133*
     1 RE32*A313**2-2.D0*A111*A133*RE32**2*A313-A113**2*RE32**2*
     1 A313-4.D0*A113*A133*RE32**2*A311)/(8.D0*RE12**2*RE32**3)
      B31133=(-6.D0*RE12**2*A311*A333**2+2.D0*RE12**2*A311*A333-6.D0*
     1 RE12**2*A313**2*A333+RE12**2*A313**2-3.D0*RE12*A111*RE32*
     1 A313*A333+RE12*A111*RE32*A313-6.D0*RE12*A113*RE32*A311*A333
     1 +2.D0*RE12*A113*RE32*A311-3.D0*RE12*A113*RE32*A313**2-9.D0*RE12
     1 *A133*RE32*A311*A313+3.D0*RE12*RE32*A313*A333-RE12*RE32*
     1 A313-3.D0*A111*A113*RE32**2*A313-6.D0*A111*A133*RE32**2*A311-
     1 3.D0*A113**2*RE32**2*A311+A113*RE32**2*A313+2.D0*A133*RE32**2*
     1 A311)/(8.D0*RE12**2*RE32**3)
      END
C
C
      SUBROUTINE COSRB
      IMPLICIT REAL*8 (A-H,O-Z)
C             :
C DATE        : 24.04.1986
C AUTHOR      : PER JENSEN
C UPDATES     :
C LANGUAGE    : FORTRAN
C PURPOSE     : CALCULATION OF THE EXPANSION COEFFICIENTS OF COSINE RHO
C             : BAR IN TERMS OF THE DELTA R I'S.
C             : THE CODE IS GENERATED BY REDUCE.
C             :
C SUBPROGRAMS :
C      CALLED :
C             :
C INPUT       : RHO  INSTANTANEOUS VALUE OF THE BENDING COORDINATE
C             :
C OUTPUT      : THE EXPANSION COEFFICIENTS OF MINUS COSINE RHO BAR IN
C             : TERMS OF THE DELTA R I'S ARE OUTPUT IN COMMON CRCOEF
C             :
C             :
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 A11,A33,A13,A31,A111,A133,A113,A311,A333,A313,
     1      C11,C13,C211,C233,C213,
     2      Q1,Q3,Q11,Q33,Q13,Q111,Q333,Q113,Q133,Q1111,Q3333,
     3      Q1113,Q1333,Q1133
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      A11=2.D0*RE12
      A13=0.D0
      A111=(V**2-SR**2*U13**2+2.D0*SR**2*U3*U1)/(V**2+2.D0*V*SR**2*
     1 U13+SR**4*U13**2)
      A133=(SR**2*U3**2*RE12**2)/((V**2+2.D0*V*SR**2*U13+SR**4*U13
     1 **2)*RE32**2)
      A113=(2.D0*SR**2*U13*U3*CR*RE12)/((V**2+2.D0*V*SR**2*U13+SR**4
     1 *U13**2)*RE32)
      A31=0.D0
      A33=2.D0*RE32
      A311=(SR**2*U1**2*RE32**2)/((V**2+2.D0*V*SR**2*U13+SR**4*U13
     1 **2)*RE12**2)
      A333=(V**2-SR**2*U13**2+2.D0*SR**2*U3*U1)/(V**2+2.D0*V*SR**2*
     1 U13+SR**4*U13**2)
      A313=(2.D0*SR**2*U13*U1*CR*RE32)/((V**2+2.D0*V*SR**2*U13+SR**4
     1 *U13**2)*RE12)
      C11=((V*CR-SR**2*U1)*RE32)/(V+SR**2*U13)
      C13=((V*CR-SR**2*U3)*RE12)/(V+SR**2*U13)
      C211=(-(V+U13)*SR**2*U1*RE32)/((V**2+2.D0*V*SR**2*U13+SR**4*
     1 U13**2)*RE12)
      C233=(-(V+U13)*SR**2*U3*RE12)/((V**2+2.D0*V*SR**2*U13+SR**4*
     1 U13**2)*RE32)
      C213=((V**2+SR**2*U13**2+SR**2*U3*U1)*CR)/(V**2+2.D0*V*SR**2
     1 *U13+SR**4*U13**2)
      Q1=(-RE32*CR+B31*C13+B11*C11)/(RE12*RE32)
      Q3=(-RE12*CR+B33*C13+B13*C11)/(RE12*RE32)
      Q11=(RE12*(B311*C13+B31**2*C233+B31*B11*C213+B111*C11+B11
     1 **2*C211)+RE32*CR-(B31*C13+B11*C11))/(RE12**2*RE32)
      Q33=(RE12*CR+RE32*(B333*C13+B33**2*C233+B33*B13*C213+B133*
     1 C11+B13**2*C211)-(B33*C13+B13*C11))/(RE12*RE32**2)
      Q13=(RE12*RE32*(B313*C13+2.D0*B33*B31*C233+B33*B11*C213+B31*
     1 B13*C213+B113*C11+2.D0*B13*B11*C211+CR)-RE12*(B31*C13+B11*
     1 C11)-RE32*(B33*C13+B13*C11))/(RE12**2*RE32**2)
      Q111=(RE12**2*(B3111*C13+2.D0*B311*B31*C233+B311*B11*C213+
     1 B31*B111*C213+B1111*C11+2.D0*B111*B11*C211)-RE12*(B311*C13+
     1 B31**2*C233+B31*B11*C213+B111*C11+B11**2*C211)-RE32*CR+
     1 B31*C13+B11*C11)/(RE12**3*RE32)
      Q333=(-RE12*CR+RE32**2*(B3333*C13+2.D0*B333*B33*C233+B333*
     1 B13*C213+B33*B133*C213+B1333*C11+2.D0*B133*B13*C211)-RE32*(
     1 B333*C13+B33**2*C233+B33*B13*C213+B133*C11+B13**2*C211)+
     1 B33*C13+B13*C11)/(RE12*RE32**3)
      Q113=(RE12**2*RE32*(B3113*C13+2.D0*B313*B31*C233+B313*B11*
     1 C213+2.D0*B311*B33*C233+B311*B13*C213+B33*B111*C213+B31*
     1 B113*C213+B1113*C11+2.D0*B113*B11*C211+2.D0*B111*B13*C211)-
     1 RE12**2*(B311*C13+B31**2*C233+B31*B11*C213+B111*C11+B11**
     1 2*C211)+RE12*RE32*(-B313*C13-2.D0*B33*B31*C233-B33*B11*C213
     1 -B31*B13*C213-B113*C11-2.D0*B13*B11*C211-CR)+RE12*(B31*C13+
     1 B11*C11)+RE32*(B33*C13+B13*C11))/(RE12**3*RE32**2)
      Q133=(RE12*RE32**2*(B3133*C13+2.D0*B313*B33*C233+B313*B13*
     1 C213+2.D0*B333*B31*C233+B333*B11*C213+B33*B113*C213+B31*
     1 B133*C213+B1133*C11+2.D0*B113*B13*C211+2.D0*B133*B11*C211)+
     1 RE12*RE32*(-B313*C13-2.D0*B33*B31*C233-B33*B11*C213-B31*B13
     1 *C213-B113*C11-2.D0*B13*B11*C211-CR)+RE12*(B31*C13+B11*C11)
     1 -RE32**2*(B333*C13+B33**2*C233+B33*B13*C213+B133*C11+B13
     1 **2*C211)+RE32*(B33*C13+B13*C11))/(RE12**2*RE32**3)
      Q1111=(RE12**3*(B31111*C13+2.D0*B3111*B31*C233+B3111*B11*
     1 C213+B311**2*C233+B311*B111*C213+B31*B1111*C213+B11111*
     1 C11+2.D0*B1111*B11*C211+B111**2*C211)+RE12**2*(-B3111*C13-
     1 2.D0*B311*B31*C233-B311*B11*C213-B31*B111*C213-B1111*C11-2.D0*
     1 B111*B11*C211)+RE12*(B311*C13+B31**2*C233+B31*B11*C213+
     1 B111*C11+B11**2*C211)+RE32*CR-(B31*C13+B11*C11))/(RE12**4
     1 *RE32)
      Q3333=(RE12*CR+RE32**3*(2.D0*B3333*B33*C233+B3333*B13*C213+
     1 B333**2*C233+B333*B133*C213+B33*B1333*C213+B13333*C11+2.D0*
     1 B1333*B13*C211+B133**2*C211+C13*B33333)+RE32**2*(-B3333*
     1 C13-2.D0*B333*B33*C233-B333*B13*C213-B33*B133*C213-B1333*
     1 C11-2.D0*B133*B13*C211)+RE32*(B333*C13+B33**2*C233+B33*B13*
     1 C213+B133*C11+B13**2*C211)-(B33*C13+B13*C11))/(RE12*RE32
     1 **4)
      Q1113=(RE12**3*RE32*(2.D0*B3113*B31*C233+B3113*B11*C213+2.D0*
     1 B3111*B33*C233+B3111*B13*C213+2.D0*B313*B311*C233+B313*B111
     1 *C213+B311*B113*C213+B33*B1111*C213+B31*B1113*C213+B11113
     1 *C11+2.D0*B1113*B11*C211+2.D0*B1111*B13*C211+2.D0*B113*B111*
     1 C211+C13*B31113)+RE12**3*(-B3111*C13-2.D0*B311*B31*C233-
     1 B311*B11*C213-B31*B111*C213-B1111*C11-2.D0*B111*B11*C211)+
     1 RE12**2*RE32*(-B3113*C13-2.D0*B313*B31*C233-B313*B11*C213-
     1 2.D0*B311*B33*C233-B311*B13*C213-B33*B111*C213-B31*B113*C213
     1 -B1113*C11-2.D0*B113*B11*C211-2.D0*B111*B13*C211)+RE12**2*(
     1 B311*C13+B31**2*C233+B31*B11*C213+B111*C11+B11**2*C211)+
     1 RE12*RE32*(B313*C13+2.D0*B33*B31*C233+B33*B11*C213+B31*B13*
     1 C213+B113*C11+2.D0*B13*B11*C211+CR)-RE12*(B31*C13+B11*C11)-
     1 RE32*(B33*C13+B13*C11))/(RE12**4*RE32**2)
      Q1333=(RE32**3*RE12*(2.D0*B1133*B13*C211+B1133*B33*C213+2.D0*
     1 B1333*B11*C211+B1333*B31*C213+2.D0*B113*B133*C211+B113*B333
     1 *C213+B133*B313*C213+B11*B3333*C213+B13*B3133*C213+B31333
     1 *C13+2.D0*B3133*B33*C233+2.D0*B3333*B31*C233+2.D0*B313*B333*
     1 C233+C11*B11333)+RE32**3*(-B1333*C11-2.D0*B133*B13*C211-
     1 B133*B33*C213-B13*B333*C213-B3333*C13-2.D0*B333*B33*C233)+
     1 RE32**2*RE12*(-B1133*C11-2.D0*B113*B13*C211-B113*B33*C213-
     1 2.D0*B133*B11*C211-B133*B31*C213-B11*B333*C213-B13*B313*C213
     1 -B3133*C13-2.D0*B313*B33*C233-2.D0*B333*B31*C233)+RE32**2*(
     1 B133*C11+B13**2*C211+B13*B33*C213+B333*C13+B33**2*C233)+
     1 RE32*RE12*(B113*C11+2.D0*B11*B13*C211+B11*B33*C213+B13*B31*
     1 C213+B313*C13+2.D0*B31*B33*C233+CR)-RE32*(B13*C11+B33*C13)-
     1 RE12*(B11*C11+B31*C13))/(RE32**4*RE12**2)
      Q1133=(RE12**2*RE32**2*(2.D0*B3133*B31*C233+B3133*B11*C213+
     1 2.D0*B3113*B33*C233+B3113*B13*C213+B313**2*C233+B313*B113*
     1 C213+2.D0*B333*B311*C233+B333*B111*C213+B311*B133*C213+B33*
     1 B1113*C213+B31*B1133*C213+B11133*C11+2.D0*B1133*B11*C211+2.D0
     1 *B1113*B13*C211+B113**2*C211+2.D0*B133*B111*C211+C13*B31133
     1 )+RE12**2*RE32*(-B3113*C13-2.D0*B313*B31*C233-B313*B11*C213
     1 -2.D0*B311*B33*C233-B311*B13*C213-B33*B111*C213-B31*B113*
     1 C213-B1113*C11-2.D0*B113*B11*C211-2.D0*B111*B13*C211)+RE12**2
     1 *(B311*C13+B31**2*C233+B31*B11*C213+B111*C11+B11**2*C211)
     1 +RE12*RE32**2*(-B3133*C13-2.D0*B313*B33*C233-B313*B13*C213-
     1 2.D0*B333*B31*C233-B333*B11*C213-B33*B113*C213-B31*B133*C213
     1 -B1133*C11-2.D0*B113*B13*C211-2.D0*B133*B11*C211)+RE12*RE32*(
     1 B313*C13+2.D0*B33*B31*C233+B33*B11*C213+B31*B13*C213+B113*
     1 C11+2.D0*B13*B11*C211+CR)-RE12*(B31*C13+B11*C11)+RE32**2*(
     1 B333*C13+B33**2*C233+B33*B13*C213+B133*C11+B13**2*C211)-
     1 RE32*(B33*C13+B13*C11))/(RE12**3*RE32**3)
      CR1=-Q1
      CR3=-Q3
      CR11=-Q11
      CR33=-Q33
      CR13=-Q13
      CR111=-Q111
      CR333=-Q333
      CR113=-Q113
      CR133=-Q133
      CR1111=-Q1111
      CR3333=-Q3333
      CR1113=-Q1113
      CR1333=-Q1333
      CR1133=-Q1133
      RETURN
      END
C
C
      SUBROUTINE MUTENS (  MUXXY , MUYYY , MUZZY ,
     2                    MUYZY , MURRY , MUXRY ,
     3                    PXMXX1  , PXMXX3 , PRMXR1 , PRMXR3 ,
     2                    PXMXR1  , PXMXR3 , PRMRR1 , PRMRR3 )
      IMPLICIT REAL*8 (A-H,O-Z)
C             :
C DATE        : 28.04.1986
C AUTHOR      : PER JENSEN
C UPDATES     :
C LANGUAGE    : FORTRAN
C PURPOSE     : CALCULATION OF THE EXPANSION COEFFICINTETS (IN THE
C             : S I'S, THE DELTA R I S, AND THE Y I'S) OF THE NON-
C             : VANISHING MU TENSOR ELEMENTS.
C SUBPROGRAMS :
C      CALLED : AMAT, TRNSSR, INVERT, TRNSRY
C             :
C INPUT       : RHO  INSTANTANEOUS VALUE OF THE BENDING COORDINATE
C             : EPS  INSTANTANEOUS VALUE OF THE ANGLE EPSILON DEFINED
C             :      IN P. JENSEN, COMP. PHYS. REP. 1, 1-55 (1983)
C             :
C OUTPUT      : MUABY(1:15) (AB = XX, YY, ZZ, RR, YZ, AND RX). EXPANSION
C             :             COEFFICIENTS OF THE MUAB TENSOR ELEMENT IN
C             :             TERMS OF THE YI PARAMETERS.
C             :
C             :
C    THE ARRAYS CONTAIN THE COEFFICIENTS OF THE FOLLOWING
C    QUANTITIES:
C
C    I             IABS(I)        IABR(I)           MUABY(I)
C  -------------------------------------------------------------
C    1             1              1                 1
C    2             S1             DR1               Y1
C    3             S3             DR3               Y3
C    4             S1**2          DR1**2            Y1**2
C    5             S3**2          DR3**2            Y3**2
C    6             S1*S3          DR1*DR3           Y1*Y3
C    7                            DR1**3            Y1**3
C    8                            DR3**3            Y3**3
C    9                            DR1**2*DR3        Y1**2*Y3
C   10                            DR1*DR3**2        Y1*Y3**2
C   11                            DR1**4            Y1**4
C   12                            DR3**4            Y3**4
C   13                            DR1**3*DR3        Y1**3*Y3
C   14                            DR1*DR3**3        Y1*Y3**3
C   15                            DR1**2*DR3**2     Y1**2*Y3**2
C
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 IXXS(6),IYYS(6),IZZS(6),IRRS(6),IYZS(6),IXRS(6),
     1       IXXR(15),IYYR(15),IZZR(15),IRRR(15),IYZR(15),IXRR(15),
     2       MUXXR(15),MUYYR(15),MUZZR(15),MURRR(15),
     3       MUYZR(15),MUXRR(15),
     4       MUXXY(15),MUYYY(15),MUZZY(15),MURRY(15),
     3       MUYZY(15),MUXRY(15),
     5       PX1R(15),PX3R(15),PR1R(15),PR3R(15),PX1Y(15),
     6       PX3Y(15),PR1Y(15),PR3Y(15),
     7       PXMXX1(15),PXMXX3(15),PRMXR1(15),PRMXR3(15),
     8       PXMXR1(15),PXMXR3(15),PRMRR1(15),PRMRR3(15)
      REAL*8  A1Y1,A1Z1,A2Y1,A2Z1,A3Y1,A3Z1,
     2       A1Y3,A1Z3,A2Y3,A2Z3,A3Y3,A3Z3,
     3       AP1Y1,AP1Z1,AP2Y1,AP2Z1,AP3Y1,AP3Z1,
     4       AP1Y3,AP1Z3,AP2Y3,AP2Z3,AP3Y3,AP3Z3,
     5       YE1,ZE1,YE2,ZE2,YE3,ZE3,
     6       YEP1,ZEP1,YEP2,ZEP2,YEP3,ZEP3,
     7       YEPP1,ZEPP1,YEPP2,ZEPP2,YEPP3,ZEPP3
      REAL*8  AMMA11,AMMA33,AMMA13,AMMA31,
     1       APMA11,APMA33,APMA13,APMA31,G11,G33,G13,G31,
     2       CHX11,CHX13,CHX31,CHX33,CHR11,CHR13,CHR31,CHR33
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      IXXS(1)=(U1+U3+2.0D0*U13*CR)/M
      IYYS(1)=(U1*CRE**2+U3*CSE**2+2.0D0*U13*CSE*CRE)/M
      IZZS(1)=(U1*SRE**2+U3*SNE**2-2.0D0*U13*SNE*SRE)/M
      IYZS(1)=(U1*DSIN(2.0D0*(RHO-EPS))-U3*DSIN(2.0D0*EPS)
     1        +2.0D0*U13*DSIN(RHO-2.0D0*EPS))/(2.0D0*M)
      IRRS(1)=(U1*U3-U13*U13*CR*CR)/(U1+U3+2.0D+00*U13*CR)/M
      IXRS(1)=0.0D0
C
C UPON INPUT OF RHO AND EPS, THE SUBROUTINE AMAT CALCULATES THE
C NECESSARY VALUES OF THE A MATRIX ELEMENTS, THE A PRIME
C MATRIX ELEMENTS, THE A VECTOR COMPONENTS AND THEIR FIRST
C AND SECOND DERIVATIVES.
C
      CALL AMAT ( A1Y1,A1Z1,A2Y1,A2Z1,A3Y1,A3Z1,
     2           A1Y3,A1Z3,A2Y3,A2Z3,A3Y3,A3Z3,
     3           AP1Y1,AP1Z1,AP2Y1,AP2Z1,AP3Y1,AP3Z1,
     4           AP1Y3,AP1Z3,AP2Y3,AP2Z3,AP3Y3,AP3Z3,
     5           YE1,ZE1,YE2,ZE2,YE3,ZE3,
     6           YEP1,ZEP1,YEP2,ZEP2,YEP3,ZEP3,
     7           YEPP1,ZEPP1,YEPP2,ZEPP2,YEPP3,ZEPP3)
C
C     THE FOLLOWING EXPRESSIONS FOR EXPANSION COEFFICIENTS OF
C     THE I TENSOR ELEMENTS IN TERMS OF THE SI COORDINATES ARE
C     TAKEN FROM EQ. (20) OF J. HOUGEN, P.R. BUNKER, AND
C     J.W.C. JOHNS, J. MOL. SPECTROSC. 34, 136-172 (1970).
C
      IYYS(2)=
     1 2.0D+00*(M1*ZE1*A1Z1+M2*ZE2*A2Z1+M3*ZE3*A3Z1)
      IYYS(3)=
     1 2.0D+00*(M1*ZE1*A1Z3+M2*ZE2*A2Z3+M3*ZE3*A3Z3)
      IYYS(4)=
     1  M1*A1Z1*A1Z1
     2 +M2*A2Z1*A2Z1
     3 +M3*A3Z1*A3Z1
      IYYS(5)=
     1  M1*A1Z3*A1Z3
     2 +M2*A2Z3*A2Z3
     3 +M3*A3Z3*A3Z3
      IYYS(6)=
     1  2.0D+00*(M1*A1Z1*A1Z3
     2          +M2*A2Z1*A2Z3
     3          +M3*A3Z1*A3Z3)
      IZZS(2)=
     1 2.0D+00*(M1*YE1*A1Y1+M2*YE2*A2Y1+M3*YE3*A3Y1)
      IZZS(3)=
     1 2.0D+00*(M1*YE1*A1Y3+M2*YE2*A2Y3+M3*YE3*A3Y3)
      IZZS(4)=
     1  M1*A1Y1*A1Y1
     2 +M2*A2Y1*A2Y1
     3 +M3*A3Y1*A3Y1
      IZZS(5)=
     1  M1*A1Y3*A1Y3
     2 +M2*A2Y3*A2Y3
     3 +M3*A3Y3*A3Y3
      IZZS(6)=
     1  2.0D+00*(M1*A1Y1*A1Y3
     2          +M2*A2Y1*A2Y3
     3          +M3*A3Y1*A3Y3)
      IXXS(1)=IYYS(1)+IZZS(1)
      IXXS(2)=IYYS(2)+IZZS(2)
      IXXS(3)=IYYS(3)+IZZS(3)
      IXXS(4)=IYYS(4)+IZZS(4)
      IXXS(5)=IYYS(5)+IZZS(5)
      IXXS(6)=IYYS(6)+IZZS(6)
      IYZS(2)=
     1 -(M1*YE1*A1Z1+M2*YE2*A2Z1+M3*YE3*A3Z1)
     2 -(M1*ZE1*A1Y1+M2*ZE2*A2Y1+M3*ZE3*A3Y1)
      IYZS(3)=
     1 -(M1*YE1*A1Z3+M2*YE2*A2Z3+M3*YE3*A3Z3)
     2 -(M1*ZE1*A1Y3+M2*ZE2*A2Y3+M3*ZE3*A3Y3)
      IYZS(4)=
     1 -M1*A1Y1*A1Z1
     2 -M2*A2Y1*A2Z1
     3 -M3*A3Y1*A3Z1
      IYZS(5)=
     1 -M1*A1Y3*A1Z3
     2 -M2*A2Y3*A2Z3
     3 -M3*A3Y3*A3Z3
      IYZS(6)=
     1 -M1*(A1Y1*A1Z3+A1Y3*A1Z1)
     2 -M2*(A2Y1*A2Z3+A2Y3*A2Z1)
     3 -M3*(A3Y1*A3Z3+A3Y3*A3Z1)
      IXRS(2)=
     1 -2.0D+00*(M1*(YEP1*A1Z1-ZEP1*A1Y1)
     2          +M2*(YEP2*A2Z1-ZEP2*A2Y1)
     3          +M3*(YEP3*A3Z1-ZEP3*A3Y1))
      IXRS(3)=
     1 -2.0D+00*(M1*(YEP1*A1Z3-ZEP1*A1Y3)
     2          +M2*(YEP2*A2Z3-ZEP2*A2Y3)
     3          +M3*(YEP3*A3Z3-ZEP3*A3Y3))
      IXRS(4)=
     1  M1*(A1Y1*AP1Z1-A1Z1*AP1Y1)
     2 +M2*(A2Y1*AP2Z1-A2Z1*AP2Y1)
     3 +M3*(A3Y1*AP3Z1-A3Z1*AP3Y1)
      IXRS(5)=
     1  M1*(A1Y3*AP1Z3-A1Z3*AP1Y3)
     2 +M2*(A2Y3*AP2Z3-A2Z3*AP2Y3)
     3 +M3*(A3Y3*AP3Z3-A3Z3*AP3Y3)
      IXRS(6)=
     1           M1*(A1Y1*AP1Z3-A1Z1*AP1Y3)
     2          +M2*(A2Y1*AP2Z3-A2Z1*AP2Y3)
     3          +M3*(A3Y1*AP3Z3-A3Z1*AP3Y3)
     1          +M1*(A1Y3*AP1Z1-A1Z3*AP1Y1)
     2          +M2*(A2Y3*AP2Z1-A2Z3*AP2Y1)
     3          +M3*(A3Y3*AP3Z1-A3Z3*AP3Y1)
      IRRS(2)=
     1 -2.0D+00*(M1*(YEPP1*A1Y1+ZEPP1*A1Z1)
     2          +M2*(YEPP2*A2Y1+ZEPP2*A2Z1)
     3          +M3*(YEPP3*A3Y1+ZEPP3*A3Z1))
      IRRS(3)=
     1 -2.0D+00*(M1*(YEPP1*A1Y3+ZEPP1*A1Z3)
     2          +M2*(YEPP2*A2Y3+ZEPP2*A2Z3)
     3          +M3*(YEPP3*A3Y3+ZEPP3*A3Z3))
      IRRS(4)=
     1  M1*(AP1Y1*AP1Y1+AP1Z1*AP1Z1)
     2 +M2*(AP2Y1*AP2Y1+AP2Z1*AP2Z1)
     3 +M3*(AP3Y1*AP3Y1+AP3Z1*AP3Z1)
      IRRS(5)=
     1  M1*(AP1Y3*AP1Y3+AP1Z3*AP1Z3)
     2 +M2*(AP2Y3*AP2Y3+AP2Z3*AP2Z3)
     3 +M3*(AP3Y3*AP3Y3+AP3Z3*AP3Z3)
      IRRS(6)=
     1  2.0D+00*(M1*(AP1Y1*AP1Y3+AP1Z1*AP1Z3)
     2          +M2*(AP2Y1*AP2Y3+AP2Z1*AP2Z3)
     3          +M3*(AP3Y1*AP3Y3+AP3Z1*AP3Z3))
C
C     THE FOLLOWING EXPRESSIONS ENTER INTO EQ. (17) OF
C     T. HOUGEN, P.R. BUNKER, AND J.W.C. JOHNS, J. MOL.
C     SPECTROSC. 34, 136-172 (1970). THEY ARE USED TO
C     CALCULATE THE I PRIME TENSOR FROM THE I TENSOR.
C
C       CALCULATION OF (A TR M M ALPHA A)
      AMMA11=0.0D0
      AMMA33=0.0D0
      AMMA13=
     1  M1*(A1Y1*A1Z3-A1Z1*A1Y3)
     2 +M2*(A2Y1*A2Z3-A2Z1*A2Y3)
     3 +M3*(A3Y1*A3Z3-A3Z1*A3Y3)
      AMMA31=-AMMA13
C       CALCULATION OF (AP TR M A)
      APMA11=
     1  M1*(AP1Y1*A1Y1+AP1Z1*A1Z1)
     2 +M2*(AP2Y1*A2Y1+AP2Z1*A2Z1)
     3 +M3*(AP3Y1*A3Y1+AP3Z1*A3Z1)
      APMA33=
     1  M1*(AP1Y3*A1Y3+AP1Z3*A1Z3)
     2 +M2*(AP2Y3*A2Y3+AP2Z3*A2Z3)
     3 +M3*(AP3Y3*A3Y3+AP3Z3*A3Z3)
      APMA13=
     1  M1*(AP1Y1*A1Y3+AP1Z1*A1Z3)
     2 +M2*(AP2Y1*A2Y3+AP2Z1*A2Z3)
     3 +M3*(AP3Y1*A3Y3+AP3Z1*A3Z3)
      APMA31=
     1  M1*(AP1Y3*A1Y1+AP1Z3*A1Z1)
     2 +M2*(AP2Y3*A2Y1+AP2Z3*A2Z1)
     3 +M3*(AP3Y3*A3Y1+AP3Z3*A3Z1)
      G11=(M1+M2)/(M1*M2)
      G33=(M3+M2)/(M3*M2)
      G13=-CR/M2
      G31=G13
      IXXS(4) = IXXS(4) -
     1                 (AMMA11*G11*AMMA11+AMMA13*G33*AMMA13
     2                 +AMMA11*G13*AMMA13+AMMA13*G31*AMMA11)
      IXXS(5) = IXXS(5) -
     1                 (AMMA31*G11*AMMA31+AMMA33*G33*AMMA33
     2                 +AMMA31*G13*AMMA33+AMMA33*G31*AMMA31)
      IXXS(6) = IXXS(6) -
     1            (AMMA11*G11*AMMA31+AMMA13*G33*AMMA33
     2            +AMMA11*G13*AMMA33+AMMA13*G31*AMMA31
     1            +AMMA31*G11*AMMA11+AMMA33*G33*AMMA13
     2            +AMMA31*G13*AMMA13+AMMA33*G31*AMMA11)
      IRRS(4) = IRRS(4) -
     1                 (APMA11*G11*APMA11+APMA13*G33*APMA13
     2                 +APMA11*G13*APMA13+APMA13*G31*APMA11)
      IRRS(5) = IRRS(5) -
     1                 (APMA31*G11*APMA31+APMA33*G33*APMA33
     2                 +APMA31*G13*APMA33+APMA33*G31*APMA31)
      IRRS(6) = IRRS(6) -
     1             (APMA11*G11*APMA31+APMA13*G33*APMA33
     2             +APMA11*G13*APMA33+APMA13*G31*APMA31
     1             +APMA31*G11*APMA11+APMA33*G33*APMA13
     2             +APMA31*G13*APMA13+APMA33*G31*APMA11)
      IXRS(4) = IXRS(4) -
     1                 (AMMA11*G11*APMA11+AMMA13*G33*APMA13
     2                 +AMMA11*G13*APMA13+AMMA13*G31*APMA11)
      IXRS(5) = IXRS(5) -
     1                 (AMMA31*G11*APMA31+AMMA33*G33*APMA33
     2                 +AMMA31*G13*APMA33+AMMA33*G31*APMA31)
      IXRS(6) = IXRS(6) -
     1              (AMMA11*G11*APMA31+AMMA13*G33*APMA33
     2              +AMMA11*G13*APMA33+AMMA13*G31*APMA31
     1              +AMMA31*G11*APMA11+AMMA33*G33*APMA13
     2              +AMMA31*G13*APMA13+AMMA33*G31*APMA11)
C
C     CONVERT FROM POLYNOMIALS IN S TO POLYNOMIALS IN DELTA R
C
      CALL TRNSSR ( IXXS , IXXR )
      CALL TRNSSR ( IYYS , IYYR )
      CALL TRNSSR ( IZZS , IZZR )
      CALL TRNSSR ( IYZS , IYZR )
      CALL TRNSSR ( IRRS , IRRR )
      CALL TRNSSR ( IXRS , IXRR )
C
C     CONVERT THE X-RHO CORNER OF THE I TENSOR TO MU TENSOR
C     ELEMENTS
C
      CALL INVERT  ( IXXR , IRRR , IXRR , MUXXR , MURRR , MUXRR )
C
C     CONVERT THE Y-Z CORNER OF THE I TENSOR TO MU TENSOR
C     ELEMENTS
C
      CALL INVERT  ( IYYR , IZZR , IYZR , MUYYR , MUZZR , MUYZR )
C
C     CONVERT FROM POLYNOMIALS IN DELTA R TO POLYNOMIALS IN Y
C
      CALL TRNSRY (MUXXR , MUXXY )
      CALL TRNSRY (MUYYR , MUYYY )
      CALL TRNSRY (MUZZR , MUZZY )
      CALL TRNSRY (MUYZR , MUYZY )
      CALL TRNSRY (MURRR , MURRY )
      CALL TRNSRY (MUXRR , MUXRY )
      CHX11=AMMA11*G11+AMMA13*G31
      CHX13=AMMA11*G13+AMMA13*G33
      CHX31=AMMA31*G11+AMMA33*G31
      CHX33=AMMA31*G13+AMMA33*G33
      CHR11=APMA11*G11+APMA13*G31
      CHR13=APMA11*G13+APMA13*G33
      CHR31=APMA31*G11+APMA33*G31
      CHR33=APMA31*G13+APMA33*G33
C
C     CALCULATION OF THE EXPANSION COEFFICIENTS OF THE VIBRATIONAL
C     ANGULAR MOMENTA P SUB X AND P SUB RHO.
C
      CALL VIBRAM ( CHX11 , CHX13 , CHX31 , CHX33 ,
     1             CHR11 , CHR13 , CHR31 , CHR33 ,
     2             PX1R  , PX3R  , PR1R  , PR3R  )
C
      CALL TRNSRY (PX1R , PX1Y )
      CALL TRNSRY (PX3R , PX3Y )
      CALL TRNSRY (PR1R , PR1Y )
      CALL TRNSRY (PR3R , PR3Y )
C
C     CALCULATION OF THE EXPANSION COEFFICIENTS OF THE PRODUCTS OF
C     THE VIBRATIONAL ANGULAR MOMENTA P SUB X AND P SUB RHO WITH
C     THE RELEVANT MU TENSOR ELEMENTS FOR THE CORIOLIS TERMS IN
C     THE MORBID SCHEME.
C
      CALL MUPV ( MUXXY , PX1Y , PX3Y , PXMXX1 , PXMXX3 )
      CALL MUPV ( MUXRY , PR1Y , PR3Y , PRMXR1 , PRMXR3 )
      CALL MUPV ( MUXRY , PX1Y , PX3Y , PXMXR1 , PXMXR3 )
      CALL MUPV ( MURRY , PR1Y , PR3Y , PRMRR1 , PRMRR3 )
      RETURN
      END
C
C
      SUBROUTINE AMAT ( A1Y1,A1Z1,A2Y1,A2Z1,A3Y1,A3Z1,
     2                 A1Y3,A1Z3,A2Y3,A2Z3,A3Y3,A3Z3,
     3                 AP1Y1,AP1Z1,AP2Y1,AP2Z1,AP3Y1,AP3Z1,
     4                 AP1Y3,AP1Z3,AP2Y3,AP2Z3,AP3Y3,AP3Z3,
     5                 YE1,ZE1,YE2,ZE2,YE3,ZE3,
     6                 YEP1,ZEP1,YEP2,ZEP2,YEP3,ZEP3,
     7                 YEPP1,ZEPP1,YEPP2,ZEPP2,YEPP3,ZEPP3)
      IMPLICIT REAL*8 (A-H,O-Z)
C            :
C DATE       : 24.04.1986
C AUTHOR     : PER JENSEN
C UPDATES    :
C LANGUAGE   : FORTRAN
C PURPOSE    : CALCULATION OF THE A MATRIX, ITS DERIVATIVES AND THE
C            : A VECTOR COMPONENTS AND THEIR DERIVATIVES.
C            : THE CODE IS GENERATED BY REDUCE.
C            :
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8  A1Y1,A1Z1,A2Y1,A2Z1,A3Y1,A3Z1,
     2       A1Y3,A1Z3,A2Y3,A2Z3,A3Y3,A3Z3,
     3       AP1Y1,AP1Z1,AP2Y1,AP2Z1,AP3Y1,AP3Z1,
     4       AP1Y3,AP1Z3,AP2Y3,AP2Z3,AP3Y3,AP3Z3,
     5       YE1,ZE1,YE2,ZE2,YE3,ZE3,
     6       YEP1,ZEP1,YEP2,ZEP2,YEP3,ZEP3,
     7       YEPP1,ZEPP1,YEPP2,ZEPP2,YEPP3,ZEPP3
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      A1Y1=((M3+M2)*SRE*M2)/(SR**2*M1*M3+M*M2)
      A1Z1=(-(M3+M2)*CRE*M2)/(SR**2*M1*M3+M*M2)
      A2Y1=(-((M3+M2)*SRE+CR*SNE*M3)*M1)/(
     1 SR**2*M1*M3+M*M2)
      A2Z1=(((M3+M2)*CRE-CR*CSE*M3)*M1)/(
     1 SR**2*M1*M3+M*M2)
      A3Y1=(CR*SNE*M1*M2)/(SR**2*M1*M3+M*
     1 M2)
      A3Z1=(CR*CSE*M1*M2)/(SR**2*M1*M3+M*
     1 M2)
      A1Y3=(CR*SRE*M3*M2)/(SR**2*M1*M3+M*
     1 M2)
      A1Z3=(-CR*CRE*M3*M2)/(SR**2*M1*M3+M*
     1 M2)
      A2Y3=(-((M1+M2)*SNE+CR*SRE*M1)*M3)/(
     1 SR**2*M1*M3+M*M2)
      A2Z3=(-((M1+M2)*CSE-CR*CRE*M1)*M3)/(
     1 SR**2*M1*M3+M*M2)
      A3Y3=((M1+M2)*SNE*M2)/(SR**2*M1*M3+M*M2)
      A3Z3=((M1+M2)*CSE*M2)/(SR**2*M1*M3+M*M2)
      AP1Y1=(((SR**2*M1*M3+M*M2)*(CR*U13+U3)*
     1 CRE-2.D0*(2.D0*CR*U13+U3+U1)*SR*CR*SRE
     1 *M1*M3)*(M3+M2)*M2)/((SR**2*M1*M3+M*M2)**2*(2.D0
     1 *CR*U13+U3+U1))
      AP1Z1=(((SR**2*M1*M3+M*M2)*(CR*U13+U3)*
     1 SRE+2.D0*(2.D0*CR*U13+U3+U1)*SR*CR*CRE
     1 *M1*M3)*(M3+M2)*M2)/((SR**2*M1*M3+M*M2)**2*(2.D0
     1 *CR*U13+U3+U1))
      AP2Y1=((((2.D0*CR*U13+U3+U1)*SR*SNE*M3
     1 -(CR*U13+U3)*(M3+M2)*CRE-(CR*U13+U1)*CR
     1 *CSE*M3)*(SR**2*M1*M3+M*M2)+2.D0*((M3+M2)*
     1 SRE+CR*SNE*M3)*(2.D0*CR*U13+U3+U1)*
     1 SR*CR*M1*M3)*M1)/((SR**2*M1*M3+M*M2)**2
     1 *(2.D0*CR*U13+U3+U1))
      AP2Z1=((((2.D0*CR*U13+U3+U1)*SR*CSE*M3
     1 -(CR*U13+U3)*(M3+M2)*SRE+(CR*U13+U1)*CR
     1 *SNE*M3)*(SR**2*M1*M3+M*M2)-2.D0*((M3+M2)*
     1 CRE-CR*CSE*M3)*(2.D0*CR*U13+U3+U1)*
     1 SR*CR*M1*M3)*M1)/((SR**2*M1*M3+M*M2)**2
     1 *(2.D0*CR*U13+U3+U1))
      AP3Y1=(-(((2.D0*CR*U13+U3+U1)*SR*SNE-(
     1 CR*U13+U1)*CR*CSE)*(SR**2*M1*M3+M*
     1 M2)+2.D0*(2.D0*CR*U13+U3+U1)*SR*CR**2*SNE
     1 *M1*M3)*M1*M2)/((SR**2*M1*M3+M*M2)**2*(2.D0*CR
     1 *U13+U3+U1))
      AP3Z1=(-(((2.D0*CR*U13+U3+U1)*SR*CSE+(
     1 CR*U13+U1)*CR*SNE)*(SR**2*M1*M3+M*
     1 M2)+2.D0*(2.D0*CR*U13+U3+U1)*SR*CR**2*CSE
     1 *M1*M3)*M1*M2)/((SR**2*M1*M3+M*M2)**2*(2.D0*CR
     1 *U13+U3+U1))
      AP1Y3=(-(((2.D0*CR*U13+U3+U1)*SR*SRE-(
     1 CR*U13+U3)*CR*CRE)*(SR**2*M1*M3+M*
     1 M2)+2.D0*(2.D0*CR*U13+U3+U1)*SR*CR**2*SRE
     1 *M1*M3)*M3*M2)/((SR**2*M1*M3+M*M2)**2*(2.D0*CR
     1 *U13+U3+U1))
      AP1Z3=((((2.D0*CR*U13+U3+U1)*SR*CRE+(
     1 CR*U13+U3)*CR*SRE)*(SR**2*M1*M3+M*
     1 M2)+2.D0*(2.D0*CR*U13+U3+U1)*SR*CR**2*CRE
     1 *M1*M3)*M3*M2)/((SR**2*M1*M3+M*M2)**2*(2.D0*CR
     1 *U13+U3+U1))
      AP2Y3=((((2.D0*CR*U13+U3+U1)*SR*SRE*M1
     1 -(CR*U13+U3)*CR*CRE*M1-(CR*U13+U1)
     1 *(M1+M2)*CSE)*(SR**2*M1*M3+M*M2)+2.D0*((M1+M2)*
     1 SNE+CR*SRE*M1)*(2.D0*CR*U13+U3+U1)*
     1 SR*CR*M1*M3)*M3)/((SR**2*M1*M3+M*M2)**2
     1 *(2.D0*CR*U13+U3+U1))
      AP2Z3=(-(((2.D0*CR*U13+U3+U1)*SR*CRE*
     1 M1+(CR*U13+U3)*CR*SRE*M1-(CR*U13+
     1 U1)*(M1+M2)*SNE)*(SR**2*M1*M3+M*M2)-2.D0*((M1+M2
     1 )*CSE-CR*CRE*M1)*(2.D0*CR*U13+U3+U1)*
     1 SR*CR*M1*M3)*M3)/((SR**2*M1*M3+M*M2)**2
     1 *(2.D0*CR*U13+U3+U1))
      AP3Y3=(((SR**2*M1*M3+M*M2)*(CR*U13+U1)*
     1 CSE-2.D0*(2.D0*CR*U13+U3+U1)*SR*CR*SNE
     1 *M1*M3)*(M1+M2)*M2)/((SR**2*M1*M3+M*M2)**2*(2.D0
     1 *CR*U13+U3+U1))
      AP3Z3=(-((SR**2*M1*M3+M*M2)*(CR*U13+U1)*
     1 SNE+2.D0*(2.D0*CR*U13+U3+U1)*SR*CR*CSE
     1 *M1*M3)*(M1+M2)*M2)/((SR**2*M1*M3+M*M2)**2*(2.D0
     1 *CR*U13+U3+U1))
      YE1=((M3+M2)*SRE*RE12-SNE*RE32*M3)/M
      YE2=(-(SRE*RE12*M1+SNE*RE32*M3))/M
      YE3=((M1+M2)*SNE*RE32-SRE*RE12*M1)/M
      ZE1=(-((M3+M2)*CRE*RE12+CSE*RE32*M3))/M
      ZE2=(CRE*RE12*M1-CSE*RE32*M3)/M
      ZE3=((M1+M2)*CSE*RE32+CRE*RE12*M1)/M
      YEP1=((CR*U13+U3)*(M3+M2)*CRE*RE12-(CR
     1 *U13+U1)*CSE*RE32*M3)/((2.D0*CR*U13+U3+U1)*M
     1 )
      YEP2=(-((CR*U13+U3)*CRE*RE12*M1+(CR*
     1 U13+U1)*CSE*RE32*M3))/((2.D0*CR*U13+U3+U1)*M)
      YEP3=(-((CR*U13+U3)*CRE*RE12*M1-(CR*
     1 U13+U1)*(M1+M2)*CSE*RE32))/((2.D0*CR*U13+U3+U1)*
     1 M)
      ZEP1=((CR*U13+U3)*(M3+M2)*SRE*RE12+(CR
     1 *U13+U1)*SNE*RE32*M3)/((2.D0*CR*U13+U3+U1)*M
     1 )
      ZEP2=(-((CR*U13+U3)*SRE*RE12*M1-(CR*
     1 U13+U1)*SNE*RE32*M3))/((2.D0*CR*U13+U3+U1)*M)
      ZEP3=(-((CR*U13+U3)*SRE*RE12*M1+(CR*
     1 U13+U1)*(M1+M2)*SNE*RE32))/((2.D0*CR*U13+U3+U1)*
     1 M)
      YEPP1=(2.D0*((CR*U13+U3)*(M3+M2)*CRE*RE12-(
     1 CR*U13+U1)*CSE*RE32*M3)*SR*U13-(2.D0*CR
     1 *U13+U3+U1)*(M3+M2)*SR*CRE*RE12*U13+(2.D0*
     1 CR*U13+U3+U1)*SR*CSE*RE32*M3*U13-(CR
     1 *U13+U3)**2*(M3+M2)*SRE*RE12+(CR*U13+U1)**
     1 2*SNE*RE32*M3)/((2.D0*CR*U13+U3+U1)**2*M)
      YEPP2=(-(2.D0*((CR*U13+U3)*CRE*RE12*M1+(CR
     1 *U13+U1)*CSE*RE32*M3)*SR*U13-(2.D0*CR*
     1 U13+U3+U1)*SR*CRE*RE12*M1*U13-(2.D0*CR*U13
     1 +U3+U1)*SR*CSE*RE32*M3*U13-(CR*U13+U3)**
     1 2*SRE*RE12*M1-(CR*U13+U1)**2*SNE*RE32*M3)
     1 )/((2.D0*CR*U13+U3+U1)**2*M)
      YEPP3=(-(2.D0*((CR*U13+U3)*CRE*RE12*M1-(CR
     1 *U13+U1)*(M1+M2)*CSE*RE32)*SR*U13+(2.D0*CR
     1 *U13+U3+U1)*(M1+M2)*SR*CSE*RE32*U13-(2.D0*
     1 CR*U13+U3+U1)*SR*CRE*RE12*M1*U13-(CR
     1 *U13+U3)**2*SRE*RE12*M1+(CR*U13+U1)**2*(M1
     1 +M2)*SNE*RE32))/((2.D0*CR*U13+U3+U1)**2*M)
      ZEPP1=(2.D0*((CR*U13+U3)*(M3+M2)*SRE*RE12+(
     1 CR*U13+U1)*SNE*RE32*M3)*SR*U13-(2.D0*CR
     1 *U13+U3+U1)*(M3+M2)*SR*SRE*RE12*U13-(2.D0*
     1 CR*U13+U3+U1)*SR*SNE*RE32*M3*U13+(CR
     1 *U13+U3)**2*(M3+M2)*CRE*RE12+(CR*U13+U1)**
     1 2*CSE*RE32*M3)/((2.D0*CR*U13+U3+U1)**2*M)
      ZEPP2=(-(2.D0*((CR*U13+U3)*SRE*RE12*M1-(CR
     1 *U13+U1)*SNE*RE32*M3)*SR*U13-(2.D0*CR*
     1 U13+U3+U1)*SR*SRE*RE12*M1*U13+(2.D0*CR*U13
     1 +U3+U1)*SR*SNE*RE32*M3*U13+(CR*U13+U3)**
     1 2*CRE*RE12*M1-(CR*U13+U1)**2*CSE*RE32*M3)
     1 )/((2.D0*CR*U13+U3+U1)**2*M)
      ZEPP3=(-(2.D0*((CR*U13+U3)*SRE*RE12*M1+(CR
     1 *U13+U1)*(M1+M2)*SNE*RE32)*SR*U13-(2.D0*CR
     1 *U13+U3+U1)*(M1+M2)*SR*SNE*RE32*U13-(2.D0*
     1 CR*U13+U3+U1)*SR*SRE*RE12*M1*U13+(CR
     1 *U13+U3)**2*CRE*RE12*M1+(CR*U13+U1)**2*(M1
     1 +M2)*CSE*RE32))/((2.D0*CR*U13+U3+U1)**2*M)
      RETURN
      END
C
C
C
C
      SUBROUTINE TRNSSR ( XS , XR )
      IMPLICIT REAL*8 (A-H,O-Z)
C            :
C DATE       : 28.04.1986
C AUTHOR     : PER JENSEN
C UPDATES    :
C LANGUAGE   : FORTRAN
C PURPOSE    : TRANSFORMATION FROM A SECOND ORDER POLYNOMIAL IN THE
C            : S I'S TO A FOURTH ORDER POLYNOMIAL IN THE DELTA R I'S.D0
C            : THE CODE IS GENERATED BY REDUCE.
C            :
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 XS(6),XR(15)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      XR(1) = XS(1)
      XR(2)=B31*XS(3)+B11*XS(2)
      XR(3)=B33*XS(3)+B13*XS(2)
      XR(4)=
     1 B311*XS(3)+B31**2*XS(5)+B31*B11*XS(6)+B111*XS(2)+B11**2*XS(4)
      XR(5)=
     1 B333*XS(3)+B33**2*XS(5)+B33*B13*XS(6)+B133*XS(2)+B13**2*XS(4)
      XR(6)=
     1 B313*XS(3)+2.D0*B33*B31*XS(5)+B33*B11*XS(6)+B31*B13*XS(6)+
     2 B113*XS(2)+2.D0*B13*B11*XS(4)
      XR(7)=
     1 B3111*XS(3)+2.D0*B311*B31*XS(5)+B311*B11*XS(6)+B31*B111*
     2 XS(6)+B1111*XS(2)+2.D0*B111*B11*XS(4)
      XR(8)=
     1 B3333*XS(3)+2.D0*B333*B33*XS(5)+B333*B13*XS(6)+B33*B133*
     2 XS(6)+B1333*XS(2)+2.D0*B133*B13*XS(4)
      XR(9)=
     1 B3113*XS(3)+2.D0*B313*B31*XS(5)+B313*B11*XS(6)+2.D0*B311*B33*
     2 XS(5)+B311*B13*XS(6)+B33*B111*XS(6)+B31*B113*XS(6)+B1113*XS(2)+
     3 2.D0*B113*B11*XS(4)+2.D0*B111*B13*XS(4)
      XR(10)=
     1 B3133*XS(3)+2.D0*B313*B33*XS(5)+B313*B13*XS(6)+2.D0*B333*B31*
     2 XS(5)+B333*B11*XS(6)+B33*B113*XS(6)+B31*B133*XS(6)+B1133*XS(2)+
     3 2.D0*B113*B13*XS(4)+2.D0*B133*B11*XS(4)
      XR(11)=
     1 B31111*XS(3)+2.D0*B3111*B31*XS(5)+B3111*B11*XS(6)+B311**2*
     2 XS(5)+B311*B111*XS(6)+B31*B1111*XS(6)+B11111*XS(2)+2.D0*B1111*
     3 B11*XS(4)+B111**2*XS(4)
      XR(12)=
     1 2.D0*B3333*B33*XS(5)+B3333*B13*XS(6)+B333**2*XS(5)+B333*
     2 B133*XS(6)+B33*B1333*XS(6)+B13333*XS(2)+2.D0*B1333*B13*XS(4)+
     3 B133**2*XS(4)+XS(3)*B33333
      XR(13)=
     1 2.D0*B3113*B31*XS(5)+B3113*B11*XS(6)+2.D0*B3111*B33*XS(5)+
     2 B3111*B13*XS(6)+2.D0*B313*B311*XS(5)+B313*B111*XS(6)+B311*B113
     3 *XS(6)+B33*B1111*XS(6)+B31*B1113*XS(6)+B11113*XS(2)+2.D0*B1113*
     4 B11*XS(4)+2.D0*B1111*B13*XS(4)+2.D0*B113*B111*XS(4)+XS(3)*B31113
      XR(14)=
     1 2.D0*B3133*B33*XS(5)+B3133*B13*XS(6)+2.D0*B3333*B31*XS(5)+
     2 B3333*B11*XS(6)+2.D0*B313*B333*XS(5)+B313*B133*XS(6)+B333*B113
     3 *XS(6)+B33*B1133*XS(6)+B31*B1333*XS(6)+B11333*XS(2)+2.D0*B1133*
     4 B13*XS(4)+2.D0*B1333*B11*XS(4)+2.D0*B113*B133*XS(4)+XS(3)*B31333
      XR(15)=
     1 2.D0*B3133*B31*XS(5)+B3133*B11*XS(6)+2.D0*B3113*B33*XS(5)+
     2 B3113*B13*XS(6)+B313**2*XS(5)+B313*B113*XS(6)+2.D0*B333*B311*
     3 XS(5)+B333*B111*XS(6)+B311*B133*XS(6)+B33*B1113*XS(6)+B31*
     4 B1133*XS(6)+B11133*XS(2)+2.D0*B1133*B11*XS(4)+2.D0*B1113
     5 *B13*XS(4)+B113**2*XS(4)+2.D0*B133*B111*XS(4)
     6 +XS(3)*B31133
      RETURN
      END
C   ***** PART 3 OF 4 *****
      SUBROUTINE NUMFCT ( F1 , F2 , V0 , IRR , GRHO )
      IMPLICIT REAL*8 (A-H,O-Z)
C             :
C DATE        : 26.05.1986
C AUTHOR      : PER JENSEN (WITH HELP FROM R. BEARDSWORTH)
C UPDATES     :
C LANGUAGE    : FORTRAN
C             :
C
C     SUBROUTINE CALCULATES THE VALUES OF GRHO(RHO) ,F1(RHO) , F2(RHO) ,
C     AND 2 I0PP(RHO) / HBAR**2
C
C                        (-               (-             -) -)
C               (  0)1/4 (      (  0)-1/2 (      (  0)1/4 )  )
C     GRHO(P) = (MU )    ( J  , (MU )     ( J  , (MU )    )  )
C                        (  P             (  P            )  )
C                        (-               (-             -) -)
C
C             (  0)1/4 ( 0 )1/2    2  ( (  0)-1/4 ( 0 )-1/2 )
C     F (P) = (MU )    (I  )      D   ( (MU )     (I  )     )
C      1                 PP       --  (             PP      )
C                                    2
C                                 DP
C
C
C              0    0
C     F (P) = I   MU
C      2       PP   ZZ
C
C
C             0        _2      16
C     I0 = 2 I   H C / H  N  10
C             PP           A
C
C
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 I0,I0P,I0PP,IRRVAL,IRRP,IRRPP
      REAL*8 CE,SE,C2R,S2R,CRME,SRME,ECOEF1,ECOEF2,
     1      F1VAL,F2VAL,GVAL,V0VAL,F2COEF,CRHOE ,
     2      HELP1 , HELP3
      REAL*8 F1(NSTINT),F2(NSTINT),V0(NSTINT),IRR(NSTINT),
     1      GRHO(NSTINT)
      INTEGER I
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      IF (IPRINT .NE. 0) WRITE (NFIL6,9000)
      IF (PRTINT .LT. NSTINT .AND. IPRINT .NE. 0)
     1                        WRITE (NFIL6,9001)
      ECOEF1=(U1-U3)/DSQRT((U1+U3)**2-4.0D0*U13**2)
      ECOEF2=DSQRT((U1+U3-2.0D0*U13)/(U1+U3+2.0D0*U13))
      F2COEF=1.0D0/(U1*U3-U13**2)
      CRHOE=DCOS(RHOREF)
      DO 1000 I=1,NSTINT
      RHO=DFLOAT(I)*HSTEP
      EPS=0.5D0*RHO+ECOEF1*DATAN(ECOEF2*DTAN(0.5D0*RHO))
      CR=DCOS(RHO)
      SR=DSIN(RHO)
      CE=DCOS(EPS)
      SE=DSIN(EPS)
      C2R=CR*CR-SR*SR
      S2R=2.0D0*CR*SR
      CRME=CR*CE+SR*SE
C
C       CALCULATE DERIVATIVES OF EPSILON, I SUB RHO RHO AND THE
C       DETERMINANT OF THE I SUB 0 TENSOR, I0. EXPRESSIONS FOR
C       EPSILON PRIME AND I SUB RHO RHO ARE TAKEN FROM THE JENSEN
C       COMP. PHYS. REP. PAPER, THE EXPRESSION FOR I0 IS TAKEN
C       FROM HISTORICAL NRB NOTES BY P.R. BUNKER.
C
      I0=(U1*U3-U13*U13*CR*CR)*SR*SR
      I0P=(U1*U3-U13*U13*C2R)*S2R
      I0PP=2.0D0*U13*U13*S2R*S2R+2.0D0*(U1*U3-U13*U13*C2R)*C2R
      IRRVAL=(U1*U3-U13*U13*CR*CR)/(U1+U3+2.0D+00*U13*CR)
      HELP1=U1+U13*CR
      HELP3=U3+U13*CR
      IRRP=2.0D+00*U13*SR*HELP1*HELP3/(HELP1+HELP3)**2
      IRRPP=2.0D0*U13*(HELP1*HELP3*CR*(HELP1+HELP3)
     1    -U13*SR*SR*(HELP1-HELP3)**2)/(HELP1+HELP3)**3
C
C       CALCULATE F1
C
      F1VAL= - IRRP*I0P/(4.0D0*I0*IRRVAL) - 3.0D0*I0P*I0P/(1.6D1*I0*I0)
     1      + I0PP/(4.0D+00*I0) +3.0D0*IRRP*IRRP/(4.0D0*IRRVAL*IRRVAL)
     2      - IRRPP/(2.0D0*IRRVAL)
C
C       CALCULATE F2
C
      F2VAL= (U1*CRME*CRME+U3*CE*CE+2.0D0*U13*CE*CRME)*IRRVAL
     1      *F2COEF/(SR*SR)
C
C       CALCULATE THE V0 VALUE
C
      CORO=CRHOE-CR
      V0VAL =  (((((((FA8*CORO+FA7)*CORO+FA6)*CORO+FA5)*CORO
     1        +FA4)*CORO+FA3)*CORO+FA2)*CORO+FA1)*CORO-VMIN
C
C       CALCULATE THE G FUNCTION
C
      GVAL =  I0PP/(4.0D0*I0) - 3.0D0*I0P*I0P/(1.6D1*I0*I0)
C
      F1(I)=F1VAL
      F2(I)=F2VAL
      V0(I)=V0VAL
      IRR(I)=IRRVAL/M
      GRHO(I)=GVAL
1000  CONTINUE
      IF (IPRINT .EQ. 0) RETURN
      RHO=0.0D+00
      DO 2000 I=1,NSTINT
      RHO=RHO+HSTEP
      IF (MOD(I,PRTINT) .EQ. 0)
     1  WRITE (NFIL6,9002) I , RHO , F1(I) , F2(I), IRR(I) , V0(I)
2000  CONTINUE
      RETURN
9000  FORMAT(1H0,' MORBID.POT.INF   CALCULATION OF F1 , F2 , I0PP ',
     1           'AND V0 FOR WAVE FUNCTION DIFFERENTIAL EQUATION',//)
9001  FORMAT(1H ,15X,'STEP    RHO',6X,'F  (RHO)',8X,'F  (RHO)',10X,'I0',
     1           17X,'V',/,1H ,33X,'1',15X,'2',18X,'PP',16X,'0  ',/)
9002  FORMAT(1H ,15X,I4,2X,F7.4,3F16.8,F18.8)
C
      END

C
C
      SUBROUTINE WAVFUN ( EV2K , F1 , F2 , V0 , I0 , GRHO , RTI0 ,
     1                   PHIB , PHPR , XJACO , YRHS , XTX , XTY ,
     2                   CS , AS   , IA1   , IA2  ,
     3                   LENIAR )
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      REAL*8 EETAB(50)
C

      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
C
      INTEGER LENREC,LENIAR,I,L,IERR,NUMNOD,NTRIES,NP,II,NPST,
     1       IFAIL,IPHST,IDEST,IEND,NRECS,KREC,KP1,NM1,
     2       NOFCT,IREMAI,IOFFS
C
      REAL*8 CONVIV,FACODD,FACEVE,EOLD,PCOUT,PCIN,OLDPHI,NEWPHI,
     1      SUM,ALPHA,SUMM,SUMP,TRIALE,IRRVAL,IRRP,
     2      PHIDER,FCTVAL,HELP1,HELP3
C
      REAL*8 EV2K(V2MXP1,JMAXP1) , F1(NSTINT) , F2(NSTINT) ,
C
     1      I0(NSTINT) , GRHO(NSTINT) , RTI0(NSTINT) , V0(NSTINT) ,
C
     2      PHIB(NSTINT) , PHPR(NSTINT) , XJACO(NSERIN,NSEPP2) ,
C
     3      YRHS(NSERIN) , XTX(NSEPP2,NSEPP2) , XTY(NSEPP2) ,
C
     4      CS(NSEPP2) , AS(NSEQP1) ,
C
     4      DER(4) , EREST(4)
C
      INTEGER IA1(LENIAR),IA2(LENIAR)
C
C BEFORE COMMENCING THE NUMEROV-COOLEY NUMERICAL INTEGRATION WE
C STORE THE FOLLOWING FUNCTION IN THE F1 ARRAY:
C
C                       0                 _2
C     W  = F  (P ) + 2 I   (P ) V  (P ) / H
C      I    1   I       PP   I   0   I
C
C                  -1                           2
C V  IS GIVEN IN CM  , AND I   IS GIVEN IN AMU A .
C  0                        PP
C
C THE CONVERSION FACTOR CONVIV CONVERTS UNITS SO THAT WI IS A
C DIMENSIONLESS NUMBER.
C
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      NOFCT=NRECS
      IEND=2*NSTINT
      CONVIV=(8.0D+00*PI*PI*VELLGT)/(PLANCK*AVOGNO*1.0D+16)
      DO 100 I=1,NSTINT
100   RTI0(I)=DSQRT(I0(I))
      DO 200 I=1,NSTINT
      F1(I)=F1(I)+CONVIV*I0(I)*V0(I)
200   I0(I)=CONVIV*I0(I)
C
C START LOOP OVER K TO CALCULATE WAVEFUNCTIONS
C
      DO 1002 KP1=1,JMAXP1
C
C WE NOW START THE LOOP OVER V2 TO GENERATE THE K=0 BENDING
C WAVEFUNCTIONS
C
      KQUA=KP1-1
      FACODD=2.0D+00*HSTEP/3.0D+00
      FACEVE=2.0D+00*FACODD
      DO 1000 V2P1=1,V2MXP1
      DO 212 III=1,50
         EETAB(III)=-1.0
212   CONTINUE
C
      V2=V2P1-1
      EEL=0.0
      EEU=100000.0
      IF (EETAB(V2P1).GT.0) THEN
         EEL=EETAB(V2P1)-5.0
         EEU=EETAB(V2P1)+5.0
         IF (EEL.LT.0) EEL=0.0
      ENDIF
      EDEL=1000.0
      NTRIES=0
210   EEM=(EEL+EEU)/2.0
211   EGUESS=EEM
      EOLD=EGUESS
      CALL NUMCOO ( F1 , F2 , V0 , I0 , GRHO , PHIB ,
     1             PHPR , XJACO , YRHS , XTX , XTY , CS ,
     2             AS , IA1 , IA2 ,
     3             LENIAR , PCOUT, IERR)
      IF (IERR .NE. 0) THEN
           IF (IERR .EQ. 1) THEN
                 EEM=EEM+100.0
                 EEU=EEU+200.0
                 GOTO 211
           ELSE
                 STOP
           ENDIF
      ENDIF
C
C COUNT THE NUMBER OF NODES IN THE WAVEFUNCTION FOUND
C
      NUMNOD=0
      NM2=NSTINT-2
      OLDPHI=PHIB(1)
      NEWPHI=PHIB(3)
      DO 230 I=2,NM2
      IF ((OLDPHI*PHIB(I) .LT. 0.0D+00) .OR. (PHIB(I) .EQ. 0.0D+00
     1 .AND. NEWPHI*OLDPHI .LT. 0.0D+00)) NUMNOD=NUMNOD+1
      NEWPHI=PHIB(I+2)
230   OLDPHI=PHIB(I)
      IF ((IERR.EQ.0).AND.(NUMNOD+1.LT.51)) EETAB(NUMNOD+1)=EGUESS
      IF (NUMNOD .EQ. V2) GOTO 240
C     IF (IPRINT .NE. 0) WRITE (NFIL6,5000) KQUA,V2,NUMNOD,EGUESS,EOLD
      IF (ABS(EEU-EEL).LT.0.01) THEN
         NTRIES=0
         IF (V2P1.EQ.1) THEN
            EEL=0.0
         ELSE
            EEL=EV2K(V2P1-1,KQUA+1)
         ENDIF
         EEU=EEL+EDEL
         EDEL=EDEL+500.0
      ELSE
        IF (NUMNOD.LT.V2) THEN
           EEL=EEM
        ELSE
           EEU=EEM
        ENDIF
      ENDIF
238   EOLD=EGUESS
      NTRIES=NTRIES+1
      IF (NTRIES .GE. NSTNIN) GOTO 9000
      GOTO 210
240   EV2K(V2P1,KQUA+1)=EGUESS
C
C MULTIPLY THE WAVEFUNCTION WITH DSQRT(IRR) (EQ. (6.4) OF JENSEN)
C
      DO 300 I=1,NSTINT
300   PHIB(I)=RTI0(I)*PHIB(I)
C
C NORMALIZE THE WAVEFUNCTION
C
      SUM=0.0D0
      DO 400 I=1,NSTINT,2
400   SUM=SUM+FACODD*PHIB(I)*PHIB(I)+FACEVE*PHIB(I+1)*PHIB(I+1)
      SUM=DSQRT(SUM)
      DO 500 I=1,NSTINT
500   PHIB(I)=PHIB(I)/SUM
C
C WE DIFFERENTIATE THE FIRST NSERIN POINTS OF THE WAVEFUNCTION
C ANALYTICALLY
C
      RHO=0.0D+00
      ALPHA=DFLOAT(KQUA)+0.5D+00
      DO 700 NP=1,NSERIN
      RHO=RHO+HSTEP
      CR=DCOS(RHO)
      SR=DSIN(RHO)
      IRRVAL=(U1*U3-U13*U13*CR*CR)/(U1+U3+2.0D+00*U13*CR)
      HELP1=U1+U13*CR
      HELP3=U3+U13*CR
      IRRP=2.0D+00*U13*SR*HELP1*HELP3/(HELP1+HELP3)**2
      SUMM=AS(1)
      SUMP=0.0D+00
      DO 600 II=2,NSEQP1
      I=II-1
      SUMM=SUMM+AS(II)*RHO**(I+I)
600   SUMP=SUMP+DFLOAT(I+I)*AS(II)*RHO**(I+I-1)
      PHIDER=(SUMM*ALPHA/RHO+SUMP)*RHO**ALPHA
      FCTVAL=SUMM*RHO**ALPHA
700   PHPR(NP)=RTI0(NP)*(PHIDER+0.5D+00*FCTVAL*IRRP/IRRVAL)
     1                                  /(SUM*PCOUT)
C
C THE REST OF THE WAY WE USE THE NAGLIB ROUTINE D04AAF
C
      NPST=NSERIN+1
      HBASE=1.0D+00
      DO 800 NP=NPST,NSTINT
      CALL D04AAF( NP , 1 , DER , EREST , PHIB , IFAIL )
      IF (IFAIL .NE. 0 .OR. DABS(DER(1)) .GT. THRSH4) GOTO 9010
      PHPR(NP)=DER(1)/HSTEP
800   CONTINUE
C
      KREC=KQUA*V2MXP1+V2P1
C
      WRITE (NFIL7,REC=KREC) (PHIB(I),I=1,NSTINT),
     1                       (PHPR(I),I=1,NSTINT)
1000  CONTINUE
1002  CONTINUE
C
      IF (IPRINT.EQ.0) RETURN
      DO 1201 IKKK=1,JMAXP1
      IKKKM1=IKKK-1
      WRITE (NFIL6,5010) IKKKM1
C
      DO 1200 V2P1=1,V2MXP1
      V2=V2P1-1
      WRITE (NFIL6,5020) V2,EV2K(V2P1,IKKK)
1200  CONTINUE
1201  WRITE (NFIL6,5030)
C
      RETURN
C
9000  WRITE (NFIL6,9001) NSTNIN
9001  FORMAT(1H0,' MORBID.NMI.ERR  MAXIMUM NUMBER OF ATTEMPTS (',
     1      I3,') ATTAINED IN THE NUMEROV-COOLEY INTEGRATION')
      STOP
9010  CONTINUE
      IF (IFAIL .EQ. 0) GOTO 9020
      WRITE (NFIL6,9011) IFAIL
9011  FORMAT(1H0,' MORBID.NMI.ERR   DIFFERENTIAL OF WAVE FUNCTIONS',
     1          ' YIELDS IFAIL =',I2/
     2      1H ,'                  (SUBROUTINE WAVFUN)'/)
      STOP
9020  WRITE (NFIL6,9021) DER(1),THRSH4,NP
9021  FORMAT(1H0,' MORBID.NMI.ERR   ABSOLUTE ERROR ESTIMATE FOR THE ',
     1                          'FIRST DERIVATIVE OF THE WAVEFUNCTION'/
     2      1H ,'                  (',D11.3,') IS GREATER THAN THE ',
     3                             'LIMIT (',D11.3,')'/
     4      1H ,'                  IN STEP ',I4,' (SUBROUTINE WAVFUN)'/)
      STOP
C
5000  FORMAT(1H0,' MORBID.NMI.WRN  FOR KQUA = ',I2,', V2 = ',I3,
     1      ' DOES NOT EQUAL NUMBER OF NODES = ',I3/
     2      1H ,' EGUESS = ',F10.3,', ETRIAL = ',F10.3)
5010  FORMAT('1',5X,12('*'),' ENERGIES FROM THE K=',I3,' NUMEROV',
     1      '-COOLEY INTEGRATION (CM-1) ',12('*')//
     2      ' ',17X,30('-')/' ',17X,'I',9X,'I',18X,'I'/
     3      ' ',17X,'I',4X,'V2',3X,'I',8X,'E ',8X,'I'/
     4     ' ',17X,'I',9X,'I',18X,'I'/' ',17X,30('-'))
5020  FORMAT(' ',17X,'I',3X,I3,3X,'I',3X,F12.5,3X,'I')
5030  FORMAT(' ',17X,30('-')//)
C
      END
C
C
      SUBROUTINE NUMCOO ( F1 , F2 , V0 , I0 , GRHO , PHIB ,
     1                   PHPR , XJACO , YRHS , XTX , XTY , CS ,
     2                   AS , IA1 , IA2 ,
     3                   LENIAR , PCOUT, IERR)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER LENIAR,KK,I,IC,IERR,NITER,NP1,NM1
      REAL*8 U,Y,HH,SUM,SUMOUT,SUMIN,PCOUT,PCIN,DE,YC,YCM1,YCP1
C
      REAL*8 F1(NSTINT) , F2(NSTINT) , V0(NSTINT) ,
C
     1      I0(NSTINT) , GRHO(NSTINT) , PHIB(NSTINT) , PHPR(NSTINT) ,
C
     2      XJACO(NSERIN,NSEPP2) , YRHS(NSERIN) , XTX(NSEPP2,NSEPP2) ,
C
     3      XTY(NSEPP2) , CS(NSEPP2) , AS(NSEQP1)
C
      INTEGER IA1(LENIAR),IA2(LENIAR)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
C     SUBROUTINE SOLVES EQN 6.5 , FOR THE GIVEN VALUE OF KQUA ,
C     BY THE NUMEROV - COOLEY TECHNIQUE.
C
C                  (                       0                  )
C      2           (                    2 I                   )
C     D            (                2      PP                 )
C     ---PHI (P) = ( F (P) + F (P) K  + ----- ( V   (P) - E ) ) PHI (P)
C       2   B      (  1       2         _2       EFF          )    B
C     DP           (                    H                     )
C
C     FOR THIS THE FOLLOWING DEFINTIONS (EQUATIONS 6.14 TO 6.17) ARE
C     NEEDED :-
C
C     PH  = PHI  (P )
C       I      B   I
C
C             0         _2
C     I  = 2 I   (P ) / H
C      I      PP   I
C
C                             2      0                   _2
C     U  = F  (P ) + F  (P ) K  + 2 I   (P ) V    (P ) / H
C      I    1   I     2   I          PP   I   EFF   I
C
C                 2
C     Y  = ( 1 - H  ( U  - I  E ) ) PH
C      I         --    I    I         I
C                12
C
C     STARTING FROM AN INITIAL GUESS FOR THE ENERGY , GIVEN IN WAVFUN
C     AN ITERATIVE SCHEME IS FOLLOWED. THIS IS PERFORMED BY USING THE
C     RECURSION RELATION (EQN 6.18) :-
C
C                           2
C     Y    + Y    - 2 Y  = H  ( U  - I  E ) PH
C      I+1    I-1      I         I    I       I
C
C     H IS HERE THE HSTEP LENGTH USED TO GENERATE THE F1 , F2 , I0'S
C
C     TO CALCULATE VALUES OF Y(I) AND PHIB(I) BOTH FROM RHO = 0
C     AND FROM RHO = RHOMAX. THESE TWO PARTS ARE CALLED THE OUTWARD
C     AND INWARD INTEGRATIONS RESPECTIVELY.
C     THE OUTWARD INTEGRATION IS CARRIED OUT UNTIL A MAXIMUM IS REACHED
C     IN THE WAVEFUNCTION. THIS CROSSING POINT (IC , YC , PC) IS THEN
C     THE STOPPING POINT USED FOR THE INWARD INTEGRATION.
C     BOTH SETS OF WAVEFUNCTIONS ARE SCALED SO THAT PC(OUT) = PC(IN) = 1
C     AN ERROR FOR THE ENERGY CAN BE CALCULATED FROM EQN 6.24 :-
C
C                                                         NSTINT
C               OUT           IN       2                    \--      2
C     D(E) = (-Y    + 2 Y  - Y    ) / H + U  - I  E ) Y  /   \  I  PH
C               C-1      C    C+1          C    C      C     /   I   I
C                                                           /--
C                                                           I=1
C
C     AND THIS IS ADDED TO THE EGUESS AT EACH ITERATION , WHEN D(E)
C     IS LESS THAN THRSH5 THE ITERATION HAS CONVERGED.
C
      U(I)=F1(I)+F2(I)*KK
C
      Y(I)=(1.0D+00-HH*(U(I)-I0(I)*EGUESS)/12.0D+00)*PHIB(I)
C
      HH=HSTEP*HSTEP
      KK=KQUA*KQUA
C
      PHIB(NSTINT)=0.0D+00
      PHIB(NSTINT-1)=PNM1
C
      NITER=0
C
100   CALL INTOUT ( F1 , F2 , V0 , I0 , GRHO , PHIB ,
     1             PHPR , XJACO , YRHS , XTX , XTY , CS ,
     2             AS , IA1 , IA2 ,
     3             LENIAR , SUMOUT , IC ,
     4             PCOUT, IERR)
      IF (IERR.NE.0) RETURN
C
      CALL INTIN ( F1 , F2 , V0 , I0 , GRHO , PHIB ,
     3            SUMIN , IC , PCIN)
C
      SUM=SUMIN/(PCIN*PCIN)+SUMOUT/(PCOUT*PCOUT)
C
      YC=Y(IC)/PCOUT
C
      YCM1=Y(IC-1)/PCOUT
C
      YCP1=Y(IC+1)/PCIN
C
      DE=((-YCM1+YC+YC-YCP1)/HH+(U(IC)-I0(IC)*EGUESS))*YC/SUM
C
      EGUESS=EGUESS+DE
C
      NITER=NITER+1
C
      IF (DABS(DE).LE.THRSH5) GO TO 150
C
      IF (NITER.EQ.NSTNIN) GO TO 900
C
      GO TO 100
C
C
150   DO 200 I=1,IC
C
      PHIB(I)=PHIB(I)/PCOUT
C
200   CONTINUE
C
      NP1=IC+1
      NM1=NSTINT-1
C
      DO 300 I=NP1,NM1
C
      PHIB(I)=PHIB(I)/PCIN
C
300   CONTINUE
C
C
      RETURN
C
900   WRITE (NFIL6,1000) NSTNIN , DE , THRSH5
      IERR=2
      RETURN
C
1000  FORMAT(1H ,' MORBID.NMI.ERR   ITERATION LIMIT REACHED IN',
     1          ' NUMERICAL INTEGRATION (NITER=',I2,')',/,
     2                      16X,'ENERGY DIFFERENCE =',D13.4,/,
     3                      16X,'CONVERGENCE THRESHOLD =',D13.4,/)
C
      END
C
C
      SUBROUTINE INTOUT ( F1 , F2 , V0 , I0 , GRHO , PHIB ,
     1                   PHPR , XJACO , YRHS , XTX , XTY , CS ,
     2                   AS , IA1 , IA2 ,
     3                   LENIAR , SUMOUT , IC ,
     4                   PCOUT, IERR)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER LENIAR,KK,I,II,IC,NP1,NM1,IST,IEND,IERR
      REAL*8 U,HH,CONST,SUM,REDFAC,SUMOUT,PCOUT,YI,YIM1,YIP1
C
      REAL*8 F1(NSTINT) , F2(NSTINT) , V0(NSTINT) ,
C
     1      I0(NSTINT) , GRHO(NSTINT) , PHIB(NSTINT) , PHPR(NSTINT) ,
C
     2      XJACO(NSERIN,NSEPP2) , YRHS(NSERIN) , XTX(NSEPP2,NSEPP2) ,
C
     3      XTY(NSEPP2) , CS(NSEPP2) , AS(NSEQP1)
C
      INTEGER IA1(LENIAR),IA2(LENIAR)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
C     SUBROUTINE PERFORMS THE OUTWARD INTEGRATION OF NUMCOO ,
C     UNTIL THE FIRST MAXIMUM IN THE WAVE FUNCTION IS FOUND.
C     THE SUM I0(I)*PHIB(I)**2 IS SAVED FOR THE OUTWARD INTEGRATION
C     AND WILL LATER BR DIVIDED BY PC(OUT)**2.
C     THE FIRST NSERIN POINTS OF THE FUNCTION ARE CALCULATED BY
C     LSQCAP AS DESCRIBED THEREIN
C
      U(I)=F1(I)+F2(I)*KK
C
      KK=KQUA*KQUA
      HH=HSTEP*HSTEP
C
      CALL LSQCAP ( F1 , F2 , V0 , I0 , GRHO , PHIB ,
     1             PHPR , XJACO , YRHS , XTX , XTY , CS ,
     2             AS , IA1 , IA2 , LENIAR , IERR)
      IF (IERR.NE.0) RETURN
C
      SUM=0.0D+00
C
      NM1=NSERIN-1
C
      DO 100 I=1,NM1
C
      SUM=SUM+I0(I)*PHIB(I)*PHIB(I)
C
100   CONTINUE
C
      IST=NSERIN
      IEND=NSTINT-2
C
      YIM1=PHIB(NM1)*(1.0D+00-HH*(U(NM1)-I0(NM1)*EGUESS)/12.0D+00)
C
      YI=PHIB(NSERIN)*(1.0D+00-HH*(U(NSERIN)-I0(NSERIN)*EGUESS)
     1                        /12.0D+00)
C
C
      DO 200 I=IST,IEND
C
      CONST=HH*(U(I)-I0(I)*EGUESS)
C
      PHIB(I)=YI/(1.0D+00-CONST/12.0D+00)
C
      YIP1=CONST*PHIB(I)+YI+YI-YIM1
C
      IF (PHIB(I).LT.PHIB(I-1)) GO TO 300
C
      YIM1=YI
      YI=YIP1
C
      SUM=SUM+I0(I)*PHIB(I)*PHIB(I)
C
      IF (SUM .LT. THRSH3) GOTO 200
C
      REDFAC=DSQRT(THRSH3)
C
      DO 150 II=1,I
C
150   PHIB(II)=PHIB(II)/REDFAC
C
      DO 160 II=1,NSEQP1
C
160   AS(II)=AS(II)/REDFAC
C
      YI=YI/REDFAC
C
      YIM1=YIM1/REDFAC
C
      SUM=SUM/THRSH3
C
200   CONTINUE
C
      GO TO 900
C
300   SUMOUT=SUM
C
      IC=I-1
C
      PCOUT=PHIB(IC)
C
      RETURN
C
900   WRITE (NFIL6,1000)
      IERR=1
C
      RETURN
C
1000  FORMAT(1H ,' MORBID.NMI.ERR   NO TURNING POINT FOUND IN ',
     1          'OUTWARD INTEGRATION',/)
C
      END
C
C
C
      SUBROUTINE INTIN ( F1 , F2 , V0 , I0 , GRHO , PHIB ,
     3                  SUMIN , IC , PCIN)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER KK,I,IC,II,NP1,NM1,IST,IEND
      REAL*8 U,HH,CONST,SUM,SUMIN,PCIN,YI,YIM1,YIP1,CONS
C
      REAL*8 F1(NSTINT) , F2(NSTINT) , V0(NSTINT) ,
C
     1      I0(NSTINT) , GRHO(NSTINT) , PHIB(NSTINT)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
C     SUBROUTINE PERFORMS THE INWARD INTEGRATION FROM RHO=RHOMAX
C     STOPPING AT THE MAXIMUM IN THE WAVEFUNCTION DETERMINED IN
C     INTOUT. THE RECURSION RELATIONS GIVEN IN NUMCOO ARE USED
C     IN CONJUNCTION WITH THE TWO STARTING VALUES :-
C
C     PHI(RHOMAX) = 0
C
C     PHI(RHOMAX-H) = PNM1 ( O 10**-32 )
C
      U(I)=F1(I)+F2(I)*KK
C
      KK=KQUA*KQUA
      HH=HSTEP*HSTEP
C
      SUM=0.0D+00
C
      IST=IC+1
      IEND=NSTINT-1
C
      NM1=IEND
C
      YIP1=0.0D+00
C
      YI=PHIB(NM1)*(1.0D+00-HH*(U(NM1)-I0(NM1)*EGUESS)/12.0D+00)
C
      DO 200 II=IST,IEND
      I=IST+IEND-II
C
      CONST=HH*(U(I)-I0(I)*EGUESS)
C
      PHIB(I)=YI/(1.0D+00-CONST/12.0D+00)
C
      YIM1=CONST*PHIB(I)+YI+YI-YIP1
C
      YIP1=YI
      YI=YIM1
C
      SUM=SUM+I0(I)*PHIB(I)*PHIB(I)
C
200   CONTINUE
C
      SUMIN=SUM
C
      PCIN=YI/(1.0D+00-HH*(U(IC)-I0(IC)*EGUESS)/12.0D+00)
C
      RETURN
C
      END
C
C
      SUBROUTINE LSQCAP ( F1 , F2 , V0 , I0 , GRHO , PHIB ,
     1                   PHPR , XJACO , YRHS , XTX , XTY , CS ,
     2                   AS , IA1 , IA2 , LENIAR , IERR)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER LENIAR,KK,I,NP1,NM1,IST,IEND,IERR,II,JJ,
     1       NPEND,NI,IRET,N,J
      REAL*8 U,HH,SUM,SUMOUT,PCOUT,YI,YIM1,YIP1,DET,TEST,
     1      RHOA,SUMRHS,ALPHA,COEFF
C
      REAL*8 F1(NSTINT) , F2(NSTINT) , V0(NSTINT) ,
C
     1      I0(NSTINT) , GRHO(NSTINT) , PHIB(NSTINT) , PHPR(NSTINT) ,
C
     2      XJACO(NSERIN,NSEPP2) , YRHS(NSERIN) , XTX(NSEPP2,NSEPP2) ,
C
     3      XTY(NSEPP2) , CS(NSEPP2) , AS(NSEQP1)
C
      INTEGER IA1(LENIAR),IA2(LENIAR)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
C     SUBROUTINE FITS THE FIRST NSERIN VALUES OF
C
C     T  = U  - I  E
C      I    I    I  GUESS
C
C     TO THE SERIES EXPANSION IN EQN. 6.30 :-
C
C                     P
C                   \--
C            C       \       2I
C     T(P) =  -2  +  /  C   P
C            ---    /--  2I
C             2     I=0
C            P
C
C     THIS IS DONE WITH A LEAST SQUARES METHOD , WITH THE EQUATIONS
C     BEING SOLVED BY THE ROUTINE SOLVD.
C     FROM THE VALUES OF C2I , THE VALUE ALPHA GIVEN BY (EQN. 6.34) :-
C
C                                    1/2
C     ALPHA = 1/2 ( 1 + ( 1 + 4 C   )    )
C                                -2
C
C     AND THE A2I'S GIVEN BY (EQN. 6.35) :-
C                                               P
C                                             \--
C    ((ALPHA+N+1)*(ALPHA+N+1) - C   ) A    =   \   C   A
C    (                           -2 )  N+2     /    2I  N-2I
C                                             /--
C                                             I=0
C
C     ARE CALCULATED.
C
C     FROM THE A2I'S VALUES OF PHIB(RHO) MAY BE CALCULATED FROM
C     EQN 6.32 :-
C                        Q
C                ALPHA \--       2I
C     PHIB(P) = P       \   A   P
C                       /    2I
C                      /--
C                      I=0
C
C
C
      IERR=0
      RHO=0.0D+00
C
      DO 50 N=1,NSERIN
C
      RHO=RHO+HSTEP
C
      DO 40 I=1,NSEPP2
C
40    XJACO(N,I)=RHO**(I+I-4)
C
      YRHS(N)=F1(N)+F2(N)*KQUA*KQUA-I0(N)*EGUESS
C
50    CONTINUE
C
      DO 340 I=1,NSEPP2
      SUMRHS=0.0D+00
      DO 320 J=1,NSEPP2
      SUM=0.0D+00
      DO 310 N=1,NSERIN
310   SUM=SUM+XJACO(N,I)*XJACO(N,J)
320   XTX(I,J)=SUM
      DO 330 N=1,NSERIN
330   SUMRHS=SUMRHS+XJACO(N,I)*YRHS(N)
340   XTY(I)=SUMRHS
      CALL SOLVD (XTX,IA1,IA2,NSEPP2,NSEPP2,LENIAR,DET,TEST)
      IF (TEST .NE. 0.0D+00) GOTO 900
      DO 360 I=1,NSEPP2
      SUM=0.0D+00
      DO 350 J=1,NSEPP2
350   SUM=SUM+XTX(I,J)*XTY(J)
360   CS(I)=SUM
C
      IF (CS(1).LT.-0.25D+00) CS(1)=-0.25D+00
C
      ALPHA=0.5*(1.0D+00+DSQRT(1.0D+00+4.0D+00*CS(1)))
C
      AS(1)=1.0D+00
C
      IF (NSEQP1.LT.2) GO TO 120
C
      DO 100 JJ=2,NSEQP1
C
      N=JJ+JJ-4
C
      COEFF=(ALPHA+DFLOAT(N+1))*(ALPHA+DFLOAT(N+2))-CS(1)
C
      NPEND=MIN0(NSEPP2,JJ)
C
      SUM=0.0D+00
      DO 90 II=2,NPEND
      I=II-2
C
      NI=JJ-I-1
C
      SUM=SUM+CS(II)*AS(NI)
C
90    CONTINUE
C
      AS(JJ)=SUM/COEFF
C
100   CONTINUE
C
120   RHO=0.0D+00
C
      DO 200 N=1,NSERIN
C
      RHO=RHO+HSTEP
C
      RHOA=RHO**ALPHA
C
      SUM=0.0D+00
      DO 150 II=1,NSEQP1
      I=II-1
C
      SUM=SUM+AS(II)*RHO**(I+I)
C
150   CONTINUE
C
      PHIB(N)=RHOA*SUM
C
200   CONTINUE
C
      RETURN
C
900   IERR=5
      WRITE (NFIL6,5000) TEST
5000  FORMAT(1H0,' MORBID.SSO.ERR   SOLVD HAS FAILED IN SUBROUTINE',
     1          ' LSQCAP, TEST = ',D11.3)
      RETURN
C
      END
C
C
      SUBROUTINE SOLVD (X,I1,I2,MM,N,LENI,DET,TEST)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
C
      INTEGER LENI,MM,N,I,J,K,IROW,JCOL
      INTEGER I1(LENI), I2(LENI)
      REAL*8 X(MM,N),T,DET,BIG,TEST,PIV,TEMP
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      EQUIVALENCE (BIG,TEMP,PIV)
C
C     INITIALIZATION
C
      DET = 1.D0
      TEMP = DABS(PREC)
      IF (TEMP .EQ. 0.D0)  TEMP = 0.5D-14
      TEST = 0.D0
      DO 1 I = 1,MM
      I2(I) = 0
      DO 1 J = 1,MM
1     TEST = TEST + X(I,J) * X(I,J)
      TEST = TEMP * DSQRT(TEST) / MM
C
C     SEARCH FOR NEXT PIVOT, AVOIDING ROWS AND COLUMNS WHICH ALREADY
C     CONTAIN A PIVOT.
C
      DO 9 K = 1,MM
      BIG = 0.D0
      DO 3 I = 1,MM
      IF (I2(I) .NE. 0) GO TO 3
      DO 2 J = 1,MM
      IF (I2(J) .NE. 0) GO TO 2
      T =DABS(X(I,J))
      IF (T .LE. BIG) GO TO 2
      BIG = T
      IROW = I
      JCOL = J
2     CONTINUE
3     CONTINUE
      IF (BIG .LE. TEST) RETURN
C
C     RECORD POSITION OF PIVOT THEN MOVE PIVOTAL ROW SO PIVOT LIES ON
C     THE DIAGONAL. SCALE PIVOTAL ROW.
C
      I1(K) = JCOL
      I2(JCOL) = IROW
      IF (JCOL .EQ. IROW) GO TO 6
      DO 5 J = 1,N
      TEMP = X(IROW,J)
      X(IROW,J) = X(JCOL,J)
5     X(JCOL,J) = TEMP
      DET = -DET
6     DET = DET * X(JCOL,JCOL)
      PIV = 1.D0/X(JCOL,JCOL)
      DO 7 J = 1,N
      IF (J .NE. JCOL)  X(JCOL,J) = PIV * X(JCOL,J)
7     CONTINUE
      X(JCOL,JCOL) = PIV
C
C     ELIMINATE REMAINING ROWS.
C
      DO 9 I = 1,MM
      IF (I .EQ. JCOL)  GO TO 9
      PIV = -X(I,JCOL)
      DO 8 J = 1,N
      IF (J .NE. JCOL)  X(I,J) = X(I,J) + PIV * X(JCOL,J)
8     CONTINUE
      X(I,JCOL) = PIV * X(JCOL,JCOL)
9     CONTINUE
C
C     UNSCRAMBLE THE COLUMNS OF THE INVERSE ACCORDING TO THE ORIGINAL
C     POSITIONS OF THE PIVOTS.
C
      DO 11 K = 1,MM
      I = MM+1 - K
      JCOL = I1(I)
      IROW = I2(JCOL)
      IF (IROW .EQ. JCOL)  GO TO 11
      DO 10 I = 1,MM
      TEMP = X(I,IROW)
      X(I,IROW) = X(I,JCOL)
10    X(I,JCOL) = TEMP
11    CONTINUE
      TEST = 0.D0
      RETURN
      END
C
C
      SUBROUTINE D04AAF(IFUN, NDER, DER, EREST, FUN, IFAIL)
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
C
C     ***   PURPOSE   ***
C
C     A SUBROUTINE FOR NUMERICAL DIFFERENTIATION AT A POINT.  IT
C     RETURNS A SET OF APPROXIMATIONS TO THE J-TH ORDER DERIVATIVE
C     (J=1,2,...14) OF FUN(X) EVALUATED AT X = XVAL  AND, FOR EACH
C     DERIVATIVE, AN ERROR ESTIMATE ( WHICH INCLUDES THE EFFECT OF
C     AMPLIFICATION OF ROUND- OFF ERRORS).
C
C
C     ***   INPUT  PARAMETERS   ***
C
C     (1) XVAL   REAL.  THE ABSCISSA AT WHICH THE SET OF
C     DERIVATIVES IS REQUIRED.
C     (2) NDER   INTEGER. THE HIGHEST ORDER DERIVATIVE REQUIRED.
C     IF(NDER.GT.0)  ALL DERIVATIVES UP TO MIN(NDER,14) ARE
C     CALCULATED.
C     IF(NDER.LT.0 AND NDER EVEN)  EVEN ORDER DERIVATIVES
C     UP TO MIN(-NDER,14) ARE CALCULATED.
C     IF(NDER.LT.0 AND NDER ODD )  ODD  ORDER DERIVATIVES
C     UP TO MIN(-NDER,13) ARE CALCULATED.
C     (3) HBASE  REAL.  A STEP LENGTH.
C     (6) FUN    THE NAME OF A DOUBLE PRECISION FUNCTION SUBPROGRAMME,
C     WHICH IS REQUIRED BY THE ROUTINE AS A SUBPROGRAMME
C     AND WHICH REPRESENTS THE FUNCTION BEING DIFFERENTIATED
C     THE ROUTINE REQUIRES 21 FUNCTION EVALUATIONS FUN(X)
C     LOCATED AT    X = XVAL    AND AT
C     X = XVAL + (2*J-1)*HBASE,  J=-9,-8, .... +9,+10.
C     THE FUNCTION VALUE AT  X = XVAL IS DISREGARDED WHEN
C     ONLY ODD ORDER DERIVATIVES ARE REQUIRED.
C
C     ***   OUTPUT PARAMETERS   ***
C
C     (4) DER(J)   J=1,2,...14.  REAL. A VECTOR OF
C     APPROXIMATIONS TO THE J-TH DERIVATIVE OF FUN(X)
C     EVALUATED AT X = XVAL.
C     (5) EREST(J) J=1,2,...14.  REAL. A VECTOR OF
C     ESTIMATES OF THE DABSOLUTE ACCURACY OF DER(J).  THESE
C     ARE NEGATIVE WHEN EREST(J).GT.ABS(DER(J)), OR WHEN,
C     FOR SOME OTHER REASON THE ROUTINE IS DOUBTFUL ABOUT
C     THE VALIDITY OF THE RESULT.
C
C     ***   IMPORTANT WARNING   ***
C
C     EREST IS AN ESTIMATE OF THE OVERALL ERROR.  IT IS ESSENTIAL
C     FOR
C     PROPER USE THAT THE USER CHECKS EACH VALUE OF DER
C     SUBSEQUENTLY
C     USED TO SEE THAT IT IS ACCURATE ENOUGH FOR HIS PURPOSES.
C     FAILURE TO DO THIS MAY RESULT IN THE CONTAMINATION OF ALL
C     SUBSEQUENT RESULTS.
C     IT IS TO BE EXPECTED THAT IN NEARLY ALL CASES  DER(14) WILL
C     BE
C     UNUSABLE.( 14 REPRESENTS A LIMIT IN WHICH FOR THE EASIEST
C     FUNCTION LIKELY TO BE ENCOUNTERED THIS ROUTINE MIGHT JUST
C     OBTAIN
C     AN APPROXIMATION OF THE CORRECT SIGN.)
C
C     ***   NOTE ON CALCULATION   ***
C
C     THE CALCULATION IS BASED ON THE EXTENDED T-TABLE (T SUB
C     K,P,S)
C     DESCRIBED IN LYNESS AND MOLER, NUM. MATH., 8, 458-464,(1966).
C     REFERENCES IN COMMENT CARDS TO TTAB(NK,NP,NS) REFER TO
C     T-TABLE
C     WITH NK=K+1,  NP=P+1,  NS=S+1.   SINCE ONLY PART OF THE
C     EXTENDED
C     T-TABLE IS NEEDED AT ONE TIME, THAT PART IS STORED IN
C     RTAB(10,7)
C     AND IS SUBSEQUENTLY OVERWRITTEN.  HERE
C     RTAB(NK,NP-NS+1)  =  TTAB(NK,NP,NS).
C
C     NAG COPYRIGHT 1976
C     MARK 5 RELEASE
C     MARK 6B REVISED  IER-116 (MAR 1978)
C     MARK 7 REVISED IER-139 (DEC 1978)
C     MARK 8 REVISED. IER-219 (MAR 1980)
C     MARK 8D REVISED. IER-271 (DEC 1980).
      INTEGER NDERP, NDER, NDPAR, IFAIL, N, NN1, NSQ, NPAR, NSMAX,J,
     1 NEGER, NS, NPMIN, NP, NKTOP, NPR, NK, NTOP, NMAX, NMIN,NUP, NLO,
     1 NTOPM2, JNS, P01AAF,NST2,II,IFUN
      REAL*8 SRNAME
      REAL*8 DER(4), EREST(4), FACT,
     1 ACOF(10),FZ, H, HFACT, HSQ, A, B, RANGE(7), RANMIN, TEMP, TERM,
     1RTAB(10,7), TZEROM(10), ERPREV, ERNOW, XJNS, XMAX, XMIN,XNUM,
     1 THRON2, ZERO, ONE, TWO, X02ACF, BIG, SMALL, X02ABF,HTEST, FTEST
      REAL*8 FUN(NSTINT)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      DATA ZERO, ONE, TWO, THRON2 /0.0D0,1.0D0,2.0D0,1.5D0/
C
C     TO ALTER THE PRECISION OF THE WHOLE ROUTINE,ALTER THE
C     PRECISION
C     IN THE ABOVE DECLARATION AND DATA STATEMENTS
C
C     QUIT ON ZERO HBASE AND ZERO NDER.  SET CONTROL PARAMETER
C     NDPAR.
C     NDPAR = +1  ODD-ORDER DERIVATIVES ONLY.
C     NDPAR =  0  ALL DERIVATIVES
C     NDPAR = -1  EVEN-ORDER DERIVATIVES ONLY.
      BIG=16.0D+00**31.0D+00
      SMALL=16.0D+00**(-31.0D+00)
      IF (HBASE.EQ.ZERO) GO TO 20
      NDERP = NDER
      NDPAR = 0
      IF (NDER) 40, 20, 60
20    IFAIL=1
      RETURN
40    NDPAR = 4*(NDER/2) - 2*NDER - 1
      NDERP = -NDER
60    CONTINUE
      IF (NDERP.GT.4) NDERP = 4
C
C     NEXT, EVALUATE 21 FUNCTION VALUES , SET ACOF(N), AND SET
C     FIRST
C     COLUMN OF RTAB FOR ODD ORDER DERIVATIVES AND STORE IN TZEROM
C     THE
C     FIRST COLUMN OF RTAB FOR EVEN ORDER DERIVATIVES.
C     FZ = FUN(XVAL)
C
      FZ=FUN(IFUN)
      NST2=NSTINT+NSTINT
C
      DO 80 N=1,10
       NN1 = 2*N - 1
       NSQ = NN1*NN1
       ACOF(N) = NSQ
       XNUM = NN1
       H = HBASE*XNUM
C
       II=IFUN+NN1
       IF (II.GT.NSTINT) TEMP=ZERO
C
       IF (II.LE.NSTINT) TEMP=FUN(II)
C
       II=IFUN-NN1
       IF (II.EQ.0) TERM=ZERO
C
       IF (II.LT.0) TERM=-FUN(IABS(II))
C
       IF (II.GT.0) TERM=FUN(II)
C
       RTAB(N,1) = (TEMP-TERM)/(TWO*H)
       TZEROM(N) = (TEMP-FZ-FZ+TERM)/(TWO*H**2)
80    CONTINUE
C
C     SET UP FOR ODD-ORDER DERIVATIVES.
      IF (NDPAR.EQ.-1) GO TO 100
      NPAR = 1
      NSMAX = (NDERP+1)/2
      IF (NSMAX.LE.0) GO TO 380
      GO TO 140
C
C     SET UP FOR EVEN-ORDER DERIVATIVES.
100   CONTINUE
      NPAR = -1
      IF (NDPAR.EQ.+1) GO TO 460
      NSMAX = NDERP/2
      IF (NSMAX.LE.0) GO TO 460
C
C     SET THE FIRST COLUMN OF THE T-TABLE FOR EVEN ORDER
C     DERIVATIVES.
      DO 120 J=1,10
       RTAB(J,1) = TZEROM(J)
120   CONTINUE
140   CONTINUE
C
C     ODD-ORDER AND EVEN ORDER PATHS JOIN UP HERE.
C
      NEGER = 0
      HSQ = HBASE*HBASE
      FACT = ONE
      HFACT = ONE
      DO 360 NS=1,NSMAX
C
C     FROM HERE ON TO   STATEMENT 360 (NEAR END)  WE ARE DEALING
C     WITH A
C     SPECIFIED VALUE OF NS.
C
C     FOR EACH VALUE OF NP WE CALCULATE RANGE(NP)  WHICH IS THE
C     DIFFERE
C     BETWEEN THE GREATEST AND THE LEAST OF THE ELEMENTS
C     TTAB(NK,NP,NS)
C     AS WE GO ALONG WE DETERMINE ALSO THE MINIMUM OF RANGE(NP)
C     WHICH I
C     RANMIN = RANGE(NPMIN).
C     WE RETAIN NUP AND NLO WHICH ARE THE VALUES  OF NK GIVING THE
C     EXTREME VALUES OF TTAB(NK,NPMIN,NS).
C     THIS PART OF NS LOOP CONCLUDES AT STATEMENT NUMBER 280.
C
C
C     FIRST CALCULATE ELEMENTS OF T-TABLE  FOR CURRENT NS VALUE.
       NPMIN = NS
       IF (NS.EQ.1) NPMIN = 2
       DO 180 NP=NPMIN,7
          NKTOP = 10 - NP + 1
          NPR = NP - NS + 1
          DO 160 NK=1,NKTOP
             J = NP + NK - 1
             A = ACOF(J)
             B = ACOF(NK)
             TERM = ZERO
             TEMP = ZERO
             IF (NP.NE.NS) TEMP = A*RTAB(NK,NPR-1) -B*RTAB(NK+1,NPR-1)
             IF (NS.NE.1) TERM = -RTAB(NK,NPR) + RTAB(NK+1,NPR)
             RTAB(NK,NPR) = (TERM+TEMP)/(A-B)
160         CONTINUE
180      CONTINUE
C
C     NOW CALCULATE NUP,NLO AND RANMIN.
       DO 280 NP=NS,7
          NTOP = 11 - NP
          NPR = NP - NS + 1
          XMAX = RTAB(1,NPR)
          XMIN = RTAB(1,NPR)
          NMAX = 1
          NMIN = 1
C
          DO 200 NK=2,NTOP
             TEMP = RTAB(NK,NPR)
             IF (TEMP.GT.XMAX) NMAX = NK
             IF (TEMP.GT.XMAX) XMAX = TEMP
             IF (TEMP.LT.XMIN) NMIN = NK
             IF (TEMP.LT.XMIN) XMIN = TEMP
200         CONTINUE
C
          RANGE(NP) = XMAX - XMIN
          IF (NP.NE.NS) GO TO 220
          RANMIN = RANGE(NP)
          GO TO 240
220         CONTINUE
          IF (RANGE(NP).GE.RANMIN) GO TO 260
          RANMIN = RANGE(NP)
240         CONTINUE
          NPMIN = NP
          NUP = NMAX
          NLO = NMIN
          IF (NLO.EQ.NUP) NLO = NLO + 1
260         CONTINUE
280      CONTINUE
C
C     NEXT WE TAKE THE AVERAGE OF ALL EXCEPT THE EXTREME VALUES OF
C     TTAB(NK,NPMIN,NS) AS THE RESULT AND RANMIN AS THE ERROR
C     ESTIMATE.
       TERM = ZERO
       NTOP = 11 - NPMIN
       NTOPM2 = NTOP - 2
       XNUM = NTOPM2
       J = NPMIN - NS + 1
       DO 320 NK=1,NTOP
          IF (NK.EQ.NUP) GO TO 300
          IF (NK.EQ.NLO) GO TO 300
          TERM = TERM + RTAB(NK,J)
300         CONTINUE
320      CONTINUE
       TERM = TERM/XNUM
C
C     THE ABOVE RESULT AND ERROR ESTIMATE REFER TO TAYLOR
C     COEFFICIENT.
C     NEXT WE DO SCALING TO OBTAIN DERIVATIVE RESULTS INSTEAD.
C     JNS AND XJNS ARE ACTUAL ORDER OF DERIVATIVE BEING TREATED.
C     SAFETY FACTORS 1.5,1.5,2.0,2.0 AND 2.0 ARE MULTIPLIED INTO
C     THE
C     ERROR ESTIMATES FOR J = 10,11,12,13 AND 14 RESPECTIVELY.
C     THESE
C     HAVE BEEN CHOSEN BY INSPECTION OF PERFORMANCE STATISTICS.
C     THERE
C     IS NO ANALYTIC JUSTIFICATION FOR THESE PARTICULAR FACTORS.
       JNS = 2*NS - 1
       IF (NPAR.LT.0) JNS = 2*NS
       XJNS = JNS
       FACT = FACT*XJNS
C     TEST FOR UNDERFLOW OF HFACT
       IF (HFACT.GE.1.0D0) GO TO 330
       HTEST = HFACT*BIG
       FTEST = TERM*FACT
       IF ((TWO*RANMIN*FACT).GT.FTEST) FTEST = TWO*RANMIN*FACT
       IF (HTEST.GT.FTEST) GO TO 330
       DER(JNS) = BIG
       EREST(JNS) = -DER(JNS)
       NEGER = NEGER + 1
       GO TO 340
C     END OF CODE TO HANDLE ZERO HFACT
330      CONTINUE
       DER(JNS) = TERM*FACT/HFACT
       IF (JNS.EQ.10) RANMIN = THRON2*RANMIN
       IF (JNS.EQ.11) RANMIN = THRON2*RANMIN
       IF (JNS.GE.12) RANMIN = TWO*RANMIN
       EREST(JNS) = RANMIN*FACT/(HFACT)
C
C     SET SIGN OF EREST.  EREST NEGATIVE EITHER IF IT SWAMPS DER,
C     OR IF
C     TWO PREVIOUS CONSECUTIVE ERESTS OF THIS PARITY ARE NEGATIVE.
C     IT MAY ALSO BE SET NEGATIVE AT END (750).
       IF (NEGER.GE.2) EREST(JNS) = -EREST(JNS)
       IF (NEGER.GE.2) GO TO 340
       IF (TERM.LT.RANMIN) EREST(JNS) = -EREST(JNS)
       IF (-TERM.GE.RANMIN) EREST(JNS) = -EREST(JNS)
       IF (EREST(JNS).LT.ZERO) NEGER = NEGER + 1
       IF (EREST(JNS).GE.ZERO) NEGER = 0
340      CONTINUE
C
C     SECOND TEST FOR UNDERFLOW OF HFACT
       IF (HFACT.GE.1.0D0) GO TO 346
       IF (HFACT.EQ.0.0D0) GO TO 352
       IF (HSQ.GE.SMALL/HFACT) GO TO 346
       HFACT = 0.0D0
       GO TO 352
346      HFACT = HSQ*HFACT
352      FACT = FACT*(XJNS+ONE)
360   CONTINUE
C
380   CONTINUE
      IF (NPAR.GT.0) GO TO 100
C
C     SET SIGN OF EREST NEGATIVE IF TWO PREVIOUS CONSECUTIVE ERESTS
C     ARE NEGATIVE.
      IF (NDPAR.NE.0) GO TO 460
      IF (NDERP.LE.2) GO TO 460
      NEGER = 0
      ERPREV = EREST(1)
      DO 440 J=2,NDERP
       ERNOW = EREST(J)
       IF (NEGER.EQ.2) GO TO 400
       IF (ERPREV.GE.ZERO) GO TO 420
       IF (ERNOW.GE.ZERO) GO TO 420
400      NEGER = 2
       IF (ERNOW.GT.ZERO) EREST(J) = -ERNOW
420      ERPREV = ERNOW
440   CONTINUE
C
460   CONTINUE
      IFAIL = 0
C
C     DO 500 I=1,NDERP
C     EREST(I)=EREST(I)/DER(I)
C 500 CONTINUE
C
      RETURN
C     END OF D04AAF   ***   ***   ***   ***   ***
      END

C
C
      SUBROUTINE INVERT ( IA , IB , IO ,
     1                   MA , MB , MO )
      IMPLICIT REAL*8 (A-H,O-Z)
C            :
C DATE       : 24.04.1986
C AUTHOR     : PER JENSEN
C UPDATES    :
C LANGUAGE   : FORTRAN
C PURPOSE    : GIVEN A TWO BY TWO SYMMETRICAL MATRIX WHOSE ELEMENTS ARE
C            : FOURTH ORDER POLYNOMIALS IN THE R SUB I'S, INVERT
C            : CALCULATES THE EXPANSION COEFFICIENTS TO FOURTH ORDER OF
C            : ELEMENTS OF THE INVERSE MATRIX.
C            : THE CODE IS GENERATED BY REDUCE.
C            :
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 IA(15),IB(15),IO(15),MA(15),MB(15),MO(15),
     1       IA0,IA1,IA3,IA11,IA33,IA13,
     2       IA111,IA333,IA113,IA133,
     3       IA1111,IA3333,IA1113,IA1333,IA1133,
     4       IB0,IB1,IB3,IB11,IB33,IB13,
     5       IB111,IB333,IB113,IB133,
     6       IB1111,IB3333,IB1113,IB1333,IB1133,
     7       IO0,IO1,IO3,IO11,IO33,IO13,
     8       IO111,IO333,IO113,IO133,
     9       IO1111,IO3333,IO1113,IO1333,IO1133
      REAL*8 MA0,MA1,MA3,MA11,MA33,MA13,
     2       MA111,MA333,MA113,MA133,
     3       MA1111,MA3333,MA1113,MA1333,MA1133,
     4       MB0,MB1,MB3,MB11,MB33,MB13,
     5       MB111,MB333,MB113,MB133,
     6       MB1111,MB3333,MB1113,MB1333,MB1133,
     7       MO0,MO1,MO3,MO11,MO33,MO13,
     8       MO111,MO333,MO113,MO133,
     9       MO1111,MO3333,MO1113,MO1333,MO1133
      REAL*8 QA0,QA1,QA3,QA11,QA33,QA13,
     2       QA111,QA333,QA113,QA133,
     3       QA1111,QA3333,QA1113,QA1333,QA1133,
     4       QB0,QB1,QB3,QB11,QB33,QB13,
     5       QB111,QB333,QB113,QB133,
     6       QB1111,QB3333,QB1113,QB1333,QB1133,
     7       QO0,QO1,QO3,QO11,QO33,QO13,
     8       QO111,QO333,QO113,QO133,
     9       QO1111,QO3333,QO1113,QO1333,QO1133
      REAL*8  D,JAA,JBB,JAB
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      IA0=IA(1)
      IA1=IA(2)
      IA3=IA(3)
      IA11=IA(4)
      IA33=IA(5)
      IA13=IA(6)
      IA111=IA(7)
      IA333=IA(8)
      IA113=IA(9)
      IA133=IA(10)
      IA1111=IA(11)
      IA3333=IA(12)
      IA1113=IA(13)
      IA1333=IA(14)
      IA1133=IA(15)
      IB0=IB(1)
      IB1=IB(2)
      IB3=IB(3)
      IB11=IB(4)
      IB33=IB(5)
      IB13=IB(6)
      IB111=IB(7)
      IB333=IB(8)
      IB113=IB(9)
      IB133=IB(10)
      IB1111=IB(11)
      IB3333=IB(12)
      IB1113=IB(13)
      IB1333=IB(14)
      IB1133=IB(15)
      IO0=IO(1)
      IO1=IO(2)
      IO3=IO(3)
      IO11=IO(4)
      IO33=IO(5)
      IO13=IO(6)
      IO111=IO(7)
      IO333=IO(8)
      IO113=IO(9)
      IO133=IO(10)
      IO1111=IO(11)
      IO3333=IO(12)
      IO1113=IO(13)
      IO1333=IO(14)
      IO1133=IO(15)
      D=IA0*IB0-IO0*IO0
      JAA=IA0/D
      JBB=IB0/D
      JAB=IO0/D
      MA0=JBB
      MB0=JAA
      MO0=-JAB
      QA1=-(IA1*MA0+MO0*IO1)
      QB1=-(IB1*MB0+MO0*IO1)
      QO1=-(IA1*MO0+MB0*IO1)
      MB1=JAA*QB1-JAB*QO1
      MO1=-JAB*QB1+JBB*QO1
      MA1=(QA1-IO0*MO1)/IA0
      QA3=-(IA3*MA0+MO0*IO3)
      QB3=-(IB3*MB0+MO0*IO3)
      QO3=-(IA3*MO0+MB0*IO3)
      MB3= JAA*QB3- JAB*QO3
      MO3=-JAB*QB3+ JBB*QO3
      MA3=    (QA3-IO0*MO3)/IA0
      QA11=-(IA11*MA0+IA1*MA1+MO1
     1 *IO1+MO0*IO11)
      QB11=-(IB11*MB0+IB1*MB1+MO1
     1 *IO1+MO0*IO11)
      QO11=-(IA11*MO0+IA1*MO1+MB1
     1 *IO1+MB0*IO11)
      MB11= JAA*QB11- JAB*QO11
      MO11=-JAB*QB11+ JBB*QO11
      MA11=    (QA11-IO0*MO11)/IA0
      QA33=-(IA33*MA0+IA3*MA3+MO3
     1 *IO3+MO0*IO33)
      QB33=-(IB33*MB0+IB3*MB3+MO3
     1 *IO3+MO0*IO33)
      QO33=-(IA33*MO0+IA3*MO3+MB3
     1 *IO3+MB0*IO33)
      MB33= JAA*QB33- JAB*QO33
      MO33=-JAB*QB33+ JBB*QO33
      MA33=    (QA33-IO0*MO33)/IA0
      QA13=-(IA13*MA0+IA3*MA1+IA1*MA3+
     1 MO3*IO1+MO1*IO3+MO0*IO13)
      QB13=-(IB13*MB0+IB3*MB1+IB1*MB3+
     1 MO3*IO1+MO1*IO3+MO0*IO13)
      QO13=-(IA13*MO0+IA3*MO1+IA1*MO3+
     1 MB3*IO1+MB1*IO3+MB0*IO13)
      MB13= JAA*QB13- JAB*QO13
      MO13=-JAB*QB13+ JBB*QO13
      MA13=    (QA13-IO0*MO13)/IA0
      QA111=-(IA111*MA0+IA11*MA1+IA1*MA11+
     1 MO11*IO1+MO1*IO11+MO0*IO111)
      QB111=-(IB111*MB0+IB11*MB1+IB1*MB11+
     1 MO11*IO1+MO1*IO11+MO0*IO111)
      QO111=-(IA111*MO0+IA11*MO1+IA1*MO11+
     1 MB11*IO1+MB1*IO11+MB0*IO111)
      MB111= JAA*QB111- JAB*QO111
      MO111=-JAB*QB111+ JBB*QO111
      MA111=    (QA111-IO0*MO111)/IA0
      QA333=-(IA333*MA0+IA33*MA3+IA3*MA33+
     1 MO33*IO3+MO3*IO33+MO0*IO333)
      QB333=-(IB333*MB0+IB33*MB3+IB3*MB33+
     1 MO33*IO3+MO3*IO33+MO0*IO333)
      QO333=-(IA333*MO0+IA33*MO3+IA3*MO33+
     1 MB33*IO3+MB3*IO33+MB0*IO333)
      MB333= JAA*QB333- JAB*QO333
      MO333=-JAB*QB333+ JBB*QO333
      MA333=    (QA333-IO0*MO333)/IA0
      QA113=-(IA113*MA0+IA13*MA1+IA11*MA3+IA3*MA11+
     1 IA1*MA13+MO13*IO1+MO11*
     1 IO3+MO3*IO11+MO1*IO13+MO0*IO113)
      QB113=-(IB113*MB0+IB13*MB1+IB11*MB3+IB3*MB11+
     1 IB1*MB13+MO13*IO1+MO11*
     1 IO3+MO3*IO11+MO1*IO13+MO0*IO113)
      QO113=-(IA113*MO0+IA13*MO1+IA11*MO3+IA3*MO11+
     1 IA1*MO13+MB13*IO1+MB11*
     1 IO3+MB3*IO11+MB1*IO13+MB0*IO113)
      MB113= JAA*QB113- JAB*QO113
      MO113=-JAB*QB113+ JBB*QO113
      MA113=    (QA113-IO0*MO113)/IA0
      QA133=-(IA133*MA0+IA13*MA3+IA33*MA1+IA3*MA13+
     1 IA1*MA33+MO13*IO3+MO33*
     1 IO1+MO3*IO13+MO1*IO33+MO0*IO133)
      QB133=-(IB133*MB0+IB13*MB3+IB33*MB1+IB3*MB13+
     1 IB1*MB33+MO13*IO3+MO33*
     1 IO1+MO3*IO13+MO1*IO33+MO0*IO133)
      QO133=-(IA133*MO0+IA13*MO3+IA33*MO1+IA3*MO13+
     1 IA1*MO33+MB13*IO3+MB33*
     1 IO1+MB3*IO13+MB1*IO33+MB0*IO133)
      MB133= JAA*QB133- JAB*QO133
      MO133=-JAB*QB133+ JBB*QO133
      MA133=    (QA133-IO0*MO133)/IA0
      QA1111=-(IA1111*MA0+IA111*MA1+IA11*MA11+IA1*
     1 MA111+MO111*IO1+MO11*
     1 IO11+MO1*IO111+MO0*IO1111)
      QB1111=-(IB111*MB1+IB11*MB11+IB1*MB111+
     1 MO111*IO1+MO11*IO11+MO1*
     1 IO111+MO0*IO1111+MB0*IB1111)
      QO1111=-(IA1111*MO0+IA111*MO1+IA11*MO11+IA1*
     1 MO111+MB111*IO1+MB11*
     1 IO11+MB1*IO111+MB0*IO1111)
      MB1111= JAA*QB1111- JAB*QO1111
      MO1111=-JAB*QB1111+ JBB*QO1111
      MA1111=    (QA1111-IO0*MO1111)/IA0
      QA3333=-(IA3333*MA0+IA333*MA3+IA33*MA33+IA3*
     1 MA333+MO333*IO3+MO33*
     1 IO33+MO3*IO333+MO0*IO3333)
      QB3333=-(IB333*MB3+IB33*MB33+IB3*MB333+
     1 MO333*IO3+MO33*IO33+MO3*
     1 IO333+MO0*IO3333+MB0*IB3333)
      QO3333=-(IA3333*MO0+IA333*MO3+IA33*MO33+IA3*
     1 MO333+MB333*IO3+MB33*
     1 IO33+MB3*IO333+MB0*IO3333)
      MB3333= JAA*QB3333- JAB*QO3333
      MO3333=-JAB*QB3333+ JBB*QO3333
      MA3333=    (QA3333-IO0*MO3333)/IA0
      QA1113=-(IA1113*MA0+IA113*MA1+IA111*MA3+IA13*
     1 MA11+IA11*MA13+IA3*MA111+IA1*MA113+
     1 MO113*IO1+MO111*IO3+MO13*
     1 IO11+MO11*IO13+MO3*IO111+MO1*IO113+MO0*
     1 IO1113)
      QB1113=-(IB113*MB1+IB111*MB3+IB13*MB11+IB11*
     1 MB13+IB3*MB111+IB1*MB113+
     1 MO113*IO1+MO111*IO3+MO13*IO11+MO11*IO13+
     1 MO3*IO111+MO1*IO113+MO0*IO1113+MB0*IB1113)
      QO1113=-(IA1113*MO0+IA113*MO1+IA111*MO3+IA13*
     1 MO11+IA11*MO13+IA3*MO111+IA1*MO113+
     1 MB113*IO1+MB111*IO3+MB13*
     1 IO11+MB11*IO13+MB3*IO111+MB1*IO113+MB0*
     1 IO1113)
      MB1113= JAA*QB1113- JAB*QO1113
      MO1113=-JAB*QB1113+ JBB*QO1113
      MA1113=    (QA1113-IO0*MO1113)/IA0
      QA1333=-(IA1333*MA0+IA133*MA3+IA333*MA1+IA13*
     1 MA33+IA33*MA13+IA3*MA133+IA1*MA333+
     1 MO133*IO3+MO333*IO1+MO13*
     1 IO33+MO33*IO13+MO3*IO133+MO1*IO333+MO0*
     1 IO1333)
      QB1333=-(IB133*MB3+IB333*MB1+IB13*MB33+IB33*
     1 MB13+IB3*MB133+IB1*MB333+
     1 MO133*IO3+MO333*IO1+MO13*IO33+MO33*IO13+
     1 MO3*IO133+MO1*IO333+MO0*IO1333+MB0*IB1333)
      QO1333=-(IA1333*MO0+IA133*MO3+IA333*MO1+IA13*
     1 MO33+IA33*MO13+IA3*MO133+IA1*MO333+
     1 MB133*IO3+MB333*IO1+MB13*
     1 IO33+MB33*IO13+MB3*IO133+MB1*IO333+MB0*
     1 IO1333)
      MB1333= JAA*QB1333- JAB*QO1333
      MO1333=-JAB*QB1333+ JBB*QO1333
      MA1333=    (QA1333-IO0*MO1333)/IA0
      QA1133=-(IA1133*MA0+IA133*MA1+IA113*MA3+IA13*
     1 MA13+IA33*MA11+IA11*MA33+IA3*MA113+IA1*
     1 MA133+MO133*IO1+MO113*
     1 IO3+MO13*IO13+MO33*IO11+MO11*IO33+MO3*IO113+
     1 MO1*IO133+MO0*IO1133)
      QB1133=-(IB133*MB1+IB113*MB3+IB13*MB13+IB33*
     1 MB11+IB11*MB33+IB3*MB113+IB1*MB133+
     1 MO133*IO1+MO113*IO3+MO13*
     1 IO13+MO33*IO11+MO11*IO33+MO3*IO113+MO1*IO133
     1 +MO0*IO1133+MB0*IB1133)
      QO1133=-(IA1133*MO0+IA133*MO1+IA113*MO3+IA13*
     1 MO13+IA33*MO11+IA11*MO33+IA3*MO113+IA1*
     1 MO133+MB133*IO1+MB113*
     1 IO3+MB13*IO13+MB33*IO11+MB11*IO33+MB3*IO113+
     1 MB1*IO133+MB0*IO1133)
      MB1133= JAA*QB1133- JAB*QO1133
      MO1133=-JAB*QB1133+ JBB*QO1133
      MA1133=    (QA1133-IO0*MO1133)/IA0
      MA(1)=MA0
      MA(2)=MA1
      MA(3)=MA3
      MA(4)=MA11
      MA(5)=MA33
      MA(6)=MA13
      MA(7)=MA111
      MA(8)=MA333
      MA(9)=MA113
      MA(10)=MA133
      MA(11)=MA1111
      MA(12)=MA3333
      MA(13)=MA1113
      MA(14)=MA1333
      MA(15)=MA1133
      MB(1)=MB0
      MB(2)=MB1
      MB(3)=MB3
      MB(4)=MB11
      MB(5)=MB33
      MB(6)=MB13
      MB(7)=MB111
      MB(8)=MB333
      MB(9)=MB113
      MB(10)=MB133
      MB(11)=MB1111
      MB(12)=MB3333
      MB(13)=MB1113
      MB(14)=MB1333
      MB(15)=MB1133
      MO(1)=MO0
      MO(2)=MO1
      MO(3)=MO3
      MO(4)=MO11
      MO(5)=MO33
      MO(6)=MO13
      MO(7)=MO111
      MO(8)=MO333
      MO(9)=MO113
      MO(10)=MO133
      MO(11)=MO1111
      MO(12)=MO3333
      MO(13)=MO1113
      MO(14)=MO1333
      MO(15)=MO1133
      RETURN
      END
C
C
      SUBROUTINE MUPV ( MUEX , P1EX , P3EX , MUPEX1 , MUPEX3 )
      IMPLICIT REAL*8 (A-H,O-Z)
C            :
C DATE       : 23.05.1986
C AUTHOR     : PER JENSEN
C UPDATES    :
C LANGUAGE   : FORTRAN
C PURPOSE    : CALCULATION OF THE EXPANSION COEFFICIENTS IN THE CORIOLIS
C            : TERMS IN THE MORBID HAMILTONIAN.
C            : THE CODE IS GENERATED BY REDUCE.
C            :
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 MUEX(15),P1EX(15),P3EX(15),MUPEX1(15),MUPEX3(15),
     1      MU0,MU1,MU3,MU11,MU33,MU13,
     2      PV11,PV13,PV111,PV133,PV113,PV1111,PV1333,PV1113,PV1133,
     3      PV31,PV33,PV311,PV333,PV313,PV3111,PV3333,PV3113,PV3133,
     4      Q11,Q13,Q111,Q133,Q113,Q1111,Q1333,Q1113,Q1133,
     5      Q31,Q33,Q311,Q333,Q313,Q3111,Q3333,Q3113,Q3133
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      MU0=MUEX(1)
      MU1=MUEX(2)
      MU3=MUEX(3)
      MU11=MUEX(4)
      MU33=MUEX(5)
      MU13=MUEX(6)
      PV11=P1EX(2)
      PV13=P1EX(3)
      PV111=P1EX(4)
      PV133=P1EX(5)
      PV113=P1EX(6)
      PV1111=P1EX(7)
      PV1333=P1EX(8)
      PV1113=P1EX(9)
      PV1133=P1EX(10)
      PV31=P3EX(2)
      PV33=P3EX(3)
      PV311=P3EX(4)
      PV333=P3EX(5)
      PV313=P3EX(6)
      PV3111=P3EX(7)
      PV3333=P3EX(8)
      PV3113=P3EX(9)
      PV3133=P3EX(10)
      Q11=PV11*MU0
      Q13=PV13*MU0
      Q111=PV111*MU0+PV11*MU1
      Q133=PV133*MU0+PV13*MU3
      Q113=PV113*MU0+PV13*MU1+PV11*MU3
      Q1111=PV1111*MU0+PV111*MU1+PV11*MU11
      Q1333=PV1333*MU0+PV133*MU3+PV13*MU33
      Q1113=PV1113*MU0+PV113*MU1+PV111*MU3+PV13*MU11+PV11*MU13
      Q1133=PV1133*MU0+PV113*MU3+PV133*MU1+PV13*MU13+PV11*MU33
      Q31=PV31*MU0
      Q33=PV33*MU0
      Q311=PV311*MU0+PV31*MU1
      Q333=PV333*MU0+PV33*MU3
      Q313=PV313*MU0+PV33*MU1+PV31*MU3
      Q3111=PV3111*MU0+PV311*MU1+PV31*MU11
      Q3333=PV3333*MU0+PV333*MU3+PV33*MU33
      Q3113=PV3113*MU0+PV313*MU1+PV311*MU3+PV33*MU11+PV31*MU13
      Q3133=PV3133*MU0+PV313*MU3+PV333*MU1+PV33*MU13+PV31*MU33
      MUPEX1(1)=0.0D0
      MUPEX1(2)=Q11
      MUPEX1(3)=Q13
      MUPEX1(4)=Q111
      MUPEX1(5)=Q133
      MUPEX1(6)=Q113
      MUPEX1(7)=Q1111
      MUPEX1(8)=Q1333
      MUPEX1(9)=Q1113
      MUPEX1(10)=Q1133
      MUPEX3(1)=0.0D0
      MUPEX3(2)=Q31
      MUPEX3(3)=Q33
      MUPEX3(4)=Q311
      MUPEX3(5)=Q333
      MUPEX3(6)=Q313
      MUPEX3(7)=Q3111
      MUPEX3(8)=Q3333
      MUPEX3(9)=Q3113
      MUPEX3(10)=Q3133
      RETURN
      END
C
C
      SUBROUTINE VIBRAM ( CHX11 , CHX13 , CHX31 , CHX33 ,
     1                   CHR11 , CHR13 , CHR31 , CHR33 ,
     2                   PX1   , PX3   , PR1   , PR3   )
C            :
C DATE       : 29.04.1986
C AUTHOR     : PER JENSEN
C UPDATES    : PRB LONG NAMES COMMENTED OUT
C LANGUAGE   : FORTRAN
C PURPOSE    : CALCULATE EXPANSION COEFFICIENTS OF THE TWO VIBRATIONAL
C            : ANGULAR MOMENTA, P SUB X AND P SUB RHO.
C            : THE CODE IS GENERATED BY REDUCE.
C            :
      IMPLICIT REAL*8  (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 CHX11,CHX13,CHX31,CHX33,CHR11,CHR31,CHR13,CHR33
      REAL*8 PX1(15),PX3(15),PR1(15),PR3(15)
      REAL*8 PX11,PX13,PX111,PX133,PX113,PX1111,PX1333,PX1113,PX1133,
     2       PX31,PX33,PX311,PX333,PX313,PX3111,PX3333,PX3113,PX3133,
     4       PR11,PR13,PR111,PR133,PR113,PR1111,PR1333,PR1113,PR1133,
     6       PR31,PR33,PR311,PR333,PR313,PR3111,PR3333,PR3113,PR3133
C ** 1       PX11111,PX13333,PX11113,PX11333,PX11133, ) ***************
C ** 3       PX31111,PX33333,PX31113,PX31333,PX31133, ) COMMENTED OUT *
C ** 5       PR11111,PR13333,PR11113,PR11333,PR11133, ) BY PRB        *
C ** 7       PR31111,PR33333,PR31113,PR31333,PR31133  ) ***************
      REAL*8 A11,A13,A31,A33,A111,A133,A311,A333,A113,A313,
     1      D11,D13,D31,D33,
     2      D111,D131,D311,D331,D113,D133,D313,D333,
     3      D1111,D1311,D3111,D3311,D1133,D1333,D3133,D3333,
     3      D1113,D1313,D3113,D3313
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      A11=2.D0*RE12
      A13=0.D0
      A111=(V**2-SR**2*U13**2+2.D0*SR**2*U3*U1)/(V**2+2.D0*V*SR**2*
     1      U13+SR**4*U13**2)
      A133=(SR**2*U3**2*RE12**2)/((V**2+2.D0*V*SR**2*U13+SR**4*U13
     1      **2)*RE32**2)
      A113=(2.D0*SR**2*U13*U3*CR*RE12)/((V**2+2.D0*V*SR**2*U13+SR**4
     1      *U13**2)*RE32)
      A31=0.D0
      A33=2.D0*RE32
      A311=(SR**2*U1**2*RE32**2)/((V**2+2.D0*V*SR**2*U13+SR**4*U13
     1      **2)*RE12**2)
      A333=(V**2-SR**2*U13**2+2.D0*SR**2*U3*U1)/(V**2+2.D0*V*SR**2*
     1      U13+SR**4*U13**2)
      A313=(2.D0*SR**2*U13*U1*CR*RE32)/((V**2+2.D0*V*SR**2*U13+SR**4
     1      *U13**2)*RE12)
      D11=1.D0
      D13=0.D0
      D31=0.D0
      D33=1.D0
      D111=(A113*B31+2.D0*A111*B11-2.D0)/(2.D0*RE12)
      D113=(A113*B33+2.D0*A111*B13)/(2.D0*RE12)
      D1111=(A113*RE12*B311-A113*B31+2.D0*A111*RE12*B111-2.D0*A111*
     1      B11+2.D0)/(2.D0*RE12**2)
      D1133=(A113*B333+2.D0*A111*B133)/(2.D0*RE12)
      D1113=(A113*RE12*B313-A113*B33+2.D0*A111*RE12*B113-2.D0*A111*
     1      B13)/(2.D0*RE12**2)
      D311=(B31*A313+2.D0*B11*A311)/(2.D0*RE32)
      D313=(B33*A313+2.D0*B13*A311)/(2.D0*RE32)
      D3111=(B311*A313+2.D0*B111*A311)/(2.D0*RE32)
      D3133=(B333*A313*RE32-B33*A313+2.D0*B133*A311*RE32-2.D0*B13*
     1      A311)/(2.D0*RE32**2)
      D3113=(B313*A313*RE32-B31*A313+2.D0*B113*A311*RE32-2.D0*B11*
     1      A311)/(2.D0*RE32**2)
      D131=(A113*B11+2.D0*A133*B31)/(2.D0*RE12)
      D133=(A113*B13+2.D0*A133*B33)/(2.D0*RE12)
      D1311=(A113*RE12*B111-A113*B11+2.D0*A133*RE12*B311-2.D0*A133*
     1      B31)/(2.D0*RE12**2)
      D1333=(A113*B133+2.D0*A133*B333)/(2.D0*RE12)
      D1313=(A113*RE12*B113-A113*B13+2.D0*A133*RE12*B313-2.D0*A133*
     1      B33)/(2.D0*RE12**2)
      D331=(2.D0*B31*A333+B11*A313)/(2.D0*RE32)
      D333=(2.D0*B33*A333+B13*A313-2.D0)/(2.D0*RE32)
      D3311=(2.D0*B311*A333+B111*A313)/(2.D0*RE32)
      D3333=(2.D0*B333*A333*RE32-2.D0*B33*A333+B133*A313*RE32-B13*
     1      A313+2.D0)/(2.D0*RE32**2)
      D3313=(2.D0*B313*A333*RE32-2.D0*B31*A333+B113*A313*RE32-B11*
     1      A313)/(2.D0*RE32**2)
      PX11=CHX13*D13*B11+CHX31*D11*B31+CHX33*D13*B31+CHX11*D11*
     1      B11
      PX13=CHX13*D13*B13+CHX31*D11*B33+CHX33*D13*B33+CHX11*D11*
     1      B13
      PX111=CHX13*D131*B11+CHX13*D13*B111+CHX31*D111*B31+CHX31*
     1      D11*B311+CHX33*D131*B31+CHX33*D13*B311+CHX11*D111*B11+
     1      CHX11*D11*B111
      PX133=CHX13*D133*B13+CHX13*D13*B133+CHX31*D113*B33+CHX31*
     1      D11*B333+CHX33*D133*B33+CHX33*D13*B333+CHX11*D113*B13+
     1      CHX11*D11*B133
      PX113=CHX13*D133*B11+CHX13*D131*B13+CHX13*D13*B113+CHX31*
     1      D113*B31+CHX31*D111*B33+CHX31*D11*B313+CHX33*D133*B31+
     1      CHX33*D131*B33+CHX33*D13*B313+CHX11*D113*B11+CHX11*D111*
     1      B13+CHX11*D11*B113
      PX1111=CHX13*D1311*B11+CHX13*D131*B111+CHX13*D13*B1111+
     1      CHX31*D1111*B31+CHX31*D111*B311+CHX31*D11*B3111+CHX33*
     1      D1311*B31+CHX33*D131*B311+CHX33*D13*B3111+CHX11*D1111*B11
     1      +CHX11*D111*B111+CHX11*D11*B1111
      PX1333=CHX13*D1333*B13+CHX13*D133*B133+CHX13*D13*B1333+
     1      CHX31*D1133*B33+CHX31*D113*B333+CHX31*D11*B3333+CHX33*
     1      D1333*B33+CHX33*D133*B333+CHX33*D13*B3333+CHX11*D1133*B13
     1      +CHX11*D113*B133+CHX11*D11*B1333
      PX1113=CHX13*D1313*B11+CHX13*D1311*B13+CHX13*D133*B111+
     1      CHX13*D131*B113+CHX13*D13*B1113+CHX31*D1113*B31+CHX31*
     1      D1111*B33+CHX31*D113*B311+CHX31*D111*B313+CHX31*D11*B3113
     1      +CHX33*D1313*B31+CHX33*D1311*B33+CHX33*D133*B311+CHX33*
     1      D131*B313+CHX33*D13*B3113+CHX11*D1113*B11+CHX11*D1111*B13
     1      +CHX11*D113*B111+CHX11*D111*B113+CHX11*D11*B1113
      PX1133=CHX13*D1313*B13+CHX13*D1333*B11+CHX13*D133*B113+
     1      CHX13*D131*B133+CHX13*D13*B1133+CHX31*D1113*B33+CHX31*
     1      D1133*B31+CHX31*D113*B313+CHX31*D111*B333+CHX31*D11*B3133
     1      +CHX33*D1313*B33+CHX33*D1333*B31+CHX33*D133*B313+CHX33*
     1      D131*B333+CHX33*D13*B3133+CHX11*D1113*B13+CHX11*D1133*B11
     1      +CHX11*D113*B113+CHX11*D111*B133+CHX11*D11*B1133
      PX31=CHX13*D33*B11+CHX31*D31*B31+CHX33*D33*B31+CHX11*D31*
     1      B11
      PX33=CHX13*D33*B13+CHX31*D31*B33+CHX33*D33*B33+CHX11*D31*
     1      B13
      PX311=CHX13*D331*B11+CHX13*D33*B111+CHX31*D311*B31+CHX31*
     1      D31*B311+CHX33*D331*B31+CHX33*D33*B311+CHX11*D311*B11+
     1      CHX11*D31*B111
      PX333=CHX13*D333*B13+CHX13*D33*B133+CHX31*D313*B33+CHX31*
     1      D31*B333+CHX33*D333*B33+CHX33*D33*B333+CHX11*D313*B13+
     1      CHX11*D31*B133
      PX313=CHX13*D333*B11+CHX13*D331*B13+CHX13*D33*B113+CHX31*
     1      D313*B31+CHX31*D311*B33+CHX31*D31*B313+CHX33*D333*B31+
     1      CHX33*D331*B33+CHX33*D33*B313+CHX11*D313*B11+CHX11*D311*
     1      B13+CHX11*D31*B113
      PX3111=CHX13*D3311*B11+CHX13*D331*B111+CHX13*D33*B1111+
     1      CHX31*D3111*B31+CHX31*D311*B311+CHX31*D31*B3111+CHX33*
     1      D3311*B31+CHX33*D331*B311+CHX33*D33*B3111+CHX11*D3111*B11
     1      +CHX11*D311*B111+CHX11*D31*B1111
      PX3333=CHX13*D3333*B13+CHX13*D333*B133+CHX13*D33*B1333+
     1      CHX31*D3133*B33+CHX31*D313*B333+CHX31*D31*B3333+CHX33*
     1      D3333*B33+CHX33*D333*B333+CHX33*D33*B3333+CHX11*D3133*B13
     1      +CHX11*D313*B133+CHX11*D31*B1333
      PX3113=CHX13*D3313*B11+CHX13*D3311*B13+CHX13*D333*B111+
     1      CHX13*D331*B113+CHX13*D33*B1113+CHX31*D3113*B31+CHX31*
     1      D3111*B33+CHX31*D313*B311+CHX31*D311*B313+CHX31*D31*B3113
     1      +CHX33*D3313*B31+CHX33*D3311*B33+CHX33*D333*B311+CHX33*
     1      D331*B313+CHX33*D33*B3113+CHX11*D3113*B11+CHX11*D3111*B13
     1      +CHX11*D313*B111+CHX11*D311*B113+CHX11*D31*B1113
      PX3133=CHX13*D3313*B13+CHX13*D3333*B11+CHX13*D333*B113+
     1      CHX13*D331*B133+CHX13*D33*B1133+CHX31*D3113*B33+CHX31*
     1      D3133*B31+CHX31*D313*B313+CHX31*D311*B333+CHX31*D31*B3133
     1      +CHX33*D3313*B33+CHX33*D3333*B31+CHX33*D333*B313+CHX33*
     1      D331*B333+CHX33*D33*B3133+CHX11*D3113*B13+CHX11*D3133*B11
     1      +CHX11*D313*B113+CHX11*D311*B133+CHX11*D31*B1133
      PR11=CHR13*D13*B11+CHR31*D11*B31+CHR33*D13*B31+CHR11*D11*
     1      B11
      PR13=CHR13*D13*B13+CHR31*D11*B33+CHR33*D13*B33+CHR11*D11*
     1      B13
      PR111=CHR13*D131*B11+CHR13*D13*B111+CHR31*D111*B31+CHR31*
     1      D11*B311+CHR33*D131*B31+CHR33*D13*B311+CHR11*D111*B11+
     1      CHR11*D11*B111
      PR133=CHR13*D133*B13+CHR13*D13*B133+CHR31*D113*B33+CHR31*
     1      D11*B333+CHR33*D133*B33+CHR33*D13*B333+CHR11*D113*B13+
     1      CHR11*D11*B133
      PR113=CHR13*D133*B11+CHR13*D131*B13+CHR13*D13*B113+CHR31*
     1      D113*B31+CHR31*D111*B33+CHR31*D11*B313+CHR33*D133*B31+
     1      CHR33*D131*B33+CHR33*D13*B313+CHR11*D113*B11+CHR11*D111*
     1      B13+CHR11*D11*B113
      PR1111=CHR13*D1311*B11+CHR13*D131*B111+CHR13*D13*B1111+
     1      CHR31*D1111*B31+CHR31*D111*B311+CHR31*D11*B3111+CHR33*
     1      D1311*B31+CHR33*D131*B311+CHR33*D13*B3111+CHR11*D1111*B11
     1      +CHR11*D111*B111+CHR11*D11*B1111
      PR1333=CHR13*D1333*B13+CHR13*D133*B133+CHR13*D13*B1333+
     1      CHR31*D1133*B33+CHR31*D113*B333+CHR31*D11*B3333+CHR33*
     1      D1333*B33+CHR33*D133*B333+CHR33*D13*B3333+CHR11*D1133*B13
     1      +CHR11*D113*B133+CHR11*D11*B1333
      PR1113=CHR13*D1313*B11+CHR13*D1311*B13+CHR13*D133*B111+
     1      CHR13*D131*B113+CHR13*D13*B1113+CHR31*D1113*B31+CHR31*
     1      D1111*B33+CHR31*D113*B311+CHR31*D111*B313+CHR31*D11*B3113
     1      +CHR33*D1313*B31+CHR33*D1311*B33+CHR33*D133*B311+CHR33*
     1      D131*B313+CHR33*D13*B3113+CHR11*D1113*B11+CHR11*D1111*B13
     1      +CHR11*D113*B111+CHR11*D111*B113+CHR11*D11*B1113
      PR1133=CHR13*D1313*B13+CHR13*D1333*B11+CHR13*D133*B113+
     1      CHR13*D131*B133+CHR13*D13*B1133+CHR31*D1113*B33+CHR31*
     1      D1133*B31+CHR31*D113*B313+CHR31*D111*B333+CHR31*D11*B3133
     1      +CHR33*D1313*B33+CHR33*D1333*B31+CHR33*D133*B313+CHR33*
     1      D131*B333+CHR33*D13*B3133+CHR11*D1113*B13+CHR11*D1133*B11
     1      +CHR11*D113*B113+CHR11*D111*B133+CHR11*D11*B1133
      PR31=CHR13*D33*B11+CHR31*D31*B31+CHR33*D33*B31+CHR11*D31*
     1      B11
      PR33=CHR13*D33*B13+CHR31*D31*B33+CHR33*D33*B33+CHR11*D31*
     1      B13
      PR311=CHR13*D331*B11+CHR13*D33*B111+CHR31*D311*B31+CHR31*
     1      D31*B311+CHR33*D331*B31+CHR33*D33*B311+CHR11*D311*B11+
     1      CHR11*D31*B111
      PR333=CHR13*D333*B13+CHR13*D33*B133+CHR31*D313*B33+CHR31*
     1      D31*B333+CHR33*D333*B33+CHR33*D33*B333+CHR11*D313*B13+
     1      CHR11*D31*B133
      PR313=CHR13*D333*B11+CHR13*D331*B13+CHR13*D33*B113+CHR31*
     1      D313*B31+CHR31*D311*B33+CHR31*D31*B313+CHR33*D333*B31+
     1      CHR33*D331*B33+CHR33*D33*B313+CHR11*D313*B11+CHR11*D311*
     1      B13+CHR11*D31*B113
      PR3111=CHR13*D3311*B11+CHR13*D331*B111+CHR13*D33*B1111+
     1      CHR31*D3111*B31+CHR31*D311*B311+CHR31*D31*B3111+CHR33*
     1      D3311*B31+CHR33*D331*B311+CHR33*D33*B3111+CHR11*D3111*B11
     1      +CHR11*D311*B111+CHR11*D31*B1111
      PR3333=CHR13*D3333*B13+CHR13*D333*B133+CHR13*D33*B1333+
     1      CHR31*D3133*B33+CHR31*D313*B333+CHR31*D31*B3333+CHR33*
     1      D3333*B33+CHR33*D333*B333+CHR33*D33*B3333+CHR11*D3133*B13
     1      +CHR11*D313*B133+CHR11*D31*B1333
      PR3113=CHR13*D3313*B11+CHR13*D3311*B13+CHR13*D333*B111+
     1      CHR13*D331*B113+CHR13*D33*B1113+CHR31*D3113*B31+CHR31*
     1      D3111*B33+CHR31*D313*B311+CHR31*D311*B313+CHR31*D31*B3113
     1      +CHR33*D3313*B31+CHR33*D3311*B33+CHR33*D333*B311+CHR33*
     1      D331*B313+CHR33*D33*B3113+CHR11*D3113*B11+CHR11*D3111*B13
     1      +CHR11*D313*B111+CHR11*D311*B113+CHR11*D31*B1113
      PR3133=CHR13*D3313*B13+CHR13*D3333*B11+CHR13*D333*B113+
     1      CHR13*D331*B133+CHR13*D33*B1133+CHR31*D3113*B33+CHR31*
     1      D3133*B31+CHR31*D313*B313+CHR31*D311*B333+CHR31*D31*B3133
     1      +CHR33*D3313*B33+CHR33*D3333*B31+CHR33*D333*B313+CHR33*
     1      D331*B333+CHR33*D33*B3133+CHR11*D3113*B13+CHR11*D3133*B11
     1      +CHR11*D313*B113+CHR11*D311*B133+CHR11*D31*B1133
      PX1(1)=0.0D0
      PX1(2)=PX11
      PX1(3)=PX13
      PX1(4)=PX111
      PX1(5)=PX133
      PX1(6)=PX113
      PX1(7)=PX1111
      PX1(8)=PX1333
      PX1(9)=PX1113
      PX1(10)=PX1133
      PX1(11)=0.0D+00
      PX1(12)=0.0D+00
      PX1(13)=0.0D+00
      PX1(14)=0.0D+00
      PX1(15)=0.0D+00
      PX3(1)=0.0D0
      PX3(2)=PX31
      PX3(3)=PX33
      PX3(4)=PX311
      PX3(5)=PX333
      PX3(6)=PX313
      PX3(7)=PX3111
      PX3(8)=PX3333
      PX3(9)=PX3113
      PX3(10)=PX3133
      PX3(11)=0.0D+00
      PX3(12)=0.0D+00
      PX3(13)=0.0D+00
      PX3(14)=0.0D+00
      PX3(15)=0.0D+00
      PR1(1)=0.0D0
      PR1(2)=PR11
      PR1(3)=PR13
      PR1(4)=PR111
      PR1(5)=PR133
      PR1(6)=PR113
      PR1(7)=PR1111
      PR1(8)=PR1333
      PR1(9)=PR1113
      PR1(10)=PR1133
      PR1(11)=0.0D+00
      PR1(12)=0.0D+00
      PR1(13)=0.0D+00
      PR1(14)=0.0D+00
      PR1(15)=0.0D+00
      PR3(1)=0.0D0
      PR3(2)=PR31
      PR3(3)=PR33
      PR3(4)=PR311
      PR3(5)=PR333
      PR3(6)=PR313
      PR3(7)=PR3111
      PR3(8)=PR3333
      PR3(9)=PR3113
      PR3(10)=PR3133
      PR3(11)=0.0D+00
      PR3(12)=0.0D+00
      PR3(13)=0.0D+00
      PR3(14)=0.0D+00
      PR3(15)=0.0D+00
      RETURN
      END
      SUBROUTINE STRTCH ( IW1    , IW3    , OVER   , TMAT   ,
     1                   ESTR   , SMAT   , VMAT   , UMAT   ,
     1                   EWRK   , HTR    , ICOMA  , NDBA   ,
     1                   IDOM   )
C
      IMPLICIT REAL*8 (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 , NFIL6 ,
     5       NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      INTEGER IOSC1,IOSC3,I,J,K,L,IR,JL,IRN,IFA,IFB
      REAL*8 G,GC1,GC3,GC1113,GC3133,GC1133,GC3113
      INTEGER IW1(LENIW),IW3(LENIW),ICOMA(LENIW),NDBA(LENIW),
     1       IDOM(LENIW)
      INTEGER INDEX,ISTA,IEND,NOVA,L1,L2,K1,K2,IPOM,ISNT,IFAIL
      REAL*8  OVER(2,MBASP1,MBASP1),
     1       VMAT(NOBAS,NOBAS),SMAT(NOBAS,NOBAS),
     1       UMAT(2,NOBAS),ESTR(NOBAS),EWRK(NOBAS),
     1       TMAT(NOBAS,NOBAS),HTR(NOBAS)
      REAL*8  CONCOR,CONFC1,CONG11,CONG33,CONG13,
     1       POM,POM0,RCPSQ2,VMKJ
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
C
      IOSC1=1
      IOSC3=2
      IF ( SYMM ) IOSC3=1
      CONCOR=PLANCK*AVOGNO*1.0D+16/(1.6D+01*PI*PI*VELLGT)
      CONFC1=2.0D+00*CONCOR
      CONG11=-CONFC1*(M1+M2)/(M1*M2)
      CONG33=-CONFC1*(M3+M2)/(M3*M2)
      CONG13=-CONFC1/M2
C
C ZERO ALL ELEMENTS IN THE HAMILTONIAN MATRIX
C
      DO 150 I=1,NOBAS
      DO 150 J=1,NOBAS
150   SMAT(J,I)=0.0D+00
C
      CALL YY(IOSC1,IW1,IW3,OVER,VMAT)
      G=F11
      DO 800 JL=1,NOBAS
      DO 800 IR=JL,NOBAS
800   SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
      CALL YY(IOSC3,IW3,IW1,OVER,VMAT)
      G=F33
      DO 1000 JL=1,NOBAS
      DO 1000 IR=JL,NOBAS
1000  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
      CALL Y1Y2(IOSC1,IOSC3,IW1,IW3,OVER,VMAT)
      G=F13
      DO 1200 JL=1,NOBAS
      DO 1200 IR=JL,NOBAS
1200  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
      CALL YYY(IOSC1,IW1,IW3,OVER,VMAT)
      G=F111
      DO 1400 JL=1,NOBAS
      DO 1400 IR=JL,NOBAS
1400  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
      CALL YYY(IOSC3,IW3,IW1,OVER,VMAT)
      G=F333
      DO 1600 JL=1,NOBAS
      DO 1600 IR=JL,NOBAS
1600  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
C
      CALL Y1Y1Y2(IOSC1,IOSC3,IW1,IW3,OVER,VMAT)
      G=F113
      DO 1800 JL=1,NOBAS
      DO 1800 IR=JL,NOBAS
1800  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
      CALL Y1Y1Y2(IOSC3,IOSC1,IW3,IW1,OVER,VMAT)
        G=F133
      DO 2000 JL=1,NOBAS
      DO 2000 IR=JL,NOBAS
2000  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
C
      CALL YYYY(IOSC1,IW1,IW3,OVER,VMAT)
      G=F1111
      DO 2200 JL=1,NOBAS
      DO 2200 IR=JL,NOBAS
2200  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
C
      CALL YYYY(IOSC3,IW3,IW1,OVER,VMAT)
      G=F3333
      DO 2400 JL=1,NOBAS
      DO 2400 IR=JL,NOBAS
2400  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
C
      CALL Y13Y2(IOSC1,IOSC3,IW1,IW3,OVER,VMAT)
      G=F1113
      DO 2600 JL=1,NOBAS
      DO 2600 IR=JL,NOBAS
2600  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
C
      CALL Y13Y2(IOSC3,IOSC1,IW3,IW1,OVER,VMAT)
      G=F1333
      DO 2800 JL=1,NOBAS
      DO 2800 IR=JL,NOBAS
2800  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
C
      CALL Y12Y22(IOSC1,IOSC3,IW1,IW3,OVER,VMAT)
      G=F1133
      DO 3000 JL= 1,NOBAS
      DO 3000 IR=JL,NOBAS
3000  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
C
      CALL PP(IOSC1,IW1,IW3,OVER,VMAT)
      G=CONG11
      DO 3200 JL=1,NOBAS
      DO 3200 IR=JL,NOBAS
      SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
3200  CONTINUE
C
C
      CALL PP(IOSC3,IW3,IW1,OVER,VMAT)
      G=CONG33
      DO 3400 JL=1,NOBAS
      DO 3400 IR=JL,NOBAS
      SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
3400  CONTINUE
C
C
      CALL P1P2(IOSC1,IOSC3,IW1,IW3,OVER,VMAT)
      G=-2.0D+00*CONG13*DCOS(RHOE)
      DO 3600 JL=1,NOBAS
      DO 3600 IR=JL,NOBAS
3600  SMAT(IR,JL)=SMAT(IR,JL)+G*VMAT(IR,JL)
C
C
      DO 3610 JL=1,NOBAS-1
      DO 3610 IR=JL+1,NOBAS
3610  SMAT(JL,IR)=SMAT(IR,JL)
C
C
      IF (ITEST.LE.0) GOTO 3620
      WRITE(NFIL6,9000)
      WRITE(NFIL6,9100)((SMAT(IR,JL),JL=1,NOBAS),IR=1,NOBAS)
      WRITE(NFIL6,9100)(SMAT(IR,IR),IR=1,NOBAS)
C
C
3620  RCPSQ2=1.0D+00/DSQRT(2.0D+00)
C
C CONSTRUCT THE U MATRIX, WHICH TRANSFORMS INTO SYMMETRIZED VIBRATIONAL
C BASIS FUNCTIONS.
C
      IF ( SYMM ) GOTO 3800
      DO 3700 I=1,NOBAS
      NDBA(I)=1
      ICOMA(I)=I-1
      UMAT(1,I)=1.0D+00
3700  UMAT(2,I)=0.0D+00
      GOTO 4100
3800  NOVA=KSTYPA(1)
      IFA=0
      IFB=0
      DO 4000 I=1,NOBAS
      V1=IW1(I)
      V3=IW3(I)
      IF (V3 .LT. V1) GOTO 4000
      IF (V3 .GT. V1) GOTO 3900
      IFA=IFA+1
      NDBA(IFA)=1
      ICOMA(IFA)=I-1
      UMAT(1,IFA)=1.0D+00
      UMAT(2,IFA)=0.0D+00
      GOTO 4000
3900  IFA=IFA+1
      IFB=IFB+1
      NDBA(IFA)=2
      ICOMA(IFA)=I-1
      UMAT(1,IFA)=RCPSQ2
      UMAT(2,IFA)=RCPSQ2
      NDBA(NOVA+IFB)=2
      ICOMA(NOVA+IFB)=I-1
      UMAT(1,NOVA+IFB)=RCPSQ2
      UMAT(2,NOVA+IFB)=-RCPSQ2
4000  CONTINUE
C
4100  CONTINUE
C   PRB COMMENT OUT OF PRINT
C     IF (IPRINT .GT. 0) THEN
C     WRITE(NFIL6,9200) (I,I=1,2)
C     DO 4200 I=1,NOBAS
C     J=NDBA(I)
C     WRITE(NFIL6,9300) I,ICOMA(I),(UMAT(K,I),K=1,J)
C4200 CONTINUE
C     ENDIF
      DO 4500 I=1,NOBAS
      K2=NDBA(I)
      DO 4500 J=I,NOBAS
      L2=NDBA(J)
      POM=0.0D0
      DO 4400 K=1,K2
      K1=ICOMA(I)+K
      POM0=0.0D0
      DO 4300 L=1,L2
      L1=ICOMA(J)+L
4300  POM0=POM0+SMAT(L1,K1)*UMAT(L,J)
      POM=POM+UMAT(K,I)*POM0
4400  CONTINUE
      VMAT(I,J)=POM
      VMAT(J,I)=POM
4500  CONTINUE
      IF (ITEST.LE.0) GOTO 4800
      WRITE(NFIL6,9400)
      WRITE(NFIL6,9500)((VMAT(I,J),J=1,NOBAS),I=1,NOBAS)
      WRITE(NFIL6,9500)(VMAT(I,I),I=1,NOBAS)
C
      DO 4700 I=1,NOBAS
      DO 4600 J=1,NOBAS
      IDOM(J)=0
      IF(DABS(VMAT(I,J)).LT.1.0D-2)GOTO 4600
      IDOM(J)=1
4600  CONTINUE
      WRITE(NFIL6,9600)(IDOM(J),J=1,NOBAS)
4700  CONTINUE
4800  CONTINUE
C
C
C
      IPOM=0
      ISNT=KSTYPA(1)
      DO 4900 K=1,ISNT
      DO 4900 L=K,ISNT
4900  SMAT(L,K)=VMAT(L,K)
      CALL HOUSQL(NOBAS,ISNT,SMAT,HTR,EWRK,30,IFAIL)
C
C    PRB ADDITION
C
C     WRITE(NFIL6,9990)
C9990 FORMAT(' ',' FIRST EIGENVECTORS WRITTEN IN ROWS IN FOLLOWING ')
C     DO 9991 KK=1,15
C     WRITE(NFIL6,9992)(SMAT(JJ,KK),JJ=1,15)
C9991 WRITE(NFIL6,9993)
C9992 FORMAT(' ',5D14.6)
C9993 FORMAT(' ',/)
      IF (IFAIL .NE. 0) THEN
      WRITE (NFIL6,9700)
      STOP
      ENDIF
      DO 4920 K=1,ISNT
      DO 4920 L=1,ISNT
4920    VMAT(L,K)=SMAT(L,K)
      DO 5000 K=1,ISNT
5000  ESTR(K+IPOM)=HTR(K)
      IF (KSTYPA(2) .EQ. 0) GOTO 5400
      IPOM=ISNT
      ISNT=KSTYPA(2)
      DO 5100 K=1,ISNT
      DO 5100 L=K,ISNT
5100  SMAT(L,K)=VMAT(L+IPOM,K+IPOM)
      CALL HOUSQL(NOBAS,ISNT,SMAT,HTR,EWRK,30,IFAIL)
C     WRITE(NFIL6,9994)
C9994 FORMAT(' ',' SECOND EIGENVECTORS WRITTEN IN ROWS IN FOLLOWING ')
C     DO 9995 KK=1,15
C     WRITE(NFIL6,9996)(SMAT(JJ,KK),JJ=1,15)
C9995 WRITE(NFIL6,9997)
C9996 FORMAT(' ',5D14.6)
C9997 FORMAT(' ',/)
      IF (IFAIL .NE. 0) THEN
      WRITE (NFIL6,9700)
      STOP
      ENDIF
      DO 5120 K=1,ISNT
      DO 5120 L=1,ISNT
5120    VMAT(L+IPOM,K+IPOM)=SMAT(L,K)
      DO 5200 K=1,ISNT
5200  ESTR(K+IPOM)=HTR(K)
C
5400  CONTINUE
C
      DO 5420 K=IPOM+1,NOBAS
      DO 5420 L=1,IPOM
5420  VMAT(L,K)=0.0D0
C
      DO 5440 K=1,IPOM
      DO 5440 L=IPOM+1,NOBAS
5440  VMAT(L,K)=0.0D0
C
      DO 5600 J=1,NOBAS
C
      DO 5480 I=1,NOBAS
5480  TMAT(I,J)=0.0D0
C
      DO 5600 K=1,NOBAS
      VMKJ=VMAT(K,J)
      ISTA=ICOMA(K)+1
      IEND=ISTA+NDBA(K)-1
      INDEX=0
C
      DO 5500 I=ISTA,IEND
      INDEX=INDEX+1
5500  TMAT(I,J)=TMAT(I,J)+UMAT(INDEX,K)*VMKJ
C
5600  CONTINUE
C
      IF (IPRINT .EQ. 0) RETURN
C
      WRITE (NFIL6,9800)
      DO 6100 I=1,LSTYPA(1)
      MAXC=0
      TEST=0.0D+00
      DO 6000  K=1,NOBAS
      IF (DABS(TMAT(K,I)) .GT. TEST) THEN
            MAXC=K
            TEST=DABS(TMAT(K,I))
      ENDIF
6000  CONTINUE
6100  WRITE (NFIL6,9810) I,IW1(MAXC),IW3(MAXC),ESTR(I)
C
C ***** PRB INSERT FOR HF STRETCH PHONEY MORSE CALC *****
C
C     KPRB=K
C     IF (K.EQ.KPRB)STOP
      IF (KSTYPA(2) .EQ. 0) RETURN
C
      IPOM=KSTYPA(1)
      WRITE (NFIL6,9900)
      DO 7100 I=1,LSTYPA(2)
      MAXC=0
      TEST=0.0D+00
      INDEX=KSTYPA(1)+I
      DO 7000  K=1,NOBAS
      IF (DABS(TMAT(K,INDEX)) .GT. TEST) THEN
            MAXC=K
            TEST=DABS(TMAT(K,INDEX))
      ENDIF
7000  CONTINUE
7100  WRITE (NFIL6,9810) I,IW1(MAXC),IW3(MAXC),ESTR(IPOM+I)
      RETURN
C
9000  FORMAT('0','  STRETCHING MATRIX FROM STRTCH',//)
9100  FORMAT(5F25.16)
9200  FORMAT('1',5X,12('*'),' U MATRIX ',12('*')//
     1      ' ',8X,'I',3X,'J',1X,2(3X,'U(I,J+',I1,')')//)
9300  FORMAT(5X,2I4,1X,2F11.6)
9400  FORMAT('0','      SYMMETRIZED HAMILTONIAN MATRIX FOR ',
     1                'THE STRETCHING MOTION',//)
9500  FORMAT(5F25.16)
9600  FORMAT(I4,39I1)
9700  FORMAT(1H0,'  MORBID.STR.ERR  MATRIX DIAGONALIZATION FAILED ',
     1          'IN STRTCH'/)
9800  FORMAT('0',5X,12('*'),' A1 STRETCHING FUNCTIONS ',12('*')//
     1      ' ',8X,'FCT. #',8X,'N1',8X,'N3',12X,'ENERGY/CM-1'//)
9810  FORMAT(' ',12X,I2,8X,I2,8X,I2,10X,F14.5)
9900  FORMAT('0',5X,12('*'),' B2 STRETCHING FUNCTIONS ',12('*')//
     1      ' ',8X,'FCT. #',8X,'N1',8X,'N3',12X,'ENERGY/CM-1'//)
      END
C         ***** PART 4 OF 4 *****
      SUBROUTINE RHOFCT ( SYMJ0 , ASYJ0 , SYMJP , ASYJP )
      IMPLICIT REAL*8 (A-H,O-Z)
C             :
C DATE        : 28.04.1986
C AUTHOR      : PER JENSEN
C UPDATES     :
C LANGUAGE    : FORTRAN
C PURPOSE     : SETS UP THE RHO DEPENDENT FUNCTIONS NEEDED TO
C             : CALCULATE THE ROTATION-VIBRATION ENERGIES OF A
C             : TRIATOMIC MOLECULE USING THE MORBID SCHEME.
C SUBPROGRAMS :
C      CALLED :
C             :
C
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 SYMJ0(NFSYM0),ASYJ0(NFASY0),SYMJP(NFSYMJ),
     1      ASYJP(NFASYJ)
      REAL*8 EPSC1,EPSC2,CORHOE
      REAL*8 MUXXY(15),MUYYY(15),MUZZY(15),MURRY(15),
     1       MUYZY(15),MUXRY(15),
     2       PX1Y(15),PX3Y(15),PR1Y(15),PR3Y(15),
     3       PXMXX1(15),PXMXX3(15),PRMXR1(15),PRMXR3(15),
     4       PXMXR1(15),PXMXR3(15),PRMRR1(15),PRMRR3(15),
     5       VCOEF(15)
      INTEGER I,KFSYM0,KFASY0,KFSYMJ,KFASYJ,L,NREMAI,
     1       NRECS ,NREMP1
      INTEGER KESYM0 , KEASY0 , KESYMJ , KEASYJ
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      CONVU=PLANCK*AVOGNO*1.0D+16/(4.0D+00*PI*PI*VELLGT)
      U1=M1*(M3+M2)*RE12*RE12
      U3=M3*(M1+M2)*RE32*RE32
      U13=M1*M3*RE12*RE32
      V=M2*(M1+M2+M3)*RE12*RE32
      CORHOE=DCOS(RHOE)
      EPSC1=(U1-U3)/DSQRT((U1+U3)**2-4.0D0*U13**2)
      EPSC2=DSQRT((U1+U3-2.0D0*U13)/(U1+U3+2.0D0*U13))
C
C     START LOOP OVER RHO
C
      DO 1000 I=1,NSTINT
      RHO=DFLOAT(I)*HSTEP
      EPS=0.5D0*RHO+EPSC1*DATAN(EPSC2*DTAN(0.5D0*RHO))
      CR=DCOS(RHO)
      SR=DSIN(RHO)
      CSE=DCOS(EPS)
      SNE=DSIN(EPS)
      CRE=CR*CSE+SR*SNE
      SRE=SR*CSE-CR*SNE
      EPSP=(U1+U13*CR)/(U1+U3+2.0D0*U13*CR)
      EPSPP=U13*SR*(U1-U3)/(U1+U3+2.0D0*U13*CR)**2
      EPSPPP=U13*(U1-U3)*(CR/(U1+U3+2.0D0*U13*CR)**2
     1     +4.0D0*U13*SR*SR/(U1+U3+2.0D0*U13*CR)**3)
C
C     GENERATE THE COEFFICIENTS IN THE EXPANSIONS OF THE S I'S
C     IN TERMS OF THE DELTA R I'S.
C
      CALL BCOEF
C
C     GENERATE THE COEFFICIENTS IN THE EXPANSIONS OF COS RHO BAR
C     IN TERMS OF THE DELTA R I'S.
C
      CALL COSRB
C
C     GENERATE THE COEFFICIENTS IN THE EXPANSIONS OF THE MU
C     TENSOR ELEMENTS AND THE VIBRATIONAL ANGULAR MOMENTA IN
C     TERMS OF THE DELTA R I'S.
C
      CALL MUTENS ( MUXXY , MUYYY , MUZZY ,
     2             MUYZY , MURRY , MUXRY ,
     3             PXMXX1  , PXMXX3 , PRMXR1 , PRMXR3 ,
     2             PXMXR1  , PXMXR3 , PRMRR1 , PRMRR3 )
C
C     GENERATE THE LEADING TERM IN THE PSEUDOPOTENTIAL TERM
C     U0 (SEE PAPER BY SARKA AND BUNKER FOR NOTATION). THE
C     PURELY VIBRATIONAL CONTRIBUTION TO U0 IS GENERATED IN U0VIB,
C     FOR THE PURELY ROTATIONAL CONTRIBUTION WE USE SARKA AND
C     BUNKER'S RESULT WITH C(RHO) = -1/SIN(RHO)*SIN(RHO)
C
      CALL U0VIB( UVVAL )
      URVAL = -MUXXY(1)/8.0D+00 - (M1+M2+M3)**2*MUXXY(1)*U13*U13/
     1                 (8.0D+00*(U1*U3-U13*U13)*(U1*U3-U13*U13*CR*CR))
C
C     GENERATE THE COEFFICIENTS IN THE EXPANSIONS OF THE
C     POTENTIAL ENERGY IN TERMS OF THE DELTA R I'S.
C
      CALL VPOT (VCOEF )
C
C     THE VARIOUS EXPANSION COEFFICIENTS ARE NOW STORED IN
C     THE WORK ARRAY IN ORDER TO BE USED FOR CALCULATIONS
C     OF INTEGRALS
C
      SYMJ0(1)=MURRY(1)
      SYMJ0(2)=MURRY(2)
      SYMJ0(3)=MURRY(4)
      SYMJ0(4)=MURRY(6)
      SYMJ0(5)=MURRY(7)
      SYMJ0(6)=MURRY(9)
      SYMJ0(7)=MURRY(11)
      SYMJ0(8)=MURRY(13)
      SYMJ0(9)=MURRY(15)
      SYMJ0(10)=CONVU*(UVVAL+URVAL)
      SYMJ0(11)=VCOEF(2)
      SYMJ0(12)=VCOEF(4)
      SYMJ0(13)=VCOEF(6)
      SYMJ0(14)=VCOEF(7)
      SYMJ0(15)=VCOEF(9)
      SYMJ0(16)=VCOEF(11)
      SYMJ0(17)=VCOEF(13)
      SYMJ0(18)=VCOEF(15)
      SYMJ0(19)=-CR
      SYMJ0(20)=CR1/AA1
      SYMJ0(21)=(CR1/2.0D+00+CR11/AA1)/AA1
      SYMJ0(22)=CR13/(AA1*AA3)
      SYMJ0(23)=PXMXR1(2)+PRMRR1(2)
      SYMJ0(24)=PXMXR1(3)+PRMRR1(3)
      SYMJ0(25)=PXMXR1(4)+PRMRR1(4)
      SYMJ0(26)=PXMXR1(5)+PRMRR1(5)
      SYMJ0(27)=PXMXR1(6)+PRMRR1(6)
      SYMJ0(28)=PXMXR1(7)+PRMRR1(7)
      SYMJ0(29)=PXMXR1(8)+PRMRR1(8)
      SYMJ0(30)=PXMXR1(9)+PRMRR1(9)
      SYMJ0(31)=PXMXR1(10)+PRMRR1(10)
      ASYJ0(1)=MURRY(3)
      ASYJ0(2)=MURRY(5)
      ASYJ0(3)=MURRY(8)
      ASYJ0(4)=MURRY(10)
      ASYJ0(5)=MURRY(12)
      ASYJ0(6)=MURRY(14)
      ASYJ0(7)=VCOEF(3)
      ASYJ0(8)=VCOEF(5)
      ASYJ0(9)=VCOEF(8)
      ASYJ0(10)=VCOEF(10)
      ASYJ0(11)=VCOEF(12)
      ASYJ0(12)=VCOEF(14)
      ASYJ0(13)=CR3/AA3
      ASYJ0(14)=(CR3/2.0D+00+CR33/AA3)/AA3
      ASYJ0(15)=PXMXR3(2)+PRMRR3(2)
      ASYJ0(16)=PXMXR3(3)+PRMRR3(3)
      ASYJ0(17)=PXMXR3(4)+PRMRR3(4)
      ASYJ0(18)=PXMXR3(5)+PRMRR3(5)
      ASYJ0(19)=PXMXR3(6)+PRMRR3(6)
      ASYJ0(20)=PXMXR3(7)+PRMRR3(7)
      ASYJ0(21)=PXMXR3(8)+PRMRR3(8)
      ASYJ0(22)=PXMXR3(9)+PRMRR3(9)
      ASYJ0(23)=PXMXR3(10)+PRMRR3(10)
      SYMJP(1)=MUXXY(1)
      SYMJP(2)=MUXXY(2)
      SYMJP(3)=MUXXY(4)
      SYMJP(4)=MUXXY(6)
      SYMJP(5)=MUXXY(7)
      SYMJP(6)=MUXXY(9)
      SYMJP(7)=MUXXY(11)
      SYMJP(8)=MUXXY(13)
      SYMJP(9)=MUXXY(15)
      SYMJP(10)=MUYYY(1)
      SYMJP(11)=MUYYY(2)
      SYMJP(12)=MUYYY(4)
      SYMJP(13)=MUYYY(6)
      SYMJP(14)=MUYYY(7)
      SYMJP(15)=MUYYY(9)
      SYMJP(16)=MUYYY(11)
      SYMJP(17)=MUYYY(13)
      SYMJP(18)=MUYYY(15)
      SYMJP(19)=MUZZY(1)
      SYMJP(20)=MUZZY(2)
      SYMJP(21)=MUZZY(4)
      SYMJP(22)=MUZZY(6)
      SYMJP(23)=MUZZY(7)
      SYMJP(24)=MUZZY(9)
      SYMJP(25)=MUZZY(11)
      SYMJP(26)=MUZZY(13)
      SYMJP(27)=MUZZY(15)
      SYMJP(28)=MUYZY(2)
      SYMJP(29)=MUYZY(4)
      SYMJP(30)=MUYZY(6)
      SYMJP(31)=MUYZY(7)
      SYMJP(32)=MUYZY(9)
      SYMJP(33)=MUYZY(11)
      SYMJP(34)=MUYZY(13)
      SYMJP(35)=MUYZY(15)
      SYMJP(36)=MUXRY(2)
      SYMJP(37)=MUXRY(4)
      SYMJP(38)=MUXRY(6)
      SYMJP(39)=MUXRY(7)
      SYMJP(40)=MUXRY(9)
      SYMJP(41)=MUXRY(11)
      SYMJP(42)=MUXRY(13)
      SYMJP(43)=MUXRY(15)
      SYMJP(44)=PXMXX1(2)+PRMXR1(2)
      SYMJP(45)=PXMXX1(3)+PRMXR1(3)
      SYMJP(46)=PXMXX1(4)+PRMXR1(4)
      SYMJP(47)=PXMXX1(5)+PRMXR1(5)
      SYMJP(48)=PXMXX1(6)+PRMXR1(6)
      SYMJP(49)=PXMXX1(7)+PRMXR1(7)
      SYMJP(50)=PXMXX1(8)+PRMXR1(8)
      SYMJP(51)=PXMXX1(9)+PRMXR1(9)
      SYMJP(52)=PXMXX1(10)+PRMXR1(10)
      ASYJP(1)=MUXXY(3)
      ASYJP(2)=MUXXY(5)
      ASYJP(3)=MUXXY(8)
      ASYJP(4)=MUXXY(10)
      ASYJP(5)=MUXXY(12)
      ASYJP(6)=MUXXY(14)
      ASYJP(7)=MUYYY(3)
      ASYJP(8)=MUYYY(5)
      ASYJP(9)=MUYYY(8)
      ASYJP(10)=MUYYY(10)
      ASYJP(11)=MUYYY(12)
      ASYJP(12)=MUYYY(14)
      ASYJP(13)=MUZZY(3)
      ASYJP(14)=MUZZY(5)
      ASYJP(15)=MUZZY(8)
      ASYJP(16)=MUZZY(10)
      ASYJP(17)=MUZZY(12)
      ASYJP(18)=MUZZY(14)
      ASYJP(19)=MUYZY(1)
      ASYJP(20)=MUYZY(3)
      ASYJP(21)=MUYZY(5)
      ASYJP(22)=MUYZY(8)
      ASYJP(23)=MUYZY(10)
      ASYJP(24)=MUYZY(12)
      ASYJP(25)=MUYZY(14)
      ASYJP(26)=MUXRY(3)
      ASYJP(27)=MUXRY(5)
      ASYJP(28)=MUXRY(8)
      ASYJP(29)=MUXRY(10)
      ASYJP(30)=MUXRY(12)
      ASYJP(31)=MUXRY(14)
      ASYJP(32)=PXMXX3(2)+PRMXR3(2)
      ASYJP(33)=PXMXX3(3)+PRMXR3(3)
      ASYJP(34)=PXMXX3(4)+PRMXR3(4)
      ASYJP(35)=PXMXX3(5)+PRMXR3(5)
      ASYJP(36)=PXMXX3(6)+PRMXR3(6)
      ASYJP(37)=PXMXX3(7)+PRMXR3(7)
      ASYJP(38)=PXMXX3(8)+PRMXR3(8)
      ASYJP(39)=PXMXX3(9)+PRMXR3(9)
      ASYJP(40)=PXMXX3(10)+PRMXR3(10)
      WRITE (NFIL1) (SYMJ0(L), L=1,NFSYM0)
      WRITE (NFIL2) (ASYJ0(L), L=1,NFASY0)
      WRITE (NFIL3) (SYMJP(L), L=1,NFSYMJ)
      WRITE (NFIL4) (ASYJP(L), L=1,NFASYJ)
1000  CONTINUE
      RETURN
      END
C
C
      SUBROUTINE VPOT ( VCOEF )
      IMPLICIT REAL*8 (A-H,O-Z)
C             :
C DATE        : 30.04.1986
C AUTHOR      : PER JENSEN
C UPDATES     :
C LANGUAGE    : FORTRAN
C PURPOSE     : CALCULATION OF THE EXPANSION COEFFICIENTS (IN THE
C             : Y I'S) OF THE BEND-STRETCH POTENTIAL ENERGY
C             : FUNCTION.
C SUBPROGRAMS :
C      CALLED : TRNSV0,TRNSRY,TRNSPT
C             :
C INPUT       : RHO         INSTANTANEOUS VALUE OF THE BENDING COORDINAT
C             :
C OUTPUT      : VCOEF(1:15) EXPANSION COEFFICIENTS OF THE BEND-STRETCH
C             :             POTENTIAL ENERGY FUNCTION IN TERMS OF THE
C             :             YI PARAMETERS.
C             :
C             :
C    THE ARRAY CONTAINS THE COEFFICIENTS OF THE FOLLOWING
C    QUANTITIES:
C
C    I             VCOEF(I)
C  -------------------------------------------------------------
C    1             1
C    2             Y1
C    3             Y3
C    4             Y1**2
C    5             Y3**2
C    6             Y1*Y3
C    7             Y1**3
C    8             Y3**3
C    9             Y1**2*Y3
C   10             Y1*Y3**2
C   11             Y1**4
C   12             Y3**4
C   13             Y1**3*Y3
C   14             Y1*Y3**3
C   15             Y1**2*Y3**2
C
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 VCOEF(15),V0COER(15),V0COEY(15)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      CORO=DCOS(RHOREF)-DCOS(RHO)
      CALL TRNSV0 ( V0COER )
      CALL TRNSRY ( V0COER , V0COEY )
      CORO=DCOS(RHOE)-DCOS(RHO)
      CALL TRNSPT ( VCOEF )
      VCOEF(1)=VCOEF(1)+V0COEY(1)
      VCOEF(2)=VCOEF(2)+V0COEY(2)
      VCOEF(3)=VCOEF(3)+V0COEY(3)
      VCOEF(4)=VCOEF(4)+V0COEY(4)
      VCOEF(5)=VCOEF(5)+V0COEY(5)
      VCOEF(6)=VCOEF(6)+V0COEY(6)
      VCOEF(7)=VCOEF(7)+V0COEY(7)
      VCOEF(8)=VCOEF(8)+V0COEY(8)
      VCOEF(9)=VCOEF(9)+V0COEY(9)
      VCOEF(10)=VCOEF(10)+V0COEY(10)
      VCOEF(11)=VCOEF(11)+V0COEY(11)
      VCOEF(12)=VCOEF(12)+V0COEY(12)
      VCOEF(13)=VCOEF(13)+V0COEY(13)
      VCOEF(14)=VCOEF(14)+V0COEY(14)
      VCOEF(15)=VCOEF(15)+V0COEY(15)
      RETURN
      END
      SUBROUTINE TRNSRY ( RCOEF , YCOEF )
C            :
C DATE       : 24.04.1986
C AUTHOR     : PER JENSEN
C UPDATES    : PRB AS FOLLOWS
C  ***** IN THIS SUBROUTINE FCRWXYZ CHANGED TO FCWXYZ WHERE
C  ***** WXYZ = 1111, 3333, 1113, 1333, 1133 IN PER'S VERSION.
C LANGUAGE   : FORTRAN
C PURPOSE    : TRANSFORMATION OF A FOURTH ORDER POLYNOMIAL IN THE R
C            : SUB I'S TO A FOURTH ORDER POLYNOMIAL IN THE Y SUB I'S
C            : THE CODE IS GENERATED BY REDUCE.
C            :
C INPUT      : RCOEF(1:15) THE COEFFICIENTS OF A FOURTH ORDER POLYNOMIAL
C            :             IN THE DELTA R I'S.
C            :
C OUTPUT     : YCOEF(1:15) THE COEFFICIENTS OF THE CORRESPONDING
C            :             POLYNOMIAL IN THE Y I'S.
C            :
      IMPLICIT REAL*8  (A-H,O-Z)
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 RCOEF(15),YCOEF(15)
      REAL*8 FCR0,FCR1,FCR3,FCR11,FCR33,FCR13,
     1      FCR111,FCR333,FCR113,FCR133,
     2      FC1111,FC3333,FC1113,FC1333,FC1133,
     3      Q0,Q1,Q3,Q11,Q33,Q13,
     4      Q111,Q333,Q113,Q133,
     5      Q1111,Q3333,Q1113,Q1333,Q1133
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      FCR0=RCOEF(1)
      FCR1=RCOEF(2)
      FCR3=RCOEF(3)
      FCR11=RCOEF(4)
      FCR33=RCOEF(5)
      FCR13=RCOEF(6)
      FCR111=RCOEF(7)
      FCR333=RCOEF(8)
      FCR113=RCOEF(9)
      FCR133=RCOEF(10)
      FC1111=RCOEF(11)
      FC3333=RCOEF(12)
      FC1113=RCOEF(13)
      FC1333=RCOEF(14)
      FC1133=RCOEF(15)
      Q0=FCR0
      Q1=FCR1/AA1
      Q3=FCR3/AA3
      Q11=(2.D0*FCR11+FCR1*AA1)/(2.D0*AA1**2)
      Q33=(2.D0*FCR33+FCR3*AA3)/(2.D0*AA3**2)
      Q13=FCR13/(AA3*AA1)
      Q111=(3.D0*FCR111+3.D0*FCR11*AA1+FCR1*AA1**2)/(3.D0*AA1**3)
      Q333=(3.D0*FCR333+3.D0*FCR33*AA3+FCR3*AA3**2)/(3.D0*AA3**3)
      Q113=(2.D0*FCR113+FCR13*AA1)/(2.D0*AA3*AA1**2)
      Q133=(2.D0*FCR133+FCR13*AA3)/(2.D0*AA3**2*AA1)
      Q1111=(12.D0*FC1111+18.D0*FCR111*AA1+11.D0*FCR11*AA1**2+3.D0*FCR1
     1 *AA1**3)/(12.D0*AA1**4)
      Q3333=(12.D0*FC3333+18.D0*FCR333*AA3+11.D0*FCR33*AA3**2+3.D0*FCR3
     1 *AA3**3)/(12.D0*AA3**4)
      Q1113=(3.D0*FC1113+3.D0*FCR113*AA1+FCR13*AA1**2)/(3.D0*AA3*AA1
     1 **3)
      Q1333=(3.D0*FC1333+3.D0*FCR133*AA3+FCR13*AA3**2)/(3.D0*AA3**3*
     1 AA1)
      Q1133=(4.D0*FC1133+2.D0*FCR133*AA1+2.D0*FCR113*AA3+FCR13*AA3*
     1 AA1)/(4.D0*AA3**2*AA1**2)
      YCOEF(1)=Q0
      YCOEF(2)=Q1
      YCOEF(3)=Q3
      YCOEF(4)=Q11
      YCOEF(5)=Q33
      YCOEF(6)=Q13
      YCOEF(7)=Q111
      YCOEF(8)=Q333
      YCOEF(9)=Q113
      YCOEF(10)=Q133
      YCOEF(11)=Q1111
      YCOEF(12)=Q3333
      YCOEF(13)=Q1113
      YCOEF(14)=Q1333
      YCOEF(15)=Q1133
      RETURN
      END
      SUBROUTINE TRNSPT ( VCOEF )
      IMPLICIT REAL*8 (A-H,O-Z)
C             :
C DATE        : 24.04.1986
C AUTHOR      : PER JENSEN
C UPDATES     :
C LANGUAGE    : FORTRAN
C PURPOSE     : TRANSFORMATION OF THE BEND-STRETCH POTENTIAL FROM RHO
C             : BAR DEPENDENT FORM TO RHO DEPENDENT FORM.
C             : EXPANSION COEFFICIENTS OF Y SUB I'S ARE CALCULATED.
C             : THE CODE IS GENERATED BY REDUCE.
C SUBPROGRAMS :
C      CALLED :
C             :
C INPUT       : RHO  INSTANTANEOUS VALUE OF THE BENDING COORDINATE
C             :
C OUTPUT      : VCOEF(1:15)  EXPANSION COEFFICIENTS OF THE BEND-STRETCH
C             :              POTENTIAL ENERGY FUNCTION IN TERMS OF THE
C             :              YI PARAMETERS.
C             :
C             :
C    THE ARRAY CONTAINS THE COEFFICIENTS OF THE FOLLOWING
C    QUANTITIES:
C
C    I             VCOEF(I)
C  -------------------------------------------------------------
C    1             1
C    2             Y1
C    3             Y3
C    4             Y1**2
C    5             Y3**2
C    6             Y1*Y3
C    7             Y1**3
C    8             Y3**3
C    9             Y1**2*Y3
C   10             Y1*Y3**2
C   11             Y1**4
C   12             Y3**4
C   13             Y1**3*Y3
C   14             Y1*Y3**3
C   15             Y1**2*Y3**2
C
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8 CORO2,CORO3,
     1      Q1,Q3,Q11,Q33,Q13,Q111,Q333,Q113,Q133,
     2      Q1111,Q3333,Q1113,Q1333,Q1133,
     3      ANS1,ANS2,ANS3,VCOEF(15)
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      CORO2=CORO*CORO
      CORO3=CORO2*CORO
      Q1=CORO*(CORO3*F4A1+CORO2*F3A1+CORO*F2A1+F1A1)
      Q3=CORO*(CORO3*F4A3+CORO2*F3A3+CORO*F2A3+F1A3)
      Q11=(CORO3*(4.D0*CR1*F4A1+F3A11*AA1)+CORO2*(3.D0*CR1*F3A1+
     1 F2A11*AA1)+CORO*(2.D0*CR1*F2A1+F1A11*AA1)+CR1*F1A1+F11*AA1)
     1 /AA1
      Q33=(CORO3*(4.D0*CR3*F4A3+F3A33*AA3)+CORO2*(3.D0*CR3*F3A3+
     1 F2A33*AA3)+CORO*(2.D0*CR3*F2A3+F1A33*AA3)+CR3*F1A3+F33*AA3)
     1 /AA3
      Q13=(CORO3*(4.D0*CR3*F4A1*AA1+4.D0*CR1*F4A3*AA3+F3A13*AA3*
     1 AA1)+CORO2*(3.D0*CR3*F3A1*AA1+3.D0*CR1*F3A3*AA3+F2A13*AA3*
     1 AA1)+CORO*(2.D0*CR3*F2A1*AA1+2.D0*CR1*F2A3*AA3+F1A13*AA3*AA1)
     1 +CR3*F1A1*AA1+CR1*F1A3*AA3+F13*AA3*AA1)/(AA3*AA1)
      Q111=(4.D0*CORO3*F4A1*(2.D0*CR11+CR1*AA1)+CORO2*(6.D0*CR11*
     1 F3A1+12.D0*CR1**2*F4A1+6.D0*CR1*F3A11*AA1+3.D0*CR1*F3A1*AA1+2.D0*
     1 F2A111*AA1**2)+2.D0*CORO*(2.D0*CR11*F2A1+3.D0*CR1**2*F3A1+2.D0*
     1 CR1*F2A11*AA1+CR1*F2A1*AA1+F1A111*AA1**2)+2.D0*CR11*F1A1+2.D0
     1 *CR1**2*F2A1+2.D0*CR1*F1A11*AA1+CR1*F1A1*AA1+2.D0*F111*AA1**2
     1 )/(2.D0*AA1**2)
      Q333=(4.D0*CORO3*F4A3*(2.D0*CR33+CR3*AA3)+CORO2*(6.D0*CR33*
     1 F3A3+12.D0*CR3**2*F4A3+3.D0*CR3*F3A3*AA3+6.D0*CR3*F3A33*AA3+2.D0*
     1 F2A333*AA3**2)+2.D0*CORO*(2.D0*CR33*F2A3+3.D0*CR3**2*F3A3+CR3*
     1 F2A3*AA3+2.D0*CR3*F2A33*AA3+F1A333*AA3**2)+2.D0*CR33*F1A3+2.D0*
     1 CR3**2*F2A3+CR3*F1A3*AA3+2.D0*CR3*F1A33*AA3+2.D0*F333*AA3**2)
     1 /(2.D0*AA3**2)
      Q113=(4.D0*CORO3*(2.D0*CR13*F4A1*AA1+2.D0*CR11*F4A3*AA3+CR1*
     1 F4A3*AA3*AA1)+CORO2*(6.D0*CR13*F3A1*AA1+6.D0*CR11*F3A3*AA3+
     1 24.D0*CR3*CR1*F4A1*AA1+6.D0*CR3*F3A11*AA1**2+12.D0*CR1**2*F4A3*
     1 AA3+6.D0*CR1*F3A13*AA3*AA1+3.D0*CR1*F3A3*AA3*AA1+2.D0*AA3*
     1 F2A113*AA1**2)+2.D0*CORO*(2.D0*CR13*F2A1*AA1+2.D0*CR11*F2A3*AA3
     1 +6.D0*CR3*CR1*F3A1*AA1+2.D0*CR3*F2A11*AA1**2+3.D0*CR1**2*F3A3*
     1 AA3+2.D0*CR1*F2A13*AA3*AA1+CR1*F2A3*AA3*AA1+AA3*F1A113*AA1
     1 **2)+2.D0*CR13*F1A1*AA1+2.D0*CR11*F1A3*AA3+4.D0*CR3*CR1*F2A1*
     1 AA1+2.D0*CR3*F1A11*AA1**2+2.D0*CR1**2*F2A3*AA3+2.D0*CR1*F1A13*
     1 AA3*AA1+CR1*F1A3*AA3*AA1+2.D0*AA3*F113*AA1**2)/(2.D0*AA3*AA1
     1 **2)
      Q133=(4.D0*CORO3*(2.D0*CR13*F4A3*AA3+2.D0*CR33*F4A1*AA1+CR3*
     1 F4A1*AA3*AA1)+CORO2*(6.D0*CR13*F3A3*AA3+6.D0*CR33*F3A1*AA1+
     1 12.D0*CR3**2*F4A1*AA1+24.D0*CR3*CR1*F4A3*AA3+6.D0*CR3*F3A13*AA3*
     1 AA1+3.D0*CR3*F3A1*AA3*AA1+6.D0*CR1*F3A33*AA3**2+2.D0*F2A133*AA3
     1 **2*AA1)+2.D0*CORO*(2.D0*CR13*F2A3*AA3+2.D0*CR33*F2A1*AA1+3.D0*
     1 CR3**2*F3A1*AA1+6.D0*CR3*CR1*F3A3*AA3+2.D0*CR3*F2A13*AA3*AA1+
     1 CR3*F2A1*AA3*AA1+2.D0*CR1*F2A33*AA3**2+F1A133*AA3**2*AA1)+
     1 2.D0*CR13*F1A3*AA3+2.D0*CR33*F1A1*AA1+2.D0*CR3**2*F2A1*AA1+4.D0*
     1 CR3*CR1*F2A3*AA3+2.D0*CR3*F1A13*AA3*AA1+CR3*F1A1*AA3*AA1+2.D0
     1 *CR1*F1A33*AA3**2+2.D0*F133*AA3**2*AA1)/(2.D0*AA3**2*AA1)
      Q1111=(8.D0*CORO3*F4A1*(3.D0*CR111+3.D0*CR11*AA1+CR1*AA1**2)+
     1 3.D0*CORO2*(6.D0*CR111*F3A1+24.D0*CR11*CR1*F4A1
     1 +6.D0*CR11*F3A11*
     1 AA1+6.D0*CR11*F3A1*AA1+12.D0*CR1**2*F4A1*AA1+3.D0*CR1*F3A11*AA1
     1 **2+2.D0*CR1*F3A1*AA1**2)+2.D0*CORO*(6.D0*CR111*F2A1+18.D0*CR11*
     1 CR1*F3A1+6.D0*CR11*F2A11*AA1+6.D0*CR11*F2A1*AA1+12.D0*CR1**3*
     1 F4A1+9.D0*CR1**2*F3A11*AA1+9.D0*CR1**2*F3A1*AA1+3.D0*CR1*F2A11*
     1 AA1**2+6.D0*CR1*F2A111*AA1**2+2.D0*CR1*F2A1*AA1**2+3.D0*FA1111
     1 *AA1**3)+6.D0*CR111*F1A1+12.D0*CR11*CR1*F2A1+6.D0*CR11*F1A11*
     1 AA1+6.D0*CR11*F1A1*AA1+6.D0*CR1**3*F3A1+6.D0*CR1**2*F2A11*AA1+
     1 6.D0*CR1**2*F2A1*AA1+3.D0*CR1*F1A11*AA1**2+6.D0*CR1*F1A111*AA1**
     1 2+2.D0*CR1*F1A1*AA1**2+6.D0*F1111*AA1**3)/(6.D0*AA1**3)
      Q3333=(8.D0*CORO3*F4A3*(3.D0*CR333+3.D0*CR33*AA3+CR3*AA3**2)+
     1 3.D0*CORO2*(6.D0*CR333*F3A3+24.D0*CR33*CR3*F4A3+6.D0*CR33*F3A3*
     1 AA3+6.D0*CR33*F3A33*AA3+12.D0*CR3**2*F4A3*AA3+2.D0*CR3*F3A3*AA3
     1 **2+3.D0*CR3*F3A33*AA3**2)+2.D0*CORO*(6.D0*CR333*F2A3+18.D0*CR33*
     1 CR3*F3A3+6.D0*CR33*F2A3*AA3+6.D0*CR33*F2A33*AA3+12.D0*CR3**3*
     1 F4A3+9.D0*CR3**2*F3A3*AA3+9.D0*CR3**2*F3A33*AA3+6.D0*CR3*F2A333
     1 *AA3**2+2.D0*CR3*F2A3*AA3**2+3.D0*CR3*F2A33*AA3**2+3.D0*FA3333
     1 *AA3**3)+6.D0*CR333*F1A3+12.D0*CR33*CR3*F2A3+6.D0*CR33*F1A3*AA3
     1 +6.D0*CR33*F1A33*AA3+6.D0*CR3**3*F3A3+6.D0*CR3**2*F2A3*AA3+6.D0*
     1 CR3**2*F2A33*AA3+6.D0*CR3*F1A333*AA3**2+2.D0*CR3*F1A3*AA3**2+
     1 3.D0*CR3*F1A33*AA3**2+6.D0*F3333*AA3**3)/(6.D0*AA3**3)
      ANS2=18.D0*CR3*CR1**2*F3A1*AA1+12.D0*CR3*CR1*F2A11*AA1**2+6.D0*
     1 CR3*CR1*F2A1*AA1**2+6.D0*CR3*F1A111*AA1**3+6.D0*CR1**3*F3A3*
     1 AA3+6.D0*CR1**2*F2A13*AA3*AA1+6.D0*CR1**2*F2A3*AA3*AA1+3.D0*CR1
     1 *F1A13*AA3*AA1**2+2.D0*CR1*F1A3*AA3*AA1**2+6.D0*CR1*AA3*
     1 F1A113*AA1**2+6.D0*F1113*AA3*AA1**3
      ANS1=4.D0*CORO3*(6.D0*CR113*F4A1*AA1+6.D0*CR111*F4A3*AA3+3.D0*
     1 CR13*F4A1*AA1**2+6.D0*CR11*F4A3*AA3*AA1+2.D0*CR1*F4A3*AA3*AA1
     1 **2)+3.D0*CORO2*(6.D0*CR113*F3A1*AA1+6.D0*CR111*F3A3*AA3+24.D0*
     1 CR13*CR1*F4A1*AA1+6.D0*CR13*F3A11*AA1**2+3.D0*CR13*F3A1*AA1**
     1 2+24.D0*CR11*CR3*F4A1*AA1+24.D0*CR11*CR1*F4A3*AA3+6.D0*CR11*
     1 F3A13*AA3*AA1+6.D0*CR11*F3A3*AA3*AA1+12.D0*CR3*CR1*F4A1*AA1**
     1 2+12.D0*CR1**2*F4A3*AA3*AA1+3.D0*CR1*F3A13*AA3*AA1**2+2.D0*CR1*
     1 F3A3*AA3*AA1**2)+2.D0*CORO*(6.D0*CR113*F2A1*AA1+6.D0*CR111*F2A3
     1 *AA3+18.D0*CR13*CR1*F3A1*AA1+6.D0*CR13*F2A11*AA1**2+3.D0*CR13*
     1 F2A1*AA1**2+18.D0*CR11*CR3*F3A1*AA1+18.D0*CR11*CR1*F3A3*AA3+
     1 6.D0*CR11*F2A13*AA3*AA1+6.D0*CR11*F2A3*AA3*AA1+36.D0*CR3*CR1**2*
     1 F4A1*AA1+18.D0*CR3*CR1*F3A11*AA1**2+9.D0*CR3*CR1*F3A1*AA1**2+
     1 6.D0*CR3*F2A111*AA1**3+12.D0*CR1**3*F4A3*AA3+9.D0*CR1**2*F3A13*
     1 AA3*AA1+9.D0*CR1**2*F3A3*AA3*AA1+3.D0*CR1*F2A13*AA3*AA1**2+2.D0
     1 *CR1*F2A3*AA3*AA1**2+6.D0*CR1*AA3*F2A113*AA1**2+3.D0*FA1113*
     1 AA3*AA1**3)+6.D0*CR113*F1A1*AA1+6.D0*CR111*F1A3*AA3+12.D0*CR13*
     1 CR1*F2A1*AA1+6.D0*CR13*F1A11*AA1**2+3.D0*CR13*F1A1*AA1**2+12.D0
     1 *CR11*CR3*F2A1*AA1+12.D0*CR11*CR1*F2A3*AA3+6.D0*CR11*F1A13*
     1 AA3*AA1+6.D0*CR11*F1A3*AA3*AA1+ANS2
      Q1113=ANS1/(6.D0*AA3*AA1**3)
      ANS2=6.D0*CR3**3*F3A1*AA1+18.D0*CR3**2*CR1*F3A3*AA3+6.D0*CR3**2*
     1 F2A13*AA3*AA1+6.D0*CR3**2*F2A1*AA3*AA1+6.D0*CR3*CR1*F2A3*AA3
     1 **2+12.D0*CR3*CR1*F2A33*AA3**2+3.D0*CR3*F1A13*AA3**2*AA1+6.D0*
     1 CR3*F1A133*AA3**2*AA1+2.D0*CR3*F1A1*AA3**2*AA1+6.D0*CR1*
     1 F1A333*AA3**3+6.D0*F1333*AA3**3*AA1
      ANS1=4.D0*CORO3*(6.D0*CR133*F4A3*AA3+6.D0*CR333*F4A1*AA1+3.D0*
     1 CR13*F4A3*AA3**2+6.D0*CR33*F4A1*AA3*AA1+2.D0*CR3*F4A1*AA3**2*
     1 AA1)+3.D0*CORO2*(6.D0*CR133*F3A3*AA3+6.D0*CR333*F3A1*AA1+24.D0*
     1 CR13*CR3*F4A3*AA3+3.D0*CR13*F3A3*AA3**2+6.D0*CR13*F3A33*AA3**
     1 2+24.D0*CR33*CR3*F4A1*AA1+24.D0*CR33*CR1*F4A3*AA3+6.D0*CR33*
     1 F3A13*AA3*AA1+6.D0*CR33*F3A1*AA3*AA1+12.D0*CR3**2*F4A1*AA3*
     1 AA1+12.D0*CR3*CR1*F4A3*AA3**2+3.D0*CR3*F3A13*AA3**2*AA1+2.D0*
     1 CR3*F3A1*AA3**2*AA1)+2.D0*CORO*(6.D0*CR133*F2A3*AA3+6.D0*CR333*
     1 F2A1*AA1+18.D0*CR13*CR3*F3A3*AA3+3.D0*CR13*F2A3*AA3**2+6.D0*
     1 CR13*F2A33*AA3**2+18.D0*CR33*CR3*F3A1*AA1+18.D0*CR33*CR1*F3A3
     1 *AA3+6.D0*CR33*F2A13*AA3*AA1+6.D0*CR33*F2A1*AA3*AA1+12.D0*CR3**
     1 3*F4A1*AA1+36.D0*CR3**2*CR1*F4A3*AA3+9.D0*CR3**2*F3A13*AA3*
     1 AA1+9.D0*CR3**2*F3A1*AA3*AA1+9.D0*CR3*CR1*F3A3*AA3**2+18.D0*CR3
     1 *CR1*F3A33*AA3**2+3.D0*CR3*F2A13*AA3**2*AA1+6.D0*CR3*F2A133*
     1 AA3**2*AA1+2.D0*CR3*F2A1*AA3**2*AA1+6.D0*CR1*F2A333*AA3**3+3.D0
     1 *FA1333*AA3**3*AA1)+6.D0*CR133*F1A3*AA3+6.D0*CR333*F1A1*AA1+
     1 12.D0*CR13*CR3*F2A3*AA3+3.D0*CR13*F1A3*AA3**2+6.D0*CR13*F1A33*
     1 AA3**2+12.D0*CR33*CR3*F2A1*AA1+12.D0*CR33*CR1*F2A3*AA3+6.D0*
     1 CR33*F1A13*AA3*AA1+6.D0*CR33*F1A1*AA3*AA1+ANS2
      Q1333=ANS1/(6.D0*AA3**3*AA1)
      ANS2=4.D0*CR33*CR1*F2A1*AA1+2.D0*CR33*F1A11*AA1**2+4.D0*CR11*CR3
     1 *F2A3*AA3+2.D0*CR11*F1A33*AA3**2+6.D0*CR3**2*CR1*F3A1*AA1+2.D0*
     1 CR3**2*F2A11*AA1**2+6.D0*CR3*CR1**2*F3A3*AA3+4.D0*CR3*CR1*
     1 F2A13*AA3*AA1+2.D0*CR3*CR1*F2A3*AA3*AA1+2.D0*CR3*CR1*F2A1*AA3
     1 *AA1+CR3*F1A11*AA3*AA1**2+2.D0*CR3*AA3*F1A113*AA1**2+2.D0*CR1
     1 **2*F2A33*AA3**2+2.D0*CR1*F1A133*AA3**2*AA1+CR1*F1A33*AA3**
     1 2*AA1+2.D0*F1133*AA3**2*AA1**2
      ANS1=4.D0*CORO3*(2.D0*CR133*F4A1*AA1+2.D0*CR113*F4A3*AA3+CR13*
     1 F4A3*AA3*AA1+CR13*F4A1*AA3*AA1)+3.D0*CORO2*(2.D0*CR133*F3A1
     1 *AA1+2.D0*CR113*F3A3*AA3+8.D0*CR13*CR3*F4A1*AA1+8.D0*CR13*CR1*
     1 F4A3*AA3+2.D0*CR13*F3A13*AA3*AA1+CR13*F3A3*AA3*AA1+CR13*
     1 F3A1*AA3*AA1+8.D0*CR33*CR1*F4A1*AA1+2.D0*CR33*F3A11*AA1**2+8.D0
     1 *CR11*CR3*F4A3*AA3+2.D0*CR11*F3A33*AA3**2+4.D0*CR3*CR1*F4A3*
     1 AA3*AA1+4.D0*CR3*CR1*F4A1*AA3*AA1+CR3*F3A11*AA3*AA1**2+CR1*
     1 F3A33*AA3**2*AA1)+2.D0*CORO*(2.D0*CR133*F2A1*AA1+2.D0*CR113*
     1 F2A3*AA3+6.D0*CR13*CR3*F3A1*AA1+6.D0*CR13*CR1*F3A3*AA3+2.D0*
     1 CR13*F2A13*AA3*AA1+CR13*F2A3*AA3*AA1+CR13*F2A1*AA3*AA1+6.D0
     1 *CR33*CR1*F3A1*AA1+2.D0*CR33*F2A11*AA1**2+6.D0*CR11*CR3*F3A3*
     1 AA3+2.D0*CR11*F2A33*AA3**2+12.D0*CR3**2*CR1*F4A1*AA1+3.D0*CR3**
     1 2*F3A11*AA1**2+12.D0*CR3*CR1**2*F4A3*AA3+6.D0*CR3*CR1*F3A13*
     1 AA3*AA1+3.D0*CR3*CR1*F3A3*AA3*AA1+3.D0*CR3*CR1*F3A1*AA3*AA1+
     1 CR3*F2A11*AA3*AA1**2+2.D0*CR3*AA3*F2A113*AA1**2+3.D0*CR1**2*
     1 F3A33*AA3**2+2.D0*CR1*F2A133*AA3**2*AA1+CR1*F2A33*AA3**2*
     1 AA1+FA1133*AA3**2*AA1**2)+2.D0*CR133*F1A1*AA1+2.D0*CR113*
     1 F1A3*AA3+4.D0*CR13*CR3*F2A1*AA1+4.D0*CR13*CR1*F2A3*AA3+2.D0*
     1 CR13*F1A13*AA3*AA1+CR13*F1A3*AA3*AA1+CR13*F1A1*AA3*AA1+
     1 ANS2
      Q1133=ANS1/(2.D0*AA3**2*AA1**2)
      VCOEF(1)=0.0D0
      VCOEF(2)=Q1
      VCOEF(3)=Q3
      VCOEF(4)=Q11
      VCOEF(5)=Q33
      VCOEF(6)=Q13
      VCOEF(7)=Q111
      VCOEF(8)=Q333
      VCOEF(9)=Q113
      VCOEF(10)=Q133
      VCOEF(11)=Q1111
      VCOEF(12)=Q3333
      VCOEF(13)=Q1113
      VCOEF(14)=Q1333
      VCOEF(15)=Q1133
      RETURN
      END
      SUBROUTINE TRNSV0 ( V0COEF )
      IMPLICIT REAL*8 (A-H,O-Z)
C             :
C DATE        : 24.04.1986
C AUTHOR      : PER JENSEN
C UPDATES     :
C LANGUAGE    : FORTRAN
C PURPOSE     : TRANSFORMATION OF THE PURE BENDING POTENTIAL FROM THE
C             : RHO BAR DEPENDENT FORM TO THE RHO DEPENDENT FORM.
C             : EXPANSION COEFFICIENTS FOR R SUB I'S ARE CALCULATED.
C             : THE CODE IS GENERATED BY REDUCE.
C             :
C SUBPROGRAMS :
C      CALLED :
C             :
C INPUT       : RHO          INSTANTANEOUS VALUE OF THE BENDING COORDINA
C             :
C OUTPUT      : V0COEF(1:15) EXPANSION COEFFICIENTS OF THE BEND-STRETCH
C             :              POTENTIAL ENERGY FUNCTION IN TERMS OF THE
C             :              YI PARAMETERS.
C             :
C             :
C    THE ARRAY CONTAINS THE COEFFICIENTS OF THE FOLLOWING
C    QUANTITIES:
C
C    I             VCOEF(I)
C  -------------------------------------------------------------
C    1             1
C    2             R1
C    3             R3
C    4             R1**2
C    5             R3**2
C    6             R1*R3
C    7             R1**3
C    8             R3**3
C    9             R1**2*R3
C   10             R1*R3**2
C   11             R1**4
C   12             R3**4
C   13             R1**3*R3
C   14             R1*R3**3
C   15             R1**2*R3**2
C
      REAL*8 M1,M2,M3,M,U1,U3,U13,V,RHO,EPS,
     1      CR,SR,CSE,SNE,
     2      CRE,SRE,CORO,EPSP,EPSPP,EPSPPP
C
      REAL*8 AMASS(3,12)
C
      REAL*8 RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1       AA1,AA3,
     2       F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3       F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4       F13,F1A13,F2A13,F3A13,
     5       F111,F1A111,F2A111,F333,F1A333,F2A333,
     6       F113,F1A113,F2A113,F133,F1A133,F2A133,
     7       F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8       F1333,FA1333,F1133,FA1133,
     8       RE12 , RE32 , RHOREF , VMIN
C
      REAL*8 ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1      PREC
C
      REAL*8 THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1      THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2      VELLGT , PLANCK , AVOGNO , DEGRAD , RADDEG ,
     3      PI
C
      REAL*8   B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      REAL*8   CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
      INTEGER NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5       NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6       NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7       NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6       ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7       IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8       NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER,
     9       ISOMAX , NATTS  , V0TYPE , IVAR(55) , PARMAX ,
     1       NUMPAR , PRTINT
C
      INTEGER V1 ,V2, V3 , V2MXP1, V2P1,
     1       NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2       NSEPP2 , NSEQP1 , MBASIS ,
     3       MDIM , NFSYM0, NFASY0, NFSYMJ, NFASYJ,
     4       KSTYPA(2) , LSTYPA(2) , JMAX , V2MAX , JMAXP1
C
      INTEGER IQUANT(5,12)
C
      LOGICAL SYMM
C
      REAL*8 RMK(2),AAS(2)
      INTEGER NOBAS,MBASP1,LENIW
      REAL*8  CORO2,CORO3,CORO4,CORO5,CORO6,CORO7,
     4       Q1,Q3,Q11,Q33,Q13,
     5       Q111,Q333,Q113,Q133,
     6       Q1111,Q3333,Q1113,Q1333,Q1133,
     7       V0COEF(15),ANS1
      COMMON /ISOTOP/ IQUANT,AMASS
C
      COMMON /VALUES/ RHO,EPS,EPSP,EPSPP,EPSPPP,
     1               CR,SR,CSE,SNE,CRE,SRE,CORO
C
      COMMON /MOLCUL/ RHOE,FA1,FA2,FA3,FA4,FA5,FA6,FA7,FA8,
     1               AA1,AA3,
     2               F1A1,F2A1,F3A1,F4A1,F1A3,F2A3,F3A3,F4A3,
     3               F11,F1A11,F2A11,F3A11,F33,F1A33,F2A33,F3A33,
     4               F13,F1A13,F2A13,F3A13,
     5               F111,F1A111,F2A111,F333,F1A333,F2A333,
     6               F113,F1A113,F2A113,F133,F1A133,F2A133,
     7               F1111,FA1111,F3333,FA3333,F1113,FA1113,
     8               F1333,FA1333,F1133,FA1133,
     8               RE12 , RE32 , M1 , M2 , M3 , M ,
     9               U1 , U3 , U13 , V ,
     1               SYMM
C
      COMMON /INTEG/  ETRIAL , RHOMAX , PNM1 , HBASE , HSTEP , EGUESS ,
     1               RHOREF , VMIN , V0TYPE ,
     1               NSTINT , NSERIN , NSERP , NSERQ , KQUA , NTEST ,
     2               NSEPP2 , NSEQP1 , KSTYPA , LSTYPA
C
      COMMON /DIMEN/  MBASIS ,  V2MAX  , V2MXP1 ,
     1               JMAX   , JMAXP1 , MDIM   , NFSYM0 , NFASY0 ,
     2               NFSYMJ , NFASYJ
C
      COMMON /LSFIT/  PARMAX , NUMPAR , ISOMAX , IVAR
C
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      COMMON/BCOEFF/
     1      B11,B13,B111,B133,B113,
     2      B1111,B1333,B1113,B1133,
     3      B11111,B13333,B11113,B11333,B11133,
     4      B31,B33,B311,B333,B313,
     5      B3111,B3333,B3113,B3133,
     6      B31111,B33333,B31113,B31333,B31133
C
      COMMON/CRCOEF/
     1      CR1,CR3,CR11,CR33,CR13,
     2      CR111,CR333,CR113,CR133,
     3      CR1111,CR3333,CR1113,CR1333,CR1133
C
C
      COMMON/MORSE/RMK,AAS
      COMMON/MODIM/NOBAS,MBASP1,LENIW
      CORO2=CORO*CORO
      CORO3=CORO2*CORO
      CORO4=CORO3*CORO
      CORO5=CORO4*CORO
      CORO6=CORO5*CORO
      CORO7=CORO6*CORO
      Q1=CORO*(8.D0*CORO6*FA8+7.D0*CORO5*FA7+6.D0*CORO4*FA6+5.D0*
     1 CORO3*FA5+4.D0*CORO2*FA4+3.D0*CORO*FA3+2.D0*FA2)*CR1
     2 +FA1*CR1
      Q3=CORO*(8.D0*CORO6*FA8+7.D0*CORO5*FA7+6.D0*CORO4*FA6+5.D0*
     1 CORO3*FA5+4.D0*CORO2*FA4+3.D0*CORO*FA3+2.D0*FA2)*CR3
     2 +FA1*CR3
      Q11=8.D0*CR11*CORO7*FA8+7.D0*CR11*CORO6*FA7+6.D0*CR11*CORO**
     1 5*FA6+5.D0*CR11*CORO4*FA5+4.D0*CR11*CORO3*FA4+3.D0*CR11*
     1 CORO2*FA3+2.D0*CR11*CORO*FA2+28.D0*CR1**2*CORO6*FA8+21.D0*
     1 CR1**2*CORO5*FA7+15.D0*CR1**2*CORO4*FA6+10.D0*CR1**2*CORO
     1 **3*FA5+6.D0*CR1**2*CORO2*FA4+3.D0*CR1**2*CORO*FA3+CR1**2*
     1 FA2+FA1*CR11
      Q33=8.D0*CR33*CORO7*FA8+7.D0*CR33*CORO6*FA7+6.D0*CR33*CORO**
     1 5*FA6+5.D0*CR33*CORO4*FA5+4.D0*CR33*CORO3*FA4+3.D0*CR33*
     1 CORO2*FA3+2.D0*CR33*CORO*FA2+28.D0*CR3**2*CORO6*FA8+21.D0*
     1 CR3**2*CORO5*FA7+15.D0*CR3**2*CORO4*FA6+10.D0*CR3**2*CORO
     1 **3*FA5+6.D0*CR3**2*CORO2*FA4+3.D0*CR3**2*CORO*FA3+CR3**2*
     1 FA2+FA1*CR33
      Q13=8.D0*CR13*CORO7*FA8+7.D0*CR13*CORO6*FA7+6.D0*CR13*CORO**
     1 5*FA6+5.D0*CR13*CORO4*FA5+4.D0*CR13*CORO3*FA4+3.D0*CR13*
     1 CORO2*FA3+2.D0*CR13*CORO*FA2+56.D0*CR3*CR1*CORO6*FA8+42.D0*
     1 CR3*CR1*CORO5*FA7+30.D0*CR3*CR1*CORO4*FA6+20.D0*CR3*CR1*
     1 CORO3*FA5+12.D0*CR3*CR1*CORO2*FA4+6.D0*CR3*CR1*CORO*FA3+
     1 2.D0*CR3*CR1*FA2+FA1*CR13
      Q111=8.D0*CR111*CORO7*FA8+7.D0*CR111*CORO6*FA7+6.D0*CR111*
     1 CORO5*FA6+5.D0*CR111*CORO4*FA5+4.D0*CR111*CORO3*FA4+3.D0*
     1 CR111*CORO2*FA3+2.D0*CR111*CORO*FA2+56.D0*CR11*CR1*CORO6*
     1 FA8+42.D0*CR11*CR1*CORO5*FA7+30.D0*CR11*CR1*CORO4*FA6+20.D0
     1 *CR11*CR1*CORO3*FA5+12.D0*CR11*CR1*CORO2*FA4+6.D0*CR11*
     1 CR1*CORO*FA3+2.D0*CR11*CR1*FA2+56.D0*CR1**3*CORO5*FA8+35.D0*
     1 CR1**3*CORO4*FA7+20.D0*CR1**3*CORO3*FA6+10.D0*CR1**3*CORO
     1 **2*FA5+4.D0*CR1**3*CORO*FA4+CR1**3*FA3+FA1*CR111
      Q333=8.D0*CR333*CORO7*FA8+7.D0*CR333*CORO6*FA7+6.D0*CR333*
     1 CORO5*FA6+5.D0*CR333*CORO4*FA5+4.D0*CR333*CORO3*FA4+3.D0*
     1 CR333*CORO2*FA3+2.D0*CR333*CORO*FA2+56.D0*CR33*CR3*CORO6*
     1 FA8+42.D0*CR33*CR3*CORO5*FA7+30.D0*CR33*CR3*CORO4*FA6+20.D0
     1 *CR33*CR3*CORO3*FA5+12.D0*CR33*CR3*CORO2*FA4+6.D0*CR33*
     1 CR3*CORO*FA3+2.D0*CR33*CR3*FA2+56.D0*CR3**3*CORO5*FA8+35.D0*
     1 CR3**3*CORO4*FA7+20.D0*CR3**3*CORO3*FA6+10.D0*CR3**3*CORO
     1 **2*FA5+4.D0*CR3**3*CORO*FA4+CR3**3*FA3+FA1*CR333
      Q113=8.D0*CR113*CORO7*FA8+7.D0*CR113*CORO6*FA7+6.D0*CR113*
     1 CORO5*FA6+5.D0*CR113*CORO4*FA5+4.D0*CR113*CORO3*FA4+3.D0*
     1 CR113*CORO2*FA3+2.D0*CR113*CORO*FA2+56.D0*CR13*CR1*CORO6*
     1 FA8+42.D0*CR13*CR1*CORO5*FA7+30.D0*CR13*CR1*CORO4*FA6+20.D0
     1 *CR13*CR1*CORO3*FA5+12.D0*CR13*CR1*CORO2*FA4+6.D0*CR13*
     1 CR1*CORO*FA3+2.D0*CR13*CR1*FA2+56.D0*CR11*CR3*CORO6*FA8+42.D0
     1 *CR11*CR3*CORO5*FA7+30.D0*CR11*CR3*CORO4*FA6+20.D0*CR11*
     1 CR3*CORO3*FA5+12.D0*CR11*CR3*CORO2*FA4+6.D0*CR11*CR3*CORO
     1 *FA3+2.D0*CR11*CR3*FA2+168.D0*CR3*CR1**2*CORO5*FA8+105.D0*CR3
     1 *CR1**2*CORO4*FA7+60.D0*CR3*CR1**2*CORO3*FA6+30.D0*CR3*
     1 CR1**2*CORO2*FA5+12.D0*CR3*CR1**2*CORO*FA4+3.D0*CR3*CR1**2*
     1 FA3+FA1*CR113
      Q133=8.D0*CR133*CORO7*FA8+7.D0*CR133*CORO6*FA7+6.D0*CR133*
     1 CORO5*FA6+5.D0*CR133*CORO4*FA5+4.D0*CR133*CORO3*FA4+3.D0*
     1 CR133*CORO2*FA3+2.D0*CR133*CORO*FA2+56.D0*CR13*CR3*CORO6*
     1 FA8+42.D0*CR13*CR3*CORO5*FA7+30.D0*CR13*CR3*CORO4*FA6+20.D0
     1 *CR13*CR3*CORO3*FA5+12.D0*CR13*CR3*CORO2*FA4+6.D0*CR13*
     1 CR3*CORO*FA3+2.D0*CR13*CR3*FA2+56.D0*CR33*CR1*CORO6*FA8+42.D0
     1 *CR33*CR1*CORO5*FA7+30.D0*CR33*CR1*CORO4*FA6+20.D0*CR33*
     1 CR1*CORO3*FA5+12.D0*CR33*CR1*CORO2*FA4+6.D0*CR33*CR1*CORO
     1 *FA3+2.D0*CR33*CR1*FA2+168.D0*CR3**2*CR1*CORO5*FA8+105.D0*CR3
     1 **2*CR1*CORO4*FA7+60.D0*CR3**2*CR1*CORO3*FA6+30.D0*CR3**2
     1 *CR1*CORO2*FA5+12.D0*CR3**2*CR1*CORO*FA4+3.D0*CR3**2*CR1*
     1 FA3+FA1*CR133
      Q1111=8.D0*CR1111*CORO7*FA8+7.D0*CR1111*CORO6*FA7+6.D0*
     1 CR1111*CORO5*FA6+5.D0*CR1111*CORO4*FA5+4.D0*CR1111*CORO**
     1 3*FA4+3.D0*CR1111*CORO2*FA3+2.D0*CR1111*CORO*FA2+56.D0*CR111*
     1 CR1*CORO6*FA8+42.D0*CR111*CR1*CORO5*FA7+30.D0*CR111*CR1*
     1 CORO4*FA6+20.D0*CR111*CR1*CORO3*FA5+12.D0*CR111*CR1*CORO
     1 **2*FA4+6.D0*CR111*CR1*CORO*FA3+2.D0*CR111*CR1*FA2+28.D0*CR11**
     1 2*CORO6*FA8+21.D0*CR11**2*CORO5*FA7+15.D0*CR11**2*CORO4
     1 *FA6+10.D0*CR11**2*CORO3*FA5+6.D0*CR11**2*CORO2*FA4+3.D0*
     1 CR11**2*CORO*FA3+CR11**2*FA2+168.D0*CR11*CR1**2*CORO5*FA8
     1 +105.D0*CR11*CR1**2*CORO4*FA7+60.D0*CR11*CR1**2*CORO3*FA6
     1 +30.D0*CR11*CR1**2*CORO2*FA5+12.D0*CR11*CR1**2*CORO*FA4+3.D0*
     1 CR11*CR1**2*FA3+70.D0*CR1**4*CORO4*FA8+35.D0*CR1**4*CORO3
     1 *FA7+15.D0*CR1**4*CORO2*FA6+5.D0*CR1**4*CORO*FA5+CR1**4*FA4
     1 +FA1*CR1111
      Q3333=8.D0*CR3333*CORO7*FA8+7.D0*CR3333*CORO6*FA7+6.D0*
     1 CR3333*CORO5*FA6+5.D0*CR3333*CORO4*FA5+4.D0*CR3333*CORO**
     1 3*FA4+3.D0*CR3333*CORO2*FA3+2.D0*CR3333*CORO*FA2+56.D0*CR333*
     1 CR3*CORO6*FA8+42.D0*CR333*CR3*CORO5*FA7+30.D0*CR333*CR3*
     1 CORO4*FA6+20.D0*CR333*CR3*CORO3*FA5+12.D0*CR333*CR3*CORO
     1 **2*FA4+6.D0*CR333*CR3*CORO*FA3+2.D0*CR333*CR3*FA2+28.D0*CR33**
     1 2*CORO6*FA8+21.D0*CR33**2*CORO5*FA7+15.D0*CR33**2*CORO4
     1 *FA6+10.D0*CR33**2*CORO3*FA5+6.D0*CR33**2*CORO2*FA4+3.D0*
     1 CR33**2*CORO*FA3+CR33**2*FA2+168.D0*CR33*CR3**2*CORO5*FA8
     1 +105.D0*CR33*CR3**2*CORO4*FA7+60.D0*CR33*CR3**2*CORO3*FA6
     1 +30.D0*CR33*CR3**2*CORO2*FA5+12.D0*CR33*CR3**2*CORO*FA4+3.D0*
     1 CR33*CR3**2*FA3+70.D0*CR3**4*CORO4*FA8+35.D0*CR3**4*CORO3
     1 *FA7+15.D0*CR3**4*CORO2*FA6+5.D0*CR3**4*CORO*FA5+CR3**4*FA4
     1 +FA1*CR3333
      ANS1=280.D0*CR3*CR1**3*CORO4*FA8+140.D0*CR3*CR1**3*CORO3*
     1 FA7+60.D0*CR3*CR1**3*CORO2*FA6+20.D0*CR3*CR1**3*CORO*FA5+4.D0
     1 *CR3*CR1**3*FA4
      Q1113=8.D0*CR1113*CORO7*FA8+7.D0*CR1113*CORO6*FA7+6.D0*
     1 CR1113*CORO5*FA6+5.D0*CR1113*CORO4*FA5+4.D0*CR1113*CORO**
     1 3*FA4+3.D0*CR1113*CORO2*FA3+2.D0*CR1113*CORO*FA2+56.D0*CR113*
     1 CR1*CORO6*FA8+42.D0*CR113*CR1*CORO5*FA7+30.D0*CR113*CR1*
     1 CORO4*FA6+20.D0*CR113*CR1*CORO3*FA5+12.D0*CR113*CR1*CORO
     1 **2*FA4+6.D0*CR113*CR1*CORO*FA3+2.D0*CR113*CR1*FA2+56.D0*CR111*
     1 CR3*CORO6*FA8+42.D0*CR111*CR3*CORO5*FA7+30.D0*CR111*CR3*
     1 CORO4*FA6+20.D0*CR111*CR3*CORO3*FA5+12.D0*CR111*CR3*CORO
     1 **2*FA4+6.D0*CR111*CR3*CORO*FA3+2.D0*CR111*CR3*FA2+56.D0*CR13*
     1 CR11*CORO6*FA8+42.D0*CR13*CR11*CORO5*FA7+30.D0*CR13*CR11*
     1 CORO4*FA6+20.D0*CR13*CR11*CORO3*FA5+12.D0*CR13*CR11*CORO
     1 **2*FA4+6.D0*CR13*CR11*CORO*FA3+2.D0*CR13*CR11*FA2+168.D0*CR13*
     1 CR1**2*CORO5*FA8+105.D0*CR13*CR1**2*CORO4*FA7+60.D0*CR13*
     1 CR1**2*CORO3*FA6+30.D0*CR13*CR1**2*CORO2*FA5+12.D0*CR13*
     1 CR1**2*CORO*FA4+3.D0*CR13*CR1**2*FA3+336.D0*CR11*CR3*CR1*CORO
     1 **5*FA8+210.D0*CR11*CR3*CR1*CORO4*FA7+120.D0*CR11*CR3*CR1*
     1 CORO3*FA6+60.D0*CR11*CR3*CR1*CORO2*FA5+24.D0*CR11*CR3*CR1
     1 *CORO*FA4+6.D0*CR11*CR3*CR1*FA3+ANS1+FA1*CR1113
      ANS1=280.D0*CR3**3*CR1*CORO4*FA8+140.D0*CR3**3*CR1*CORO3*
     1 FA7+60.D0*CR3**3*CR1*CORO2*FA6+20.D0*CR3**3*CR1*CORO*FA5+4.D0
     1 *CR3**3*CR1*FA4
      Q1333=8.D0*CR1333*CORO7*FA8+7.D0*CR1333*CORO6*FA7+6.D0*
     1 CR1333*CORO5*FA6+5.D0*CR1333*CORO4*FA5+4.D0*CR1333*CORO**
     1 3*FA4+3.D0*CR1333*CORO2*FA3+2.D0*CR1333*CORO*FA2+56.D0*CR133*
     1 CR3*CORO6*FA8+42.D0*CR133*CR3*CORO5*FA7+30.D0*CR133*CR3*
     1 CORO4*FA6+20.D0*CR133*CR3*CORO3*FA5+12.D0*CR133*CR3*CORO
     1 **2*FA4+6.D0*CR133*CR3*CORO*FA3+2.D0*CR133*CR3*FA2+56.D0*CR333*
     1 CR1*CORO6*FA8+42.D0*CR333*CR1*CORO5*FA7+30.D0*CR333*CR1*
     1 CORO4*FA6+20.D0*CR333*CR1*CORO3*FA5+12.D0*CR333*CR1*CORO
     1 **2*FA4+6.D0*CR333*CR1*CORO*FA3+2.D0*CR333*CR1*FA2+56.D0*CR13*
     1 CR33*CORO6*FA8+42.D0*CR13*CR33*CORO5*FA7+30.D0*CR13*CR33*
     1 CORO4*FA6+20.D0*CR13*CR33*CORO3*FA5+12.D0*CR13*CR33*CORO
     1 **2*FA4+6.D0*CR13*CR33*CORO*FA3+2.D0*CR13*CR33*FA2+168.D0*CR13*
     1 CR3**2*CORO5*FA8+105.D0*CR13*CR3**2*CORO4*FA7+60.D0*CR13*
     1 CR3**2*CORO3*FA6+30.D0*CR13*CR3**2*CORO2*FA5+12.D0*CR13*
     1 CR3**2*CORO*FA4+3.D0*CR13*CR3**2*FA3+336.D0*CR33*CR3*CR1*CORO
     1 **5*FA8+210.D0*CR33*CR3*CR1*CORO4*FA7+120.D0*CR33*CR3*CR1*
     1 CORO3*FA6+60.D0*CR33*CR3*CR1*CORO2*FA5+24.D0*CR33*CR3*CR1
     1 *CORO*FA4+6.D0*CR33*CR3*CR1*FA3+ANS1+FA1*CR1333
      ANS1=168.D0*CR33*CR1**2*CORO5*FA8+105.D0*CR33*CR1**2*CORO4
     1 *FA7+60.D0*CR33*CR1**2*CORO3*FA6+30.D0*CR33*CR1**2*CORO2*
     1 FA5+12.D0*CR33*CR1**2*CORO*FA4+3.D0*CR33*CR1**2*FA3+168.D0*CR11
     1 *CR3**2*CORO5*FA8+105.D0*CR11*CR3**2*CORO4*FA7+60.D0*CR11
     1 *CR3**2*CORO3*FA6+30.D0*CR11*CR3**2*CORO2*FA5+12.D0*CR11*
     1 CR3**2*CORO*FA4+3.D0*CR11*CR3**2*FA3+420.D0*CR3**2*CR1**2*
     1 CORO4*FA8+210.D0*CR3**2*CR1**2*CORO3*FA7+90.D0*CR3**2*CR1
     1 **2*CORO2*FA6+30.D0*CR3**2*CR1**2*CORO*FA5+6.D0*CR3**2*CR1
     1 **2*FA4
      Q1133=8.D0*CR1133*CORO7*FA8+7.D0*CR1133*CORO6*FA7+6.D0*
     1 CR1133*CORO5*FA6+5.D0*CR1133*CORO4*FA5+4.D0*CR1133*CORO**
     1 3*FA4+3.D0*CR1133*CORO2*FA3+2.D0*CR1133*CORO*FA2+56.D0*CR133*
     1 CR1*CORO6*FA8+42.D0*CR133*CR1*CORO5*FA7+30.D0*CR133*CR1*
     1 CORO4*FA6+20.D0*CR133*CR1*CORO3*FA5+12.D0*CR133*CR1*CORO
     1 **2*FA4+6.D0*CR133*CR1*CORO*FA3+2.D0*CR133*CR1*FA2+56.D0*CR113*
     1 CR3*CORO6*FA8+42.D0*CR113*CR3*CORO5*FA7+30.D0*CR113*CR3*
     1 CORO4*FA6+20.D0*CR113*CR3*CORO3*FA5+12.D0*CR113*CR3*CORO2
     1 *FA4+6.D0*CR113*CR3*CORO*FA3+2.D0*CR113*CR3*FA2+28.D0*CR13**
     1 2*CORO6*FA8+21.D0*CR13**2*CORO5*FA7+15.D0*CR13**2*CORO4
     1 *FA6+10.D0*CR13**2*CORO3*FA5+6.D0*CR13**2*CORO2*FA4+3.D0*
     1 CR13**2*CORO*FA3+CR13**2*FA2+336.D0*CR13*CR3*CR1*CORO5*
     1 FA8+210.D0*CR13*CR3*CR1*CORO4*FA7+120.D0*CR13*CR3*CR1*CORO3
     1 *FA6+60.D0*CR13*CR3*CR1*CORO2*FA5+24.D0*CR13*CR3*CR1*
     1 CORO*FA4+6.D0*CR13*CR3*CR1*FA3+56.D0*CR33*CR11*CORO6*FA8+
     1 42.D0*CR33*CR11*CORO5*FA7+30.D0*CR33*CR11*CORO4*FA6+20.D0*
     1 CR33*CR11*CORO3*FA5+12.D0*CR33*CR11*CORO2*FA4+6.D0*CR33*
     1 CR11*CORO*FA3+2.D0*CR33*CR11*FA2+ANS1+FA1*CR1133
      V0COEF(1)=0.0D0
      V0COEF(2)=Q1
      V0COEF(3)=Q3
      V0COEF(4)=Q11
      V0COEF(5)=Q33
      V0COEF(6)=Q13
      V0COEF(7)=Q111
      V0COEF(8)=Q333
      V0COEF(9)=Q113
      V0COEF(10)=Q133
      V0COEF(11)=Q1111
      V0COEF(12)=Q3333
      V0COEF(13)=Q1113
      V0COEF(14)=Q1333
      V0COEF(15)=Q1133
      RETURN
      END
C
C
      SUBROUTINE PRTIME( ROUTIN , OLDTIM , OLDVEC )
      IMPLICIT REAL*8 (A-H,O-Z)
      DOUBLE PRECISION OLDTIM,NEWTIM,DELTIM,TIM1S,TIM2S
      CHARACTER*6 ROUTIN
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      IF (IPRINT .EQ. 0) RETURN
      CALL CLOCKV ( VECTIM , NEWTIM , 1 , 2 )
      DELTIM = NEWTIM - OLDTIM
      DELVEC = VECTIM - OLDVEC
      TIM1S=DELTIM/1.0D+03
      TIM2S=NEWTIM/1.0D+03
      TIM3S=DELVEC/1.0D+03
      TIM4S=VECTIM/1.0D+03
      WRITE (NFIL6,2007) ROUTIN, TIM1S, TIM3S, TIM2S, TIM4S
2007  FORMAT(1H0,'MORBID.TIM.INF  FOR ROUTINE ',A6,' : '/
     1   1H ,'                CPU TIME           ',F20.8,' SECONDS'/
     1   1H ,'                VECTOR TIME        ',F20.8,' SECONDS'/
     1   1H ,'                TOTAL CPU TIME     ',F20.8,' SECONDS'/
     1   1H ,'                TOTAL VECTOR TIME  ',F20.8,' SECONDS')
      OLDTIM=NEWTIM
      OLDVEC=VECTIM
      RETURN
      END
C
C
      SUBROUTINE PRTIMJ( J , OLDTIM , OLDVEC )
      IMPLICIT REAL*8 (A-H,O-Z)
      DOUBLE PRECISION OLDTIM,NEWTIM,DELTIM,TIM1S,TIM2S
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      IF (IPRINT .EQ. 0) RETURN
      CALL CLOCKV ( VECTIM , NEWTIM , 1 , 2 )
      DELTIM = NEWTIM - OLDTIM
      DELVEC = VECTIM - OLDVEC
      TIM1S=DELTIM/1.0D+03
      TIM2S=NEWTIM/1.0D+03
      TIM3S=DELVEC/1.0D+03
      TIM4S=VECTIM/1.0D+03
      WRITE (NFIL6,2007) J, TIM1S, TIM3S, TIM2S, TIM4S
2007  FORMAT(1H0,'MORBID.TIM.INF  FOR CALCULATING J = ',I3,' : '/
     1   1H ,'                CPU TIME           ',F20.8,' SECONDS'/
     1   1H ,'                VECTOR TIME        ',F20.8,' SECONDS'/
     1   1H ,'                TOTAL CPU TIME     ',F20.8,' SECONDS'/
     1   1H ,'                TOTAL VECTOR TIME  ',F20.8,' SECONDS')
      OLDTIM=NEWTIM
      OLDVEC=VECTIM
      RETURN
      END
C
C
      SUBROUTINE PRTITO
      IMPLICIT REAL*8 (A-H,O-Z)
      DOUBLE PRECISION NEWTIM,TIM1S
      CHARACTER*6 ROUTIN
      COMMON /SYS/    THRSH1 , THRSH2 , THRSH3 , THRSH4 , THRSH5 ,
     1                     THRSH6 , THRSH7 , THRSH8 , THRSH9 , THRSHX ,
     2                     VELLGT , PLANCK , AVOGNO , PI , PREC ,
     4                     NFIL1 , NFIL2 , NFIL3 , NFIL4 , NFIL5 ,
     5                     NFIL6 , NFIL7 , NFIL8 , NFIL9 , NFIL10 ,
     6                     NFIL11 , NFIL12 , NFIL13 , NFIL14 , NFIL15 ,
     7                     NFIL16 , NFIL17 , NFIL18 , NFIL19 , NFIL20 ,
     6                     ITEST  , IPRINT , NSTNR , NSTNIN , IREST ,
     7                     IISOT , IQUAS , ISYMS , NISOT , NQUAS ,
     8                     NUMQUA , NOPTIT , NOPTIM , IOBSER , NOBSER ,
     9                       NATTS , PRTINT
C
      CALL CLOCKV ( VECTIM , NEWTIM , 1 , 2 )
      TIM2S=NEWTIM/1.0D+03
      TIM4S=VECTIM/1.0D+03
      WRITE (NFIL6,2007) TIM2S, TIM4S
2007  FORMAT(1H0,'MORBID.TIM.INF  ENTIRE MORBID CALCULATION USED : '/
     1   1H ,'                TOTAL CPU TIME     ',F20.8,' SECONDS'/
     1   1H ,'                TOTAL VECTOR TIME  ',F20.8,' SECONDS')
      RETURN
      END

